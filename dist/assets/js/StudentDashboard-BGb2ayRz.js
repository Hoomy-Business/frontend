import{u as K,b as k,j as e}from"./query-vendor-yCE0qXS-.js";import{u as Re,r as c,L as O}from"./react-vendor-CvpuY9Ms.js";import{M as Be,e as fe,A as Ve,b as Ie,n as Ke,d as Me}from"./MainLayout-BNeTwvB_.js";import{P as He}from"./slider-D57ejDrc.js";import{a as $e,n as Qe,u as Ee,C as d,d as A,e as F,f as P,b as h,B as n,q as N,S as M,X as je,s as Ge,c as m,k as We,l as Je}from"./index-42cH5BrD.js";import{T as Xe,a as Ye,b as U,c as z}from"./tabs-DumrchZ7.js";import{B as E}from"./badge-7FXoCMHb.js";import{A as ee,a as se}from"./alert-DAdm-3vK.js";import{I as u}from"./input-BQfOhgGT.js";import{L as f}from"./label-67qstHpt.js";import{D as ge,a as ve,b as we,c as Ne,d as be,e as ye,f as _e}from"./dialog-BnpweDKq.js";import{I as Ce,C as Ze,a as es,K as ss,P as as,E as rs,b as ts,c as is}from"./KYCVerification-BjJ2Disz.js";import{S as H}from"./sparkles-8x1x_YFZ.js";import{T as ns}from"./trending-up-CNDmqqPo.js";import{H as ae}from"./heart-CPBaXQta.js";import{F as re}from"./file-text-BpuVBWhj.js";import{U as ls}from"./user--iiFN26U.js";import{B as ke}from"./building-2-DW-G4Bjl.js";import{C as R}from"./circle-check-Cikh5ACT.js";import{C as cs}from"./clock-DSFRbyAp.js";import{T as te}from"./triangle-alert-BVKVwXGT.js";import{P as Ae}from"./phone-B7UcHeEW.js";import{M as os}from"./mail-Bvu9ZxEU.js";import{L as ds}from"./lock-BKyBGEpi.js";import"./Logo-Bsxlbf95.js";import"./ui-vendor-3oCJfrha.js";import"./map-pin-D9rKwPG_.js";import"./maximize-DshBwZmY.js";import"./loader-circle-MquGnOeK.js";import"./upload-qSSxL3Iv.js";function Is(){var xe,pe;const{user:a,isAuthenticated:j,isStudent:g,refreshUser:x}=$e(),[,v]=Re();c.useEffect(()=>{if(!j){v("/login");return}g||((a==null?void 0:a.role)==="admin"?v("/admin/dashboard"):v("/dashboard/owner"))},[j,g,a==null?void 0:a.role,v]);const{toast:t}=Qe(),{t:r}=Ee(),[w,$]=c.useState("favorites"),[S,p]=c.useState(!1),[D,i]=c.useState(!1),[b,B]=c.useState(!1),[Q,o]=c.useState(!1),{data:y,isLoading:Fe,error:G}=K({queryKey:["/favorites"],enabled:j&&g,retry:!1,queryFn:async()=>{const s=We();if(!s)throw new Error("No authentication token");const l={Authorization:`Bearer ${s}`},ze=`${Je().replace(/\/+$/,"")}/favorites`,L=await fetch(ze,{headers:l});if(!L.ok){const ue=await L.json().catch(()=>({error:L.statusText}));throw new Error(ue.error||ue.message||L.statusText)}const q=await L.json();return q&&Array.isArray(q.favorites)?q.favorites:Array.isArray(q)?q:[]},staleTime:1e3*60*5,gcTime:1e3*60*15,select:s=>s?Array.isArray(s)?s:s&&typeof s=="object"&&s.favorites&&Array.isArray(s.favorites)?s.favorites:[]:[]}),{data:ie,isLoading:Pe,error:W}=K({queryKey:["/contracts/my-contracts"],queryFn:async()=>{const s=await m("GET","/contracts/my-contracts");return Array.isArray(s)?(s.length,s):s!=null&&s.contracts&&Array.isArray(s.contracts)||s!=null&&s.success&&(s!=null&&s.contracts)&&Array.isArray(s.contracts)?(s.contracts.length,s.contracts):(console.warn("⚠️ Unexpected contracts response format:",s),[])},staleTime:1e3*60*5,gcTime:1e3*60*15,refetchOnMount:!0,retry:2}),_=Array.isArray(ie)?ie:[],V=k({mutationFn:async s=>m("PUT",`/contracts/${s}/accept`,{}),onSuccess:(s,l)=>{t({title:"Contrat accepté",description:"Le contrat a été accepté et est maintenant actif."}),N.invalidateQueries({queryKey:["/contracts/my-contracts"]}),v(`/contracts/${l}`)},onError:s=>{t({title:"Erreur",description:s.message||"Impossible d'accepter le contrat",variant:"destructive"})}}),I=k({mutationFn:async s=>m("PUT",`/contracts/${s}/reject`,{}),onSuccess:()=>{t({title:"Contrat refusé",description:"Le contrat a été refusé."}),N.invalidateQueries({queryKey:["/contracts/my-contracts"]})},onError:s=>{t({title:"Erreur",description:s.message||"Impossible de refuser le contrat",variant:"destructive"})}}),{data:ne,isLoading:Se}=K({queryKey:["/conversations"],queryFn:async()=>{const s=await m("GET","/conversations");return Array.isArray(s)?s:s!=null&&s.conversations&&Array.isArray(s.conversations)?s.conversations:[]},staleTime:1e3*30,gcTime:1e3*60*5}),J=Array.isArray(ne)?ne:[],De=k({mutationFn:s=>m("DELETE",`/favorites/${s}`),onSuccess:()=>{N.invalidateQueries({queryKey:["/favorites"]})}}),{data:le,isLoading:Te}=K({queryKey:["/requests/sent"],queryFn:async()=>{const s=await m("GET","/requests/sent");return Array.isArray(s)?s:s!=null&&s.requests&&Array.isArray(s.requests)?s.requests:[]},staleTime:1e3*30,gcTime:1e3*60*5}),X=Array.isArray(le)?le:[],ce=k({mutationFn:s=>m("DELETE",`/requests/${s}`),onSuccess:()=>{N.invalidateQueries({queryKey:["/requests/sent"]}),t({title:"Success",description:"Request cancelled successfully"})},onError:s=>{t({title:"Error",description:s.message,variant:"destructive"})}}),oe=k({mutationFn:s=>m("PUT","/auth/profile",s),onSuccess:async s=>{N.invalidateQueries({queryKey:["/auth/profile"]}),N.invalidateQueries({queryKey:["/auth/user"]}),await x(),t({title:"Succès",description:s.message||"Profil mis à jour avec succès"})},onError:s=>{t({title:"Erreur",description:s.message,variant:"destructive"})}}),Le=k({mutationFn:s=>m("PUT","/auth/profile",{...s}),onSuccess:async s=>{await x(),t({title:"Succès",description:s.message||"Mot de passe modifié avec succès"})},onError:s=>{t({title:"Erreur",description:s.message,variant:"destructive"})}}),[Y,de]=c.useState(!1),[qe,me]=c.useState(!1),[he,Z]=c.useState(null),Oe=s=>{var T;const l=(T=s.target.files)==null?void 0:T[0];if(!l)return;if(!l.type.startsWith("image/")){t({title:"Erreur",description:"Le fichier doit être une image",variant:"destructive"});return}const C=new FileReader;C.onload=()=>{Z(C.result),me(!0)},C.onerror=()=>{t({title:"Erreur",description:"Erreur lors de la lecture du fichier",variant:"destructive"})},C.readAsDataURL(l)},Ue=async s=>{de(!0);try{const l=new File([s],"profile-picture.png",{type:"image/png",lastModified:Date.now()}),T=(await Ge(l)).url;await oe.mutateAsync({profile_picture:T}),t({title:"Succès",description:"Photo de profil mise à jour"})}catch(l){t({title:"Erreur",description:l instanceof Error?l.message:"Erreur lors de l'upload de la photo",variant:"destructive"})}finally{de(!1),Z(null)}};return e.jsx(Be,{children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl md:text-4xl font-bold mb-2 flex items-center gap-3","data-testid":"text-dashboard-title",children:[e.jsx(H,{className:"h-7 w-7 text-primary"}),r("dashboard.student.welcome",{name:(a==null?void 0:a.first_name)||""})]}),e.jsxs("p",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(ns,{className:"h-4 w-4"}),r("dashboard.student.manage")]})]}),e.jsxs("div",{className:"hidden md:flex gap-3",children:[y&&y.length>0&&e.jsx(d,{className:"px-4 py-2 border-primary/20",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Favoris"}),e.jsx("div",{className:"text-lg font-bold",children:y.length})]})]})}),_&&_.length>0&&e.jsx(d,{className:"px-4 py-2 border-primary/20",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Contrats"}),e.jsx("div",{className:"text-lg font-bold",children:_.length})]})]})})]})]})}),e.jsxs(Xe,{value:w,onValueChange:$,className:"space-y-6",children:[e.jsxs(Ye,{className:"grid w-full grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 lg:w-auto lg:inline-grid gap-1 sm:gap-2",children:[e.jsxs(U,{value:"favorites",className:"gap-1 sm:gap-2 text-xs sm:text-sm whitespace-nowrap min-w-0","data-testid":"tab-favorites",children:[e.jsx(ae,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate hidden xs:inline",children:r("dashboard.student.favorites")})]}),e.jsxs(U,{value:"requests",className:"gap-1 sm:gap-2 text-xs sm:text-sm whitespace-nowrap min-w-0","data-testid":"tab-requests",children:[e.jsx(Ce,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate hidden xs:inline",children:r("dashboard.student.requests")})]}),e.jsxs(U,{value:"messages",className:"gap-1 sm:gap-2 text-xs sm:text-sm whitespace-nowrap min-w-0","data-testid":"tab-messages",children:[e.jsx(fe,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate hidden xs:inline",children:r("dashboard.student.messages")})]}),e.jsxs(U,{value:"contracts",className:"gap-1 sm:gap-2 text-xs sm:text-sm whitespace-nowrap min-w-0","data-testid":"tab-contracts",children:[e.jsx(re,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate hidden xs:inline",children:r("dashboard.student.contracts")})]}),e.jsxs(U,{value:"profile",className:"gap-1 sm:gap-2 text-xs sm:text-sm whitespace-nowrap min-w-0","data-testid":"tab-profile",children:[e.jsx(ls,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate hidden xs:inline",children:r("dashboard.profile.title")})]})]}),e.jsx(z,{value:"favorites",className:"space-y-4",children:e.jsxs(d,{children:[e.jsxs(A,{children:[e.jsx(F,{children:r("dashboard.student.favorites")}),e.jsx(P,{children:r("dashboard.student.favorites.desc")})]}),e.jsx(h,{children:G?e.jsx(ee,{variant:"destructive",className:"mb-4",children:e.jsx(se,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-1",children:"Erreur de chargement"}),e.jsx("p",{className:"text-sm",children:G instanceof Error?G.message:"Erreur inconnue"})]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>N.invalidateQueries({queryKey:["/favorites"]}),children:"Réessayer"})]})})}):Fe?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3].map(s=>e.jsx(M,{className:"h-80 w-full"},s))}):!y||y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:e.jsx(ae,{className:"h-10 w-10 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:r("dashboard.student.favorites.empty")}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:r("dashboard.student.favorites.empty.desc")}),e.jsx(O,{href:"/properties",children:e.jsxs(n,{size:"lg",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),r("messages.browse")]})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(s=>e.jsx(He,{property:s,isFavorited:!0,onFavoriteToggle:l=>De.mutate(l)},s.id))})})]})}),e.jsx(z,{value:"requests",className:"space-y-4",children:e.jsxs(d,{children:[e.jsxs(A,{children:[e.jsx(F,{children:r("dashboard.student.requests.title")}),e.jsx(P,{children:r("dashboard.student.requests.desc")})]}),e.jsx(h,{children:Te?e.jsx("div",{className:"space-y-4",children:[1,2].map(s=>e.jsx(M,{className:"h-32 w-full"},s))}):!X||X.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:e.jsx(Ce,{className:"h-10 w-10 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:r("dashboard.student.requests.empty")}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:r("dashboard.student.requests.empty.desc")}),e.jsx(O,{href:"/properties",children:e.jsxs(n,{size:"lg",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Browse Properties"]})})]}):e.jsx("div",{className:"space-y-4",children:X.map(s=>{var l;return e.jsx(d,{className:"hover-elevate transition-all",children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-lg mb-1",children:s.property_title}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(ke,{className:"h-3 w-3"}),s.city_name," • CHF ",(l=s.price)==null?void 0:l.toLocaleString(),"/mois"]}),e.jsx("div",{className:"bg-muted/50 p-3 rounded-md border-l-4 border-primary",children:e.jsxs("p",{className:"text-sm italic",children:['"',s.message,'"']})})]}),e.jsxs(E,{variant:s.status==="accepted"?"default":s.status==="pending"?"secondary":"destructive",className:"gap-1",children:[s.status==="accepted"&&e.jsx(R,{className:"h-3 w-3"}),s.status==="pending"&&e.jsx(cs,{className:"h-3 w-3"}),s.status]})]}),s.status==="pending"&&e.jsx("div",{className:"flex gap-2 justify-end",children:e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{confirm("Are you sure you want to cancel this request?")&&ce.mutate(s.id)},disabled:ce.isPending,children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Cancel Request"]})})]})},s.id)})})})]})}),e.jsx(z,{value:"messages",className:"space-y-4",children:e.jsxs(d,{children:[e.jsxs(A,{children:[e.jsx(F,{children:r("messages.conversations")}),e.jsx(P,{children:r("dashboard.student.messages.desc")})]}),e.jsx(h,{children:Se?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(M,{className:"h-20 w-full"},s))}):!J||J.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:e.jsx(fe,{className:"h-10 w-10 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:r("dashboard.student.messages.empty")}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:r("dashboard.student.messages.empty.desc")}),e.jsx(O,{href:"/properties",children:e.jsxs(n,{size:"lg",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),r("messages.browse")]})})]}):e.jsx("div",{className:"space-y-3",children:J.map(s=>e.jsx(O,{href:`/messages?conversation=${s.id}`,children:e.jsx(d,{className:"hover-elevate cursor-pointer",children:e.jsxs(h,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-md bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx(ke,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold truncate",children:s.property_title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.other_user_name}),s.last_message&&e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.last_message})]}),s.unread_count&&s.unread_count>0&&e.jsx(E,{variant:"default",children:s.unread_count})]})})},s.id))})})]})}),e.jsx(z,{value:"contracts",className:"space-y-4",children:e.jsxs(d,{children:[e.jsxs(A,{children:[e.jsx(F,{children:r("dashboard.student.contracts.title")}),e.jsx(P,{children:r("dashboard.student.contracts.desc")})]}),e.jsxs(h,{children:[W&&e.jsx(ee,{variant:"destructive",className:"mb-4",children:e.jsxs(se,{children:["Erreur lors du chargement des contrats: ",W instanceof Error?W.message:"Erreur inconnue"]})}),Pe?e.jsx("div",{className:"space-y-4",children:[1,2].map(s=>e.jsx(M,{className:"h-32 w-full"},s))}):!_||_.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:e.jsx(re,{className:"h-10 w-10 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:r("dashboard.student.contracts.empty")}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:r("dashboard.student.contracts.empty.desc")}),!1]}):e.jsx("div",{className:"space-y-4",children:_.map(s=>e.jsx(d,{"data-testid":`card-contract-${s.id}`,children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-lg",children:s.property_title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.city_name})]}),e.jsx(E,{variant:s.status==="active"?"default":s.status==="pending"?"secondary":"outline",children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r("dashboard.contract.rent")}),e.jsxs("p",{className:"font-semibold",children:["CHF ",Number(s.monthly_rent||0).toLocaleString("fr-CH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),s.charges!==void 0&&s.charges!==null&&s.charges>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Charges mensuelles"}),e.jsxs("p",{className:"font-semibold",children:["CHF ",Number(s.charges||0).toLocaleString("fr-CH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r("dashboard.contract.duration")}),e.jsxs("p",{className:"font-semibold",children:[new Date(s.start_date).toLocaleDateString()," - ",new Date(s.end_date).toLocaleDateString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Caution"}),e.jsxs("p",{className:"font-semibold",children:["CHF ",Number(s.deposit_amount||0).toLocaleString("fr-CH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),s.status==="pending"&&e.jsxs(ee,{className:"mb-4",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx(se,{children:"Un contrat vous a été proposé. Vous pouvez l'accepter ou le refuser."})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"default",size:"sm",onClick:()=>V.mutate(s.id),disabled:V.isPending||I.isPending,className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),V.isPending?"Acceptation...":"Accepter"]}),e.jsxs(n,{variant:"destructive",size:"sm",onClick:()=>I.mutate(s.id),disabled:V.isPending||I.isPending,className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),I.isPending?"Refus...":"Refuser"]})]}),e.jsx(O,{href:`/contracts/${s.id}`,children:e.jsx(n,{variant:"outline",size:"sm",children:"Voir les détails"})})]})]})},s.id))})]})]})}),e.jsxs(z,{value:"profile",className:"space-y-4",children:[e.jsxs(d,{children:[e.jsxs(A,{children:[e.jsx(F,{children:r("dashboard.profile.title")}),e.jsx(P,{children:r("dashboard.profile.desc")})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b",children:[e.jsxs(Ve,{className:"h-24 w-24",children:[e.jsx(Ie,{src:a!=null&&a.profile_picture?Ke(a.profile_picture):void 0}),e.jsxs(Me,{className:"bg-primary text-primary-foreground text-2xl",children:[(xe=a==null?void 0:a.first_name)==null?void 0:xe[0],(pe=a==null?void 0:a.last_name)==null?void 0:pe[0]]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(f,{htmlFor:"profile-picture-upload-student",className:"cursor-pointer",children:e.jsx(n,{variant:"outline",asChild:!0,disabled:Y,className:"w-full sm:w-auto whitespace-normal break-words",children:e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"break-words text-center",children:Y?"Upload en cours...":"Changer la photo de profil"})]})})}),e.jsx(u,{id:"profile-picture-upload-student",type:"file",accept:"image/*",className:"hidden",onChange:Oe,disabled:Y}),he&&e.jsx(es,{open:qe,onClose:()=>{me(!1),Z(null)},imageSrc:he,onCropComplete:Ue,aspectRatio:1,circularCrop:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Formats acceptés: JPG, PNG, WEBP (max 10 MB)"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:r("dashboard.profile.first_name")}),e.jsx("p",{className:"font-medium break-words",children:a==null?void 0:a.first_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:r("dashboard.profile.last_name")}),e.jsx("p",{className:"font-medium break-words",children:a==null?void 0:a.last_name})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:r("dashboard.profile.email")}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"font-medium break-all min-w-0 flex-1",children:a==null?void 0:a.email}),e.jsx(E,{variant:a!=null&&a.email_verified?"default":"secondary",className:"gap-1 flex-shrink-0 whitespace-nowrap",children:a!=null&&a.email_verified?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-3 w-3"}),"Vérifié"]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-3 w-3"}),"Non vérifié"]})})]}),!(a!=null&&a.email_verified)&&e.jsxs(n,{variant:"outline",size:"sm",className:"mt-2 w-full sm:w-auto whitespace-normal break-words",onClick:()=>i(!0),children:[e.jsx(R,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"break-words",children:"Vérifier mon email"})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:r("dashboard.profile.phone")}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"font-medium break-words min-w-0 flex-1",children:(a==null?void 0:a.phone)||r("dashboard.phone.not_provided")}),(a==null?void 0:a.phone)&&e.jsx(E,{variant:a!=null&&a.phone_verified?"default":"secondary",className:"gap-1 flex-shrink-0 whitespace-nowrap",children:a!=null&&a.phone_verified?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-3 w-3"}),"Vérifié"]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-3 w-3"}),"Non vérifié"]})})]}),!(a!=null&&a.phone_verified)&&e.jsxs(n,{variant:"outline",size:"sm",className:"mt-2 w-full sm:w-auto whitespace-normal break-words",onClick:()=>p(!0),children:[e.jsx(Ae,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"break-words",children:a!=null&&a.phone?"Vérifier mon numéro":"Ajouter un numéro"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:r("dashboard.profile.account_type")}),e.jsx(E,{className:"whitespace-nowrap",children:a==null?void 0:a.role})]})]})]})]}),e.jsx(ms,{user:a,updateProfileMutation:oe,changePasswordMutation:Le,onEmailChange:()=>B(!0),onPhoneChange:()=>o(!0)}),e.jsx(ss,{}),e.jsx(as,{open:S,onClose:()=>p(!1),onSuccess:()=>x(),currentPhone:a==null?void 0:a.phone}),e.jsx(rs,{open:D,onClose:()=>i(!1),onSuccess:()=>x(),currentEmail:a==null?void 0:a.email}),e.jsx(ts,{open:b,onClose:()=>B(!1),onSuccess:()=>x(),currentEmail:a==null?void 0:a.email}),e.jsx(is,{open:Q,onClose:()=>o(!1),onSuccess:()=>x(),currentPhone:a==null?void 0:a.phone})]})]})]})})}function ms({user:a,updateProfileMutation:j,changePasswordMutation:g,onEmailChange:x,onPhoneChange:v}){const{t}=Ee(),[r,w]=c.useState(!1),[$,S]=c.useState(!1),[p,D]=c.useState({first_name:(a==null?void 0:a.first_name)||"",last_name:(a==null?void 0:a.last_name)||""}),[i,b]=c.useState({current_password:"",new_password:"",confirm_password:""});c.useEffect(()=>{D({first_name:(a==null?void 0:a.first_name)||"",last_name:(a==null?void 0:a.last_name)||""})},[a]);const B=()=>{j.mutate(p),w(!1)},Q=()=>{i.new_password===i.confirm_password&&(g.mutate({current_password:i.current_password,new_password:i.new_password}),S(!1),b({current_password:"",new_password:"",confirm_password:""}))};return e.jsxs(d,{children:[e.jsxs(A,{children:[e.jsx(F,{children:t("dashboard.profile.settings")}),e.jsx(P,{children:t("dashboard.profile.edit.desc")})]}),e.jsx(h,{children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(ge,{open:r,onOpenChange:w,children:[e.jsx(ve,{asChild:!0,children:e.jsxs(n,{variant:"outline",className:"w-full sm:w-auto whitespace-normal break-words",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-user h-4 w-4 mr-2 flex-shrink-0",children:[e.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),e.jsx("span",{className:"break-words",children:t("dashboard.profile.edit")})]})}),e.jsxs(we,{className:"sm:max-w-md",children:[e.jsxs(Ne,{children:[e.jsx(be,{children:t("dashboard.profile.edit")}),e.jsx(ye,{children:t("dashboard.profile.edit.desc")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"first_name",children:t("dashboard.profile.first_name")}),e.jsx(u,{id:"first_name",value:p.first_name,onChange:o=>D({...p,first_name:o.target.value})})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"last_name",children:t("dashboard.profile.last_name")}),e.jsx(u,{id:"last_name",value:p.last_name,onChange:o=>D({...p,last_name:o.target.value})})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"email",children:"Email"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{id:"email",type:"email",value:(a==null?void 0:a.email)||"",readOnly:!0,className:"flex-1"}),e.jsxs(n,{type:"button",variant:"outline",onClick:()=>{w(!1),x()},children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"Changer"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Pour changer votre email, vous devrez confirmer votre identité avec un code envoyé à votre email actuel."})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"phone",children:t("dashboard.profile.phone")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{id:"phone",type:"tel",value:(a==null?void 0:a.phone)||"",readOnly:!0,className:"flex-1"}),e.jsxs(n,{type:"button",variant:"outline",onClick:()=>{w(!1),v()},children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Changer"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Pour changer votre numéro de téléphone, vous devrez confirmer votre identité avec un code envoyé à votre numéro actuel."})]})]}),e.jsxs(_e,{children:[e.jsx(n,{variant:"outline",onClick:()=>w(!1),children:"Annuler"}),e.jsx(n,{onClick:B,disabled:j.isPending,children:j.isPending?"Enregistrement...":"Enregistrer"})]})]})]}),e.jsxs(ge,{open:$,onOpenChange:S,children:[e.jsx(ve,{asChild:!0,children:e.jsxs(n,{variant:"outline",className:"w-full sm:w-auto whitespace-normal break-words",children:[e.jsx(ds,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"break-words",children:t("dashboard.profile.change_password")})]})}),e.jsxs(we,{className:"sm:max-w-md",children:[e.jsxs(Ne,{children:[e.jsx(be,{children:t("dashboard.profile.change_password")}),e.jsx(ye,{children:t("dashboard.profile.change_password.desc")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"current_password",children:t("dashboard.profile.current_password")}),e.jsx(u,{id:"current_password",type:"password",value:i.current_password,onChange:o=>b({...i,current_password:o.target.value})})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"new_password",children:t("dashboard.profile.new_password")}),e.jsx(u,{id:"new_password",type:"password",value:i.new_password,onChange:o=>b({...i,new_password:o.target.value})})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"confirm_password",children:t("dashboard.profile.confirm_password")}),e.jsx(u,{id:"confirm_password",type:"password",value:i.confirm_password,onChange:o=>b({...i,confirm_password:o.target.value})}),i.new_password&&i.confirm_password&&i.new_password!==i.confirm_password&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:"Les mots de passe ne correspondent pas"})]})]}),e.jsxs(_e,{children:[e.jsx(n,{variant:"outline",onClick:()=>S(!1),children:t("common.cancel")}),e.jsx(n,{onClick:Q,disabled:g.isPending||i.new_password!==i.confirm_password,children:g.isPending?t("dashboard.profile.changing"):t("dashboard.profile.change_password")})]})]})]})]})})]})}export{Is as default};
