import{u as T,b as E,j as e}from"./query-vendor-yCE0qXS-.js";import{u as Ae,r as d,L as A}from"./react-vendor-CvpuY9Ms.js";import{M as Le,e as me,f as Oe,A as Me,b as Ue,n as Re,d as Ke}from"./MainLayout-BNeTwvB_.js";import{P as Ie}from"./slider-D57ejDrc.js";import{h as Ve,a as ze,n as Qe,u as _e,B as i,C as x,g as $e,S as R,d as K,e as I,f as V,b as y,X as Be,s as Ge,c as h,q as p}from"./index-42cH5BrD.js";import{T as He,a as We,b as L,c as O}from"./tabs-DumrchZ7.js";import{B as u}from"./badge-7FXoCMHb.js";import{S as he}from"./separator-Dbciv4m9.js";import{A as Ye,a as Je}from"./alert-DAdm-3vK.js";import{I as j}from"./input-BQfOhgGT.js";import{L as g}from"./label-67qstHpt.js";import{D as pe,a as xe,b as ue,c as fe,d as je,e as ge,f as we}from"./dialog-BnpweDKq.js";import{I as ve,C as Xe,K as Ze,a as es,P as ss,E as as,b as ts,c as rs}from"./KYCVerification-BjJ2Disz.js";import{C as is}from"./credit-card-BDXZeHBZ.js";import{B as Z}from"./building-2-DW-G4Bjl.js";import{F as be}from"./file-text-BpuVBWhj.js";import{U as ns,C as ls}from"./user--iiFN26U.js";import{S as os}from"./square-pen-CpZ785qx.js";import{T as ds}from"./trash-2-HQ9BX0ds.js";import{C as ee}from"./circle-check-Cikh5ACT.js";import{T as Ne}from"./triangle-alert-BVKVwXGT.js";import{P as Ce}from"./phone-B7UcHeEW.js";import{M as cs}from"./mail-Bvu9ZxEU.js";import{L as ms}from"./lock-BKyBGEpi.js";import"./Logo-Bsxlbf95.js";import"./ui-vendor-3oCJfrha.js";import"./heart-CPBaXQta.js";import"./map-pin-D9rKwPG_.js";import"./maximize-DshBwZmY.js";import"./loader-circle-MquGnOeK.js";import"./upload-qSSxL3Iv.js";const ye=Ve("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function Qs(){var de,ce;const{user:a,isAuthenticated:_,isOwner:C,refreshUser:w}=ze(),[,k]=Ae();d.useEffect(()=>{if(!_){k("/login");return}C||((a==null?void 0:a.role)==="admin"?k("/admin/dashboard"):k("/dashboard/student"))},[_,C,a==null?void 0:a.role,k]);const{toast:n}=Qe(),{t}=_e(),[z,v]=d.useState("properties"),[Q,P]=d.useState(!1),[b,S]=d.useState(!1),[l,N]=d.useState(!1),[$,M]=d.useState(!1),{data:m,isLoading:ke,error:B}=T({queryKey:["/properties/my-properties"],queryFn:async()=>{try{const s=await h("GET","/properties/my-properties");return Array.isArray(s)?{properties:s}:s}catch(s){throw console.error("Error fetching properties:",s),s}},staleTime:1e3*60*2,gcTime:1e3*60*10,retry:1}),G=(m==null?void 0:m.properties)||[],{data:se,isLoading:Pe}=T({queryKey:["/requests/received"],queryFn:async()=>{const s=await h("GET","/requests/received");return Array.isArray(s)?s:[]},staleTime:1e3*30,gcTime:1e3*60*5}),H=Array.isArray(se)?se:[],U=E({mutationFn:({id:s,status:r})=>h("PUT",`/requests/${s}`,{status:r}),onMutate:async({id:s,status:r})=>{await p.cancelQueries({queryKey:["/requests/received"]});const o=p.getQueryData(["/requests/received"]);return o&&Array.isArray(o)&&p.setQueryData(["/requests/received"],o.map(f=>f.id===s?{...f,status:r}:f)),{previousRequests:o}},onSuccess:(s,r)=>{r.status==="accepted"?(p.invalidateQueries({queryKey:["/conversations"]}),n({title:"Requête acceptée",description:"Une conversation a été créée automatiquement avec l'étudiant."})):n({title:"Success",description:"Request updated successfully"})},onError:(s,r,o)=>{o!=null&&o.previousRequests&&p.setQueryData(["/requests/received"],o.previousRequests),n({title:"Error",description:s.message,variant:"destructive"})},onSettled:()=>{p.invalidateQueries({queryKey:["/requests/received"]})}}),{data:ae,isLoading:Se}=T({queryKey:["/contracts/my-contracts"],queryFn:async()=>h("GET","/contracts/my-contracts"),select:s=>{const r=s==null?void 0:s.contracts;return Array.isArray(r)?r:[]},staleTime:1e3*60*5,gcTime:1e3*60*15}),W=Array.isArray(ae)?ae:[],{data:F,isLoading:Ee}=T({queryKey:["/conversations"],queryFn:async()=>{const s=await h("GET","/conversations");return Array.isArray(s),s},staleTime:1e3*30,gcTime:1e3*60*5}),Y=Array.isArray(F)?F:(F==null?void 0:F.conversations)||[],{data:c}=T({queryKey:["/contracts/connect/account-status"],queryFn:async()=>h("GET","/contracts/connect/account-status"),staleTime:1e3*60*10,gcTime:1e3*60*30}),q=E({mutationFn:()=>h("POST","/contracts/connect/create-account"),onSuccess:()=>{p.invalidateQueries({queryKey:["/contracts/connect/account-status"]}),n({title:"Account Created",description:"Stripe account created successfully. Please complete the onboarding process."})},onError:s=>{const r=(s==null?void 0:s.message)||"Stripe Account Creation Failed",o=(s==null?void 0:s.details)||(s==null?void 0:s.message)||"Failed to create Stripe account. Please try again.";n({title:r,description:o,variant:"destructive",duration:1e4})}}),D=E({mutationFn:()=>h("POST","/contracts/connect/create-onboarding-link"),onSuccess:s=>{s.url?window.location.href=s.url:n({title:"Error",description:"No onboarding URL received",variant:"destructive"})},onError:s=>{const r=(s==null?void 0:s.details)||(s==null?void 0:s.message)||"Failed to create onboarding link. Please try again.";s!=null&&s.requires_account_creation?n({title:"Account Required",description:"Please create a Stripe account first.",variant:"destructive"}):n({title:"Onboarding Link Failed",description:r,variant:"destructive"})}}),te=async()=>{try{c!=null&&c.has_account||await q.mutateAsync(),D.mutate()}catch(s){console.error("Stripe setup error:",s)}},[J,re]=d.useState(!1),[Fe,ie]=d.useState(!1),[ne,X]=d.useState(null),le=s=>{var f;const r=(f=s.target.files)==null?void 0:f[0];if(!r)return;if(!r.type.startsWith("image/")){n({title:"Erreur",description:"Le fichier doit être une image",variant:"destructive"});return}const o=new FileReader;o.onload=()=>{X(o.result),ie(!0)},o.onerror=()=>{n({title:"Erreur",description:"Erreur lors de la lecture du fichier",variant:"destructive"})},o.readAsDataURL(r)},qe=async s=>{re(!0);try{const r=new File([s],"profile-picture.png",{type:"image/png",lastModified:Date.now()}),f=(await Ge(r)).url;await oe.mutateAsync({profile_picture:f}),n({title:"Succès",description:"Photo de profil mise à jour"})}catch(r){n({title:"Erreur",description:r instanceof Error?r.message:"Erreur lors de l'upload de la photo",variant:"destructive"})}finally{re(!1),X(null)}},De=E({mutationFn:s=>h("DELETE",`/properties/${s}`),onSuccess:()=>{p.invalidateQueries({queryKey:["/properties/my-properties"]})}}),oe=E({mutationFn:s=>h("PUT","/auth/profile",s),onSuccess:async s=>{p.invalidateQueries({queryKey:["/auth/profile"]}),p.invalidateQueries({queryKey:["/auth/user"]}),await w(),n({title:"Succès",description:s.message||"Profil mis à jour avec succès"})},onError:s=>{n({title:"Erreur",description:s.message,variant:"destructive"})}}),Te=E({mutationFn:s=>h("PUT","/auth/profile",{...s}),onSuccess:async s=>{await w(),n({title:"Succès",description:s.message||"Mot de passe modifié avec succès"})},onError:s=>{n({title:"Erreur",description:s.message,variant:"destructive"})}});return e.jsx(Le,{children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2","data-testid":"text-dashboard-title",children:t("dashboard.owner.welcome",{name:(a==null?void 0:a.first_name)||""})}),e.jsx("p",{className:"text-muted-foreground",children:t("dashboard.owner.manage")})]}),c&&!c.onboarding_complete&&e.jsxs(Ye,{className:"mb-6",children:[e.jsx(is,{className:"h-4 w-4"}),e.jsxs(Je,{children:[t("dashboard.stripe.setup"),e.jsx(i,{variant:"ghost",className:"ml-2 p-0 h-auto",onClick:te,disabled:q.isPending||D.isPending,"data-testid":"button-setup-stripe",children:q.isPending||D.isPending?t("dashboard.stripe.setting"):t("dashboard.stripe.setup.button")})]})]}),e.jsxs(He,{value:z,onValueChange:v,className:"space-y-6",children:[e.jsxs(We,{className:"grid w-full grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 lg:w-auto lg:inline-grid gap-1 sm:gap-2",children:[e.jsxs(L,{value:"properties",className:"gap-1 sm:gap-2 text-xs sm:text-sm whitespace-nowrap min-w-0","data-testid":"tab-properties",children:[e.jsx(Z,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate hidden xs:inline",children:t("dashboard.properties")})]}),e.jsxs(L,{value:"requests",className:"gap-1 sm:gap-2 text-xs sm:text-sm whitespace-nowrap min-w-0","data-testid":"tab-requests",children:[e.jsx(ve,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate hidden xs:inline",children:t("dashboard.requests")})]}),e.jsxs(L,{value:"contracts",className:"gap-1 sm:gap-2 text-xs sm:text-sm whitespace-nowrap min-w-0","data-testid":"tab-contracts",children:[e.jsx(be,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate hidden xs:inline",children:t("dashboard.contracts")})]}),e.jsxs(L,{value:"messages",className:"gap-1 sm:gap-2 text-xs sm:text-sm whitespace-nowrap min-w-0","data-testid":"tab-messages",children:[e.jsx(me,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate hidden xs:inline",children:t("dashboard.messages")})]}),e.jsxs(L,{value:"profile",className:"gap-1 sm:gap-2 text-xs sm:text-sm whitespace-nowrap min-w-0","data-testid":"tab-profile",children:[e.jsx(ns,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate hidden xs:inline",children:t("dashboard.profile.title")})]})]}),e.jsxs(O,{value:"properties",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:t("dashboard.properties")}),e.jsx("p",{className:"text-muted-foreground",children:t("dashboard.properties.desc")})]}),e.jsx(A,{href:"/properties/create",children:e.jsxs(i,{"data-testid":"button-add-property",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),t("dashboard.properties.add")]})})]}),B?e.jsxs(x,{className:"p-12 text-center",children:[e.jsx($e,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Erreur de chargement"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:B instanceof Error?B.message:"Impossible de charger les propriétés"}),e.jsx(i,{onClick:()=>window.location.reload(),children:"Recharger la page"})]}):ke?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3].map(s=>e.jsx(R,{className:"h-96 w-full"},s))}):!G||G.length===0?e.jsxs(x,{className:"p-12 text-center",children:[e.jsx(Z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:t("dashboard.properties.empty")}),e.jsx("p",{className:"text-muted-foreground mb-4",children:t("dashboard.properties.empty.desc")}),e.jsx(A,{href:"/properties/create",children:e.jsxs(i,{children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),t("dashboard.properties.empty.button")]})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:G.map(s=>e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{property:s,hideFavoriteButton:!0}),e.jsxs("div",{className:"absolute top-3 right-3 flex gap-2 z-50",children:[e.jsx(A,{href:`/properties/${s.id}/edit`,children:e.jsx(i,{size:"icon",variant:"secondary",className:"bg-background/90 backdrop-blur shadow-md hover:shadow-lg","data-testid":`button-edit-${s.id}`,children:e.jsx(os,{className:"h-4 w-4"})})}),e.jsx(i,{size:"icon",variant:"secondary",className:"bg-background/90 backdrop-blur hover:bg-destructive hover:text-destructive-foreground shadow-md hover:shadow-lg",onClick:()=>{confirm("Are you sure you want to delete this property?")&&De.mutate(s.id)},"data-testid":`button-delete-${s.id}`,children:e.jsx(ds,{className:"h-4 w-4"})})]})]},s.id))})]}),e.jsx(O,{value:"requests",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(K,{children:[e.jsx(I,{children:t("dashboard.requests")}),e.jsx(V,{children:t("dashboard.requests.desc")})]}),e.jsx(y,{children:Pe?e.jsx("div",{className:"space-y-4",children:[1,2].map(s=>e.jsx(R,{className:"h-32 w-full"},s))}):!H||H.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ve,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:t("dashboard.requests.empty")}),e.jsx("p",{className:"text-muted-foreground",children:t("dashboard.requests.empty.desc")})]}):e.jsx("div",{className:"space-y-4",children:H.map(s=>e.jsx(x,{children:e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-lg",children:s.property_title}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["From: ",Oe(s)]}),e.jsxs("p",{className:"text-sm bg-muted p-3 rounded-md",children:['"',s.message,'"']})]}),e.jsx(u,{variant:s.status==="accepted"?"default":s.status==="pending"?"secondary":"destructive",children:s.status})]}),s.status==="pending"&&e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>U.mutate({id:s.id,status:"rejected"}),disabled:U.isPending,children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),t("dashboard.request.reject")]}),e.jsxs(i,{size:"sm",onClick:()=>U.mutate({id:s.id,status:"accepted"}),disabled:U.isPending,children:[e.jsx(ls,{className:"h-4 w-4 mr-2"}),t("dashboard.request.accept")]})]})]})},s.id))})})]})}),e.jsx(O,{value:"contracts",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(K,{children:[e.jsx(I,{children:"Rental Contracts"}),e.jsx(V,{children:"Manage your rental agreements"})]}),e.jsx(y,{children:Se?e.jsx("div",{className:"space-y-4",children:[1,2].map(s=>e.jsx(R,{className:"h-32 w-full"},s))}):!W||W.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(be,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No contracts yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Your rental contracts will appear here"})]}):e.jsx("div",{className:"space-y-4",children:W.map(s=>e.jsx(x,{"data-testid":`card-contract-${s.id}`,children:e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-lg",children:s.property_title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Tenant: ",s.student_deleted_at?`deleted_user_${s.student_id}`:`${s.student_first_name||""} ${s.student_last_name||""}`.trim()]})]}),e.jsx(u,{variant:s.status==="active"?"default":s.status==="pending"?"secondary":"outline",children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("dashboard.contract.rent")}),e.jsxs("p",{className:"font-semibold",children:["CHF ",Number(s.monthly_rent||0).toLocaleString("fr-CH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("dashboard.contract.payout")}),e.jsxs("p",{className:"font-semibold",children:["CHF ",Number(s.owner_payout||0).toLocaleString("fr-CH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("dashboard.contract.duration")}),e.jsxs("p",{className:"font-semibold",children:[new Date(s.start_date).toLocaleDateString()," - ",new Date(s.end_date).toLocaleDateString()]})]})]}),e.jsx(A,{href:`/contracts/${s.id}`,children:e.jsx(i,{variant:"outline",size:"sm",children:t("dashboard.contract.view")})})]})},s.id))})})]})}),e.jsx(O,{value:"messages",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(K,{children:[e.jsx(I,{children:"Conversations"}),e.jsx(V,{children:"Messages with potential tenants"})]}),e.jsx(y,{children:Ee?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(R,{className:"h-20 w-full"},s))}):!Y||Y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(me,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Student inquiries will appear here"})]}):e.jsx("div",{className:"space-y-3",children:Y.map(s=>e.jsx(A,{href:`/messages?conversation=${s.id}`,children:e.jsx(x,{className:"hover-elevate cursor-pointer",children:e.jsxs(y,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-md bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold truncate",children:s.property_title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.other_user_name}),s.last_message&&e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.last_message})]}),s.unread_count&&s.unread_count>0&&e.jsx(u,{variant:"default",children:s.unread_count})]})})},s.id))})})]})}),e.jsxs(O,{value:"profile",className:"space-y-4",children:[e.jsxs(x,{children:[e.jsxs(K,{children:[e.jsx(I,{children:t("dashboard.profile.title")}),e.jsx(V,{children:t("dashboard.profile.desc")})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b",children:[e.jsxs(Me,{className:"h-24 w-24",children:[e.jsx(Ue,{src:a!=null&&a.profile_picture?Re(a.profile_picture):void 0}),e.jsxs(Ke,{className:"bg-primary text-primary-foreground text-2xl",children:[(de=a==null?void 0:a.first_name)==null?void 0:de[0],(ce=a==null?void 0:a.last_name)==null?void 0:ce[0]]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(g,{htmlFor:"profile-picture-upload",className:"cursor-pointer",children:e.jsx(i,{variant:"outline",asChild:!0,disabled:J,className:"w-full sm:w-auto whitespace-normal break-words",children:e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(Xe,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"break-words text-center",children:J?"Upload en cours...":"Changer la photo de profil"})]})})}),e.jsx(j,{id:"profile-picture-upload",type:"file",accept:"image/*",className:"hidden",onChange:le,disabled:J}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Formats acceptés: JPG, PNG, WEBP (max 10 MB)"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t("dashboard.profile.first_name")}),e.jsx("p",{className:"font-medium break-words",children:a==null?void 0:a.first_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t("dashboard.profile.last_name")}),e.jsx("p",{className:"font-medium break-words",children:a==null?void 0:a.last_name})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t("dashboard.profile.email")}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"font-medium break-all min-w-0 flex-1",children:a==null?void 0:a.email}),e.jsx(u,{variant:a!=null&&a.email_verified?"default":"secondary",className:"gap-1 flex-shrink-0 whitespace-nowrap",children:a!=null&&a.email_verified?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-3 w-3"}),"Vérifié"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-3 w-3"}),"Non vérifié"]})})]}),!(a!=null&&a.email_verified)&&e.jsxs(i,{variant:"outline",size:"sm",className:"mt-2 w-full sm:w-auto whitespace-normal break-words",onClick:()=>S(!0),children:[e.jsx(ee,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"break-words",children:"Vérifier mon email"})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t("dashboard.profile.phone")}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"font-medium break-words min-w-0 flex-1",children:(a==null?void 0:a.phone)||t("dashboard.phone.not_provided")}),(a==null?void 0:a.phone)&&e.jsx(u,{variant:a!=null&&a.phone_verified?"default":"secondary",className:"gap-1 flex-shrink-0 whitespace-nowrap",children:a!=null&&a.phone_verified?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-3 w-3"}),"Vérifié"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-3 w-3"}),"Non vérifié"]})})]}),!(a!=null&&a.phone_verified)&&e.jsxs(i,{variant:"outline",size:"sm",className:"mt-2 w-full sm:w-auto whitespace-normal break-words",onClick:()=>P(!0),children:[e.jsx(Ce,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"break-words",children:a!=null&&a.phone?"Vérifier mon numéro":"Ajouter un numéro"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t("dashboard.profile.account_type")}),e.jsx(u,{className:"whitespace-nowrap",children:a==null?void 0:a.role})]})]}),e.jsx(he,{}),e.jsx(hs,{user:a,updateProfileMutation:oe,changePasswordMutation:Te,onPhotoUpload:le,onEmailChange:()=>N(!0),onPhoneChange:()=>M(!0)}),e.jsx(he,{}),c&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Payment Setup"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Stripe Account"}),e.jsx(u,{variant:c.has_account?"default":"secondary",children:c.has_account?"Connected":"Not Connected"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Onboarding"}),e.jsx(u,{variant:c.onboarding_complete?"default":"secondary",children:c.onboarding_complete?"Complete":"Incomplete"})]}),c.payouts_enabled!==void 0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Payouts"}),e.jsx(u,{variant:c.payouts_enabled?"default":"secondary",children:c.payouts_enabled?"Enabled":"Disabled"})]})]}),!c.onboarding_complete&&e.jsx(i,{className:"mt-4",onClick:te,disabled:q.isPending||D.isPending,children:q.isPending||D.isPending?"Setting up...":"Complete Stripe Setup"})]})]})]}),e.jsx(Ze,{})]})]}),ne&&e.jsx(es,{open:Fe,onClose:()=>{ie(!1),X(null)},imageSrc:ne,onCropComplete:qe,aspectRatio:1,circularCrop:!0}),e.jsx(ss,{open:Q,onClose:()=>P(!1),onSuccess:()=>w(),currentPhone:a==null?void 0:a.phone}),e.jsx(as,{open:b,onClose:()=>S(!1),onSuccess:()=>w(),currentEmail:a==null?void 0:a.email}),e.jsx(ts,{open:l,onClose:()=>N(!1),onSuccess:()=>w(),currentEmail:a==null?void 0:a.email}),e.jsx(rs,{open:$,onClose:()=>M(!1),onSuccess:()=>w(),currentPhone:a==null?void 0:a.phone})]})})}function hs({user:a,updateProfileMutation:_,changePasswordMutation:C,onPhotoUpload:w,onEmailChange:k,onPhoneChange:n}){const{t}=_e(),[z,v]=d.useState(!1),[Q,P]=d.useState(!1),[b,S]=d.useState({first_name:(a==null?void 0:a.first_name)||"",last_name:(a==null?void 0:a.last_name)||""}),[l,N]=d.useState({current_password:"",new_password:"",confirm_password:""});d.useState(!1),d.useEffect(()=>{S({first_name:(a==null?void 0:a.first_name)||"",last_name:(a==null?void 0:a.last_name)||""})},[a]);const $=()=>{_.mutate(b),v(!1)},M=()=>{l.new_password===l.confirm_password&&(C.mutate({current_password:l.current_password,new_password:l.new_password}),P(!1),N({current_password:"",new_password:"",confirm_password:""}))};return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-4",children:t("dashboard.profile.settings")}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(pe,{open:z,onOpenChange:v,children:[e.jsx(xe,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full sm:w-auto whitespace-normal break-words",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-user h-4 w-4 mr-2 flex-shrink-0",children:[e.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),e.jsx("span",{className:"break-words",children:t("dashboard.profile.edit")})]})}),e.jsxs(ue,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:t("dashboard.profile.edit")}),e.jsx(ge,{children:t("dashboard.profile.edit.desc")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"first_name",children:t("dashboard.profile.first_name")}),e.jsx(j,{id:"first_name",value:b.first_name,onChange:m=>S({...b,first_name:m.target.value})})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"last_name",children:t("dashboard.profile.last_name")}),e.jsx(j,{id:"last_name",value:b.last_name,onChange:m=>S({...b,last_name:m.target.value})})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"email",children:"Email"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{id:"email",type:"email",value:(a==null?void 0:a.email)||"",readOnly:!0,className:"flex-1"}),e.jsxs(i,{type:"button",variant:"outline",onClick:()=>{v(!1),k()},children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"Changer"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Pour changer votre email, vous devrez confirmer votre identité avec un code envoyé à votre email actuel."})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"phone",children:t("dashboard.profile.phone")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{id:"phone",type:"tel",value:(a==null?void 0:a.phone)||"",readOnly:!0,className:"flex-1"}),e.jsxs(i,{type:"button",variant:"outline",onClick:()=>{v(!1),n()},children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Changer"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Pour changer votre numéro de téléphone, vous devrez confirmer votre identité avec un code envoyé à votre numéro actuel."})]})]}),e.jsxs(we,{children:[e.jsx(i,{variant:"outline",onClick:()=>v(!1),children:t("common.cancel")}),e.jsx(i,{onClick:$,disabled:_.isPending,children:_.isPending?t("dashboard.profile.saving"):t("dashboard.profile.save")})]})]})]}),e.jsxs(pe,{open:Q,onOpenChange:P,children:[e.jsx(xe,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full sm:w-auto whitespace-normal break-words",children:[e.jsx(ms,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"break-words",children:t("dashboard.profile.change_password")})]})}),e.jsxs(ue,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:t("dashboard.profile.change_password")}),e.jsx(ge,{children:t("dashboard.profile.change_password.desc")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"current_password",children:t("dashboard.profile.current_password")}),e.jsx(j,{id:"current_password",type:"password",value:l.current_password,onChange:m=>N({...l,current_password:m.target.value})})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"new_password",children:t("dashboard.profile.new_password")}),e.jsx(j,{id:"new_password",type:"password",value:l.new_password,onChange:m=>N({...l,new_password:m.target.value})})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"confirm_password",children:t("dashboard.profile.confirm_password")}),e.jsx(j,{id:"confirm_password",type:"password",value:l.confirm_password,onChange:m=>N({...l,confirm_password:m.target.value})}),l.new_password&&l.confirm_password&&l.new_password!==l.confirm_password&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:"Passwords do not match"})]})]}),e.jsxs(we,{children:[e.jsx(i,{variant:"outline",onClick:()=>P(!1),children:t("common.cancel")}),e.jsx(i,{onClick:M,disabled:C.isPending||l.new_password!==l.confirm_password,children:C.isPending?t("dashboard.profile.changing"):t("dashboard.profile.change_password")})]})]})]})]})]})})}export{Qs as default};
