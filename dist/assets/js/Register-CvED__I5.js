import{j as e,b as pe}from"./query-vendor-yCE0qXS-.js";import{r as n,u as fe,f as he,L as X}from"./react-vendor-CvpuY9Ms.js";import{u as xe,F as je,a as g,b as C,c as y,d as N,e as k,f as T,t as ve,r as be}from"./schema-O3EbQSGn.js";import{L as ge}from"./Logo-Bsxlbf95.js";import{i as _,a as Ce,C as ye,d as Ne,e as ke,f as Re,b as we,g as Pe,B as Ee,c as Se}from"./index-42cH5BrD.js";import{I as P}from"./input-BQfOhgGT.js";import{n as D,q as F,l as I,r as S,s as V,I as q,J as z,K as B,L as Ie,B as K,M as _e,N as Ae}from"./ui-vendor-3oCJfrha.js";import{a as Le,C as De,U as Fe}from"./user--iiFN26U.js";import{A as Ge,a as Me}from"./alert-DAdm-3vK.js";import{M as Oe}from"./mail-Bvu9ZxEU.js";import{L as Xe}from"./lock-BKyBGEpi.js";import{P as Te}from"./phone-B7UcHeEW.js";import{C as Ve}from"./calendar-BhAecAPr.js";import"./label-67qstHpt.js";var G="Radio",[qe,U]=D(G),[ze,Be]=qe(G),$=n.forwardRef((t,d)=>{const{__scopeRadio:r,name:i,checked:o=!1,required:a,disabled:u,value:l="on",onCheck:f,form:x,...c}=t,[p,m]=n.useState(null),s=F(d,b=>m(b)),h=n.useRef(!1),v=p?x||!!p.closest("form"):!0;return e.jsxs(ze,{scope:r,checked:o,disabled:u,children:[e.jsx(I.button,{type:"button",role:"radio","aria-checked":o,"data-state":Y(o),"data-disabled":u?"":void 0,disabled:u,value:l,...c,ref:s,onClick:S(t.onClick,b=>{o||f==null||f(),v&&(h.current=b.isPropagationStopped(),h.current||b.stopPropagation())})}),v&&e.jsx(Ke,{control:p,bubbles:!h.current,name:i,value:l,checked:o,required:a,disabled:u,form:x,style:{transform:"translateX(-100%)"}})]})});$.displayName=G;var H="RadioIndicator",J=n.forwardRef((t,d)=>{const{__scopeRadio:r,forceMount:i,...o}=t,a=Be(H,r);return e.jsx(V,{present:i||a.checked,children:e.jsx(I.span,{"data-state":Y(a.checked),"data-disabled":a.disabled?"":void 0,...o,ref:d})})});J.displayName=H;var Ke=t=>{const{control:d,checked:r,bubbles:i=!0,...o}=t,a=n.useRef(null),u=q(r),l=z(d);return n.useEffect(()=>{const f=a.current,x=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(x,"checked").set;if(u!==r&&p){const m=new Event("click",{bubbles:i});p.call(f,r),f.dispatchEvent(m)}},[u,r,i]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:r,...o,tabIndex:-1,ref:a,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Y(t){return t?"checked":"unchecked"}var Ue=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],M="RadioGroup",[$e,js]=D(M,[B,U]),W=B(),Q=U(),[He,Je]=$e(M),Z=n.forwardRef((t,d)=>{const{__scopeRadioGroup:r,name:i,defaultValue:o,value:a,required:u=!1,disabled:l=!1,orientation:f,dir:x,loop:c=!0,onValueChange:p,...m}=t,s=W(r),h=Ie(x),[v,b]=K({prop:a,defaultProp:o,onChange:p});return e.jsx(He,{scope:r,name:i,required:u,disabled:l,value:v,onValueChange:b,children:e.jsx(_e,{asChild:!0,...s,orientation:f,dir:h,loop:c,children:e.jsx(I.div,{role:"radiogroup","aria-required":u,"aria-orientation":f,"data-disabled":l?"":void 0,dir:h,...m,ref:d})})})});Z.displayName=M;var ee="RadioGroupItem",se=n.forwardRef((t,d)=>{const{__scopeRadioGroup:r,disabled:i,...o}=t,a=Je(ee,r),u=a.disabled||i,l=W(r),f=Q(r),x=n.useRef(null),c=F(d,x),p=a.value===o.value,m=n.useRef(!1);return n.useEffect(()=>{const s=v=>{Ue.includes(v.key)&&(m.current=!0)},h=()=>m.current=!1;return document.addEventListener("keydown",s),document.addEventListener("keyup",h),()=>{document.removeEventListener("keydown",s),document.removeEventListener("keyup",h)}},[]),e.jsx(Ae,{asChild:!0,...l,focusable:!u,active:p,children:e.jsx($,{disabled:u,required:a.required,checked:p,...f,...o,name:a.name,ref:c,onCheck:()=>a.onValueChange(o.value),onKeyDown:S(s=>{s.key==="Enter"&&s.preventDefault()}),onFocus:S(o.onFocus,()=>{var s;m.current&&((s=x.current)==null||s.click())})})})});se.displayName=ee;var Ye="RadioGroupIndicator",te=n.forwardRef((t,d)=>{const{__scopeRadioGroup:r,...i}=t,o=Q(r);return e.jsx(J,{...o,...i,ref:d})});te.displayName=Ye;var re=Z,ae=se,We=te;const oe=n.forwardRef(({className:t,...d},r)=>e.jsx(re,{className:_("grid gap-2",t),...d,ref:r}));oe.displayName=re.displayName;const L=n.forwardRef(({className:t,...d},r)=>e.jsx(ae,{ref:r,className:_("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...d,children:e.jsx(We,{className:"flex items-center justify-center",children:e.jsx(Le,{className:"h-2.5 w-2.5 fill-current text-current"})})}));L.displayName=ae.displayName;var O="Checkbox",[Qe,vs]=D(O),[Ze,es]=Qe(O),ne=n.forwardRef((t,d)=>{const{__scopeCheckbox:r,name:i,checked:o,defaultChecked:a,required:u,disabled:l,value:f="on",onCheckedChange:x,form:c,...p}=t,[m,s]=n.useState(null),h=F(d,j=>s(j)),v=n.useRef(!1),b=m?c||!!m.closest("form"):!0,[w=!1,A]=K({prop:o,defaultProp:a,onChange:x}),me=n.useRef(w);return n.useEffect(()=>{const j=m==null?void 0:m.form;if(j){const E=()=>A(me.current);return j.addEventListener("reset",E),()=>j.removeEventListener("reset",E)}},[m,A]),e.jsxs(Ze,{scope:r,state:w,disabled:l,children:[e.jsx(I.button,{type:"button",role:"checkbox","aria-checked":R(w)?"mixed":w,"aria-required":u,"data-state":de(w),"data-disabled":l?"":void 0,disabled:l,value:f,...p,ref:h,onKeyDown:S(t.onKeyDown,j=>{j.key==="Enter"&&j.preventDefault()}),onClick:S(t.onClick,j=>{A(E=>R(E)?!0:!E),b&&(v.current=j.isPropagationStopped(),v.current||j.stopPropagation())})}),b&&e.jsx(ss,{control:m,bubbles:!v.current,name:i,value:f,checked:w,required:u,disabled:l,form:c,style:{transform:"translateX(-100%)"},defaultChecked:R(a)?!1:a})]})});ne.displayName=O;var ie="CheckboxIndicator",ce=n.forwardRef((t,d)=>{const{__scopeCheckbox:r,forceMount:i,...o}=t,a=es(ie,r);return e.jsx(V,{present:i||R(a.state)||a.state===!0,children:e.jsx(I.span,{"data-state":de(a.state),"data-disabled":a.disabled?"":void 0,...o,ref:d,style:{pointerEvents:"none",...t.style}})})});ce.displayName=ie;var ss=t=>{const{control:d,checked:r,bubbles:i=!0,defaultChecked:o,...a}=t,u=n.useRef(null),l=q(r),f=z(d);n.useEffect(()=>{const c=u.current,p=window.HTMLInputElement.prototype,s=Object.getOwnPropertyDescriptor(p,"checked").set;if(l!==r&&s){const h=new Event("click",{bubbles:i});c.indeterminate=R(r),s.call(c,R(r)?!1:r),c.dispatchEvent(h)}},[l,r,i]);const x=n.useRef(R(r)?!1:r);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:o??x.current,...a,tabIndex:-1,ref:u,style:{...t.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function R(t){return t==="indeterminate"}function de(t){return R(t)?"indeterminate":t?"checked":"unchecked"}var le=ne,ts=ce;const ue=n.forwardRef(({className:t,...d},r)=>e.jsx(le,{ref:r,className:_("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...d,children:e.jsx(ts,{className:_("flex items-center justify-center text-current"),children:e.jsx(De,{className:"h-4 w-4"})})}));ue.displayName=le.displayName;function bs(){const[,t]=fe(),d=he(),i=new URLSearchParams(d).get("role"),{isAuthenticated:o,user:a}=Ce(),[u,l]=n.useState(""),f=s=>{s.preventDefault(),s.stopPropagation(),t("/cgu")},x=s=>{s.preventDefault(),s.stopPropagation(),t("/privacy")};if(n.useEffect(()=>{o&&a&&(a.role==="admin"?t("/admin/dashboard"):a.role==="student"?t("/dashboard/student"):t("/dashboard/owner"))},[o,a,t]),o&&a)return null;const c=xe({resolver:ve(be),defaultValues:{email:"",password:"",first_name:"",last_name:"",role:i==="owner"?"owner":"student",phone:"",date_of_birth:"",terms_accepted:!1}});n.useEffect(()=>{i&&(i==="student"||i==="owner")&&c.setValue("role",i)},[i,c]);const p=pe({mutationFn:s=>Se("POST","/auth/register",s),onSuccess:(s,h)=>{t(`/verify-email?email=${encodeURIComponent(h.email)}`)},onError:s=>{s.code==="INVALID_PHONE"||s.message.includes("téléphone")?l(s.message):s.message.includes("email")&&s.message.includes("déjà")?l("Cette adresse email est déjà utilisée. Essayez de vous connecter ou utilisez une autre adresse."):s.message.includes("18 ans")?l("Vous devez avoir au moins 18 ans pour créer un compte."):s.message.includes("temporaire")?l("Les adresses email temporaires ou jetables ne sont pas acceptées. Utilisez une adresse email permanente."):l(s.message||"L'inscription a échoué. Veuillez vérifier vos informations et réessayer.")}}),m=s=>{l(""),p.mutate(s)};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted/30 p-4",children:e.jsxs("div",{className:"w-full max-w-2xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(X,{href:"/",children:e.jsx("div",{className:"mb-4 cursor-pointer",children:e.jsx(ge,{iconClassName:"h-8 w-8",textClassName:"text-2xl"})})}),e.jsx("h1",{className:"text-3xl font-bold","data-testid":"text-register-title",children:"Create Your Account"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Join thousands of students and landlords on Hoomy"})]}),e.jsxs(ye,{children:[e.jsxs(Ne,{children:[e.jsx(ke,{children:"Sign Up"}),e.jsx(Re,{children:"Fill in your details to create your account"})]}),e.jsxs(we,{children:[u&&e.jsxs(Ge,{variant:"destructive",className:"mb-4",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx(Me,{children:u})]}),e.jsx(je,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(m),className:"space-y-4",children:[e.jsx(g,{control:c.control,name:"role",render:({field:s})=>e.jsxs(C,{children:[e.jsx(y,{children:"I am a"}),e.jsx(N,{children:e.jsxs(oe,{onValueChange:s.onChange,value:s.value,className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{value:"student",id:"student","data-testid":"radio-student"}),e.jsx("label",{htmlFor:"student",className:"cursor-pointer",children:"Student looking for housing"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{value:"owner",id:"owner","data-testid":"radio-owner"}),e.jsx("label",{htmlFor:"owner",className:"cursor-pointer",children:"Landlord with properties"})]})]})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{control:c.control,name:"first_name",render:({field:s})=>e.jsxs(C,{children:[e.jsx(y,{children:"First Name"}),e.jsx(N,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{...s,placeholder:"John",className:"pl-10","data-testid":"input-firstname"})]})}),e.jsx(k,{})]})}),e.jsx(g,{control:c.control,name:"last_name",render:({field:s})=>e.jsxs(C,{children:[e.jsx(y,{children:"Last Name"}),e.jsx(N,{children:e.jsx(P,{...s,placeholder:"Doe","data-testid":"input-lastname"})}),e.jsx(k,{})]})})]}),e.jsx(g,{control:c.control,name:"email",render:({field:s})=>e.jsxs(C,{children:[e.jsx(y,{children:"Email"}),e.jsx(N,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{...s,type:"email",placeholder:"your.email@example.com",className:"pl-10","data-testid":"input-email"})]})}),e.jsx(k,{})]})}),e.jsx(g,{control:c.control,name:"password",render:({field:s})=>e.jsxs(C,{children:[e.jsx(y,{children:"Password"}),e.jsx(N,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{...s,type:"password",placeholder:"••••••••",className:"pl-10","data-testid":"input-password"})]})}),e.jsx(T,{children:"At least 8 characters"}),e.jsx(k,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{control:c.control,name:"phone",render:({field:s})=>e.jsxs(C,{children:[e.jsx(y,{children:"Téléphone (Optionnel)"}),e.jsx(N,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{...s,placeholder:"+41 76 123 45 67",className:"pl-10","data-testid":"input-phone"})]})}),e.jsx(T,{className:"text-xs",children:"Format suisse: +41 XX XXX XX XX. Le numéro devra être vérifié par SMS."}),e.jsx(k,{})]})}),e.jsx(g,{control:c.control,name:"date_of_birth",render:({field:s})=>e.jsxs(C,{children:[e.jsx(y,{children:"Date of Birth"}),e.jsx(N,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{...s,type:"date",className:"pl-10","data-testid":"input-dob"})]})}),e.jsx(k,{})]})})]}),e.jsx(g,{control:c.control,name:"terms_accepted",render:({field:s})=>e.jsxs(C,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(N,{children:e.jsx(ue,{checked:s.value,onCheckedChange:s.onChange,"data-testid":"checkbox-terms"})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsxs(y,{children:["I accept the"," ",e.jsx("a",{href:"/cgu",className:"text-primary hover:underline",onClick:f,children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"/privacy",className:"text-primary hover:underline",onClick:x,children:"Privacy Policy"})]}),e.jsx(k,{})]})]})}),e.jsx(Ee,{type:"submit",className:"w-full",size:"lg",disabled:p.isPending,"data-testid":"button-submit",children:p.isPending?"Creating account...":"Create Account"})]})}),e.jsx("div",{className:"mt-6 text-center text-sm",children:e.jsxs("p",{className:"text-muted-foreground",children:["Already have an account?"," ",e.jsx(X,{href:"/login",className:"text-primary font-medium hover:underline","data-testid":"link-login",children:"Sign in"})]})})]})]})]})})}export{bs as default};
