import{j as e,b as V,u as G}from"./query-vendor-yCE0qXS-.js";import{r as a,u as Ie,f as He,L as Oe}from"./react-vendor-CvpuY9Ms.js";import{M as Me}from"./MainLayout-BNeTwvB_.js";import{i as we,a as We,u as qe,n as Fe,c as k,C as ue,d as pe,e as he,b as xe,S as fe,B as S,X as ge,q as C}from"./index-42cH5BrD.js";import{T as Ue}from"./textarea-CY0erOeW.js";import{n as Ye,q as X,L as Be,l as K,s as te,r as W,X as M,Y as Xe,W as Ve}from"./ui-vendor-3oCJfrha.js";import{A as Ke,a as $e}from"./alert-DAdm-3vK.js";import{D as Qe,b as Ge,c as Je,d as Ze,e as et,f as tt}from"./dialog-BnpweDKq.js";import{B as oe}from"./building-2-DW-G4Bjl.js";import{A as rt}from"./arrow-left-C-AsHpik.js";import{F as J}from"./file-text-BpuVBWhj.js";import{C as be}from"./user--iiFN26U.js";import{S as st}from"./send-C6nYQK5w.js";import"./Logo-Bsxlbf95.js";function nt(t,s){return a.useReducer((r,l)=>s[r][l]??r,t)}var le="ScrollArea",[ye,_t]=Ye(le),[ot,j]=ye(le),Se=a.forwardRef((t,s)=>{const{__scopeScrollArea:r,type:l="hover",dir:o,scrollHideDelay:c=600,...d}=t,[m,u]=a.useState(null),[i,p]=a.useState(null),[h,x]=a.useState(null),[g,v]=a.useState(null),[q,D]=a.useState(null),[R,N]=a.useState(0),[T,I]=a.useState(0),[A,_]=a.useState(!1),[H,F]=a.useState(!1),b=X(s,z=>u(z)),y=Be(o);return e.jsx(ot,{scope:r,type:l,dir:y,scrollHideDelay:c,scrollArea:m,viewport:i,onViewportChange:p,content:h,onContentChange:x,scrollbarX:g,onScrollbarXChange:v,scrollbarXEnabled:A,onScrollbarXEnabledChange:_,scrollbarY:q,onScrollbarYChange:D,scrollbarYEnabled:H,onScrollbarYEnabledChange:F,onCornerWidthChange:N,onCornerHeightChange:I,children:e.jsx(K.div,{dir:y,...d,ref:b,style:{position:"relative","--radix-scroll-area-corner-width":R+"px","--radix-scroll-area-corner-height":T+"px",...t.style}})})});Se.displayName=le;var je="ScrollAreaViewport",Ne=a.forwardRef((t,s)=>{const{__scopeScrollArea:r,children:l,nonce:o,...c}=t,d=j(je,r),m=a.useRef(null),u=X(s,m,d.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),e.jsx(K.div,{"data-radix-scroll-area-viewport":"",...c,ref:u,style:{overflowX:d.scrollbarXEnabled?"scroll":"hidden",overflowY:d.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:d.onContentChange,style:{minWidth:"100%",display:"table"},children:l})})]})});Ne.displayName=je;var E="ScrollAreaScrollbar",ie=a.forwardRef((t,s)=>{const{forceMount:r,...l}=t,o=j(E,t.__scopeScrollArea),{onScrollbarXEnabledChange:c,onScrollbarYEnabledChange:d}=o,m=t.orientation==="horizontal";return a.useEffect(()=>(m?c(!0):d(!0),()=>{m?c(!1):d(!1)}),[m,c,d]),o.type==="hover"?e.jsx(at,{...l,ref:s,forceMount:r}):o.type==="scroll"?e.jsx(lt,{...l,ref:s,forceMount:r}):o.type==="auto"?e.jsx(Pe,{...l,ref:s,forceMount:r}):o.type==="always"?e.jsx(ce,{...l,ref:s}):null});ie.displayName=E;var at=a.forwardRef((t,s)=>{const{forceMount:r,...l}=t,o=j(E,t.__scopeScrollArea),[c,d]=a.useState(!1);return a.useEffect(()=>{const m=o.scrollArea;let u=0;if(m){const i=()=>{window.clearTimeout(u),d(!0)},p=()=>{u=window.setTimeout(()=>d(!1),o.scrollHideDelay)};return m.addEventListener("pointerenter",i),m.addEventListener("pointerleave",p),()=>{window.clearTimeout(u),m.removeEventListener("pointerenter",i),m.removeEventListener("pointerleave",p)}}},[o.scrollArea,o.scrollHideDelay]),e.jsx(te,{present:r||c,children:e.jsx(Pe,{"data-state":c?"visible":"hidden",...l,ref:s})})}),lt=a.forwardRef((t,s)=>{const{forceMount:r,...l}=t,o=j(E,t.__scopeScrollArea),c=t.orientation==="horizontal",d=se(()=>u("SCROLL_END"),100),[m,u]=nt("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return a.useEffect(()=>{if(m==="idle"){const i=window.setTimeout(()=>u("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(i)}},[m,o.scrollHideDelay,u]),a.useEffect(()=>{const i=o.viewport,p=c?"scrollLeft":"scrollTop";if(i){let h=i[p];const x=()=>{const g=i[p];h!==g&&(u("SCROLL"),d()),h=g};return i.addEventListener("scroll",x),()=>i.removeEventListener("scroll",x)}},[o.viewport,c,u,d]),e.jsx(te,{present:r||m!=="hidden",children:e.jsx(ce,{"data-state":m==="hidden"?"hidden":"visible",...l,ref:s,onPointerEnter:W(t.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:W(t.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),Pe=a.forwardRef((t,s)=>{const r=j(E,t.__scopeScrollArea),{forceMount:l,...o}=t,[c,d]=a.useState(!1),m=t.orientation==="horizontal",u=se(()=>{if(r.viewport){const i=r.viewport.offsetWidth<r.viewport.scrollWidth,p=r.viewport.offsetHeight<r.viewport.scrollHeight;d(m?i:p)}},10);return B(r.viewport,u),B(r.content,u),e.jsx(te,{present:l||c,children:e.jsx(ce,{"data-state":c?"visible":"hidden",...o,ref:s})})}),ce=a.forwardRef((t,s)=>{const{orientation:r="vertical",...l}=t,o=j(E,t.__scopeScrollArea),c=a.useRef(null),d=a.useRef(0),[m,u]=a.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),i=Ae(m.viewport,m.content),p={...l,sizes:m,onSizesChange:u,hasThumb:i>0&&i<1,onThumbChange:x=>c.current=x,onThumbPointerUp:()=>d.current=0,onThumbPointerDown:x=>d.current=x};function h(x,g){return pt(x,d.current,m,g)}return r==="horizontal"?e.jsx(it,{...p,ref:s,onThumbPositionChange:()=>{if(o.viewport&&c.current){const x=o.viewport.scrollLeft,g=ve(x,m,o.dir);c.current.style.transform=`translate3d(${g}px, 0, 0)`}},onWheelScroll:x=>{o.viewport&&(o.viewport.scrollLeft=x)},onDragScroll:x=>{o.viewport&&(o.viewport.scrollLeft=h(x,o.dir))}}):r==="vertical"?e.jsx(ct,{...p,ref:s,onThumbPositionChange:()=>{if(o.viewport&&c.current){const x=o.viewport.scrollTop,g=ve(x,m);c.current.style.transform=`translate3d(0, ${g}px, 0)`}},onWheelScroll:x=>{o.viewport&&(o.viewport.scrollTop=x)},onDragScroll:x=>{o.viewport&&(o.viewport.scrollTop=h(x))}}):null}),it=a.forwardRef((t,s)=>{const{sizes:r,onSizesChange:l,...o}=t,c=j(E,t.__scopeScrollArea),[d,m]=a.useState(),u=a.useRef(null),i=X(s,u,c.onScrollbarXChange);return a.useEffect(()=>{u.current&&m(getComputedStyle(u.current))},[u]),e.jsx(Ee,{"data-orientation":"horizontal",...o,ref:i,sizes:r,style:{bottom:0,left:c.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:c.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":re(r)+"px",...t.style},onThumbPointerDown:p=>t.onThumbPointerDown(p.x),onDragScroll:p=>t.onDragScroll(p.x),onWheelScroll:(p,h)=>{if(c.viewport){const x=c.viewport.scrollLeft+p.deltaX;t.onWheelScroll(x),Le(x,h)&&p.preventDefault()}},onResize:()=>{u.current&&c.viewport&&d&&l({content:c.viewport.scrollWidth,viewport:c.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:ee(d.paddingLeft),paddingEnd:ee(d.paddingRight)}})}})}),ct=a.forwardRef((t,s)=>{const{sizes:r,onSizesChange:l,...o}=t,c=j(E,t.__scopeScrollArea),[d,m]=a.useState(),u=a.useRef(null),i=X(s,u,c.onScrollbarYChange);return a.useEffect(()=>{u.current&&m(getComputedStyle(u.current))},[u]),e.jsx(Ee,{"data-orientation":"vertical",...o,ref:i,sizes:r,style:{top:0,right:c.dir==="ltr"?0:void 0,left:c.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":re(r)+"px",...t.style},onThumbPointerDown:p=>t.onThumbPointerDown(p.y),onDragScroll:p=>t.onDragScroll(p.y),onWheelScroll:(p,h)=>{if(c.viewport){const x=c.viewport.scrollTop+p.deltaY;t.onWheelScroll(x),Le(x,h)&&p.preventDefault()}},onResize:()=>{u.current&&c.viewport&&d&&l({content:c.viewport.scrollHeight,viewport:c.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:ee(d.paddingTop),paddingEnd:ee(d.paddingBottom)}})}})}),[dt,Ce]=ye(E),Ee=a.forwardRef((t,s)=>{const{__scopeScrollArea:r,sizes:l,hasThumb:o,onThumbChange:c,onThumbPointerUp:d,onThumbPointerDown:m,onThumbPositionChange:u,onDragScroll:i,onWheelScroll:p,onResize:h,...x}=t,g=j(E,r),[v,q]=a.useState(null),D=X(s,b=>q(b)),R=a.useRef(null),N=a.useRef(""),T=g.viewport,I=l.content-l.viewport,A=M(p),_=M(u),H=se(h,10);function F(b){if(R.current){const y=b.clientX-R.current.left,z=b.clientY-R.current.top;i({x:y,y:z})}}return a.useEffect(()=>{const b=y=>{const z=y.target;(v==null?void 0:v.contains(z))&&A(y,I)};return document.addEventListener("wheel",b,{passive:!1}),()=>document.removeEventListener("wheel",b,{passive:!1})},[T,v,I,A]),a.useEffect(_,[l,_]),B(v,H),B(g.content,H),e.jsx(dt,{scope:r,scrollbar:v,hasThumb:o,onThumbChange:M(c),onThumbPointerUp:M(d),onThumbPositionChange:_,onThumbPointerDown:M(m),children:e.jsx(K.div,{...x,ref:D,style:{position:"absolute",...x.style},onPointerDown:W(t.onPointerDown,b=>{b.button===0&&(b.target.setPointerCapture(b.pointerId),R.current=v.getBoundingClientRect(),N.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",g.viewport&&(g.viewport.style.scrollBehavior="auto"),F(b))}),onPointerMove:W(t.onPointerMove,F),onPointerUp:W(t.onPointerUp,b=>{const y=b.target;y.hasPointerCapture(b.pointerId)&&y.releasePointerCapture(b.pointerId),document.body.style.webkitUserSelect=N.current,g.viewport&&(g.viewport.style.scrollBehavior=""),R.current=null})})})}),Z="ScrollAreaThumb",Re=a.forwardRef((t,s)=>{const{forceMount:r,...l}=t,o=Ce(Z,t.__scopeScrollArea);return e.jsx(te,{present:r||o.hasThumb,children:e.jsx(mt,{ref:s,...l})})}),mt=a.forwardRef((t,s)=>{const{__scopeScrollArea:r,style:l,...o}=t,c=j(Z,r),d=Ce(Z,r),{onThumbPositionChange:m}=d,u=X(s,h=>d.onThumbChange(h)),i=a.useRef(void 0),p=se(()=>{i.current&&(i.current(),i.current=void 0)},100);return a.useEffect(()=>{const h=c.viewport;if(h){const x=()=>{if(p(),!i.current){const g=ht(h,m);i.current=g,m()}};return m(),h.addEventListener("scroll",x),()=>h.removeEventListener("scroll",x)}},[c.viewport,p,m]),e.jsx(K.div,{"data-state":d.hasThumb?"visible":"hidden",...o,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...l},onPointerDownCapture:W(t.onPointerDownCapture,h=>{const g=h.target.getBoundingClientRect(),v=h.clientX-g.left,q=h.clientY-g.top;d.onThumbPointerDown({x:v,y:q})}),onPointerUp:W(t.onPointerUp,d.onThumbPointerUp)})});Re.displayName=Z;var de="ScrollAreaCorner",Te=a.forwardRef((t,s)=>{const r=j(de,t.__scopeScrollArea),l=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&l?e.jsx(ut,{...t,ref:s}):null});Te.displayName=de;var ut=a.forwardRef((t,s)=>{const{__scopeScrollArea:r,...l}=t,o=j(de,r),[c,d]=a.useState(0),[m,u]=a.useState(0),i=!!(c&&m);return B(o.scrollbarX,()=>{var h;const p=((h=o.scrollbarX)==null?void 0:h.offsetHeight)||0;o.onCornerHeightChange(p),u(p)}),B(o.scrollbarY,()=>{var h;const p=((h=o.scrollbarY)==null?void 0:h.offsetWidth)||0;o.onCornerWidthChange(p),d(p)}),i?e.jsx(K.div,{...l,ref:s,style:{width:c,height:m,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function ee(t){return t?parseInt(t,10):0}function Ae(t,s){const r=t/s;return isNaN(r)?0:r}function re(t){const s=Ae(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,l=(t.scrollbar.size-r)*s;return Math.max(l,18)}function pt(t,s,r,l="ltr"){const o=re(r),c=o/2,d=s||c,m=o-d,u=r.scrollbar.paddingStart+d,i=r.scrollbar.size-r.scrollbar.paddingEnd-m,p=r.content-r.viewport,h=l==="ltr"?[0,p]:[p*-1,0];return _e([u,i],h)(t)}function ve(t,s,r="ltr"){const l=re(s),o=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,c=s.scrollbar.size-o,d=s.content-s.viewport,m=c-l,u=r==="ltr"?[0,d]:[d*-1,0],i=Ve(t,u);return _e([0,d],[0,m])(i)}function _e(t,s){return r=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const l=(s[1]-s[0])/(t[1]-t[0]);return s[0]+l*(r-t[0])}}function Le(t,s){return t>0&&t<s}var ht=(t,s=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},l=0;return function o(){const c={left:t.scrollLeft,top:t.scrollTop},d=r.left!==c.left,m=r.top!==c.top;(d||m)&&s(),r=c,l=window.requestAnimationFrame(o)}(),()=>window.cancelAnimationFrame(l)};function se(t,s){const r=M(t),l=a.useRef(0);return a.useEffect(()=>()=>window.clearTimeout(l.current),[]),a.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(r,s)},[r,s])}function B(t,s){const r=M(s);Xe(()=>{let l=0;if(t){const o=new ResizeObserver(()=>{cancelAnimationFrame(l),l=window.requestAnimationFrame(r)});return o.observe(t),()=>{window.cancelAnimationFrame(l),o.unobserve(t)}}},[t,r])}var ke=Se,xt=Ne,ft=Te;const ae=a.forwardRef(({className:t,children:s,...r},l)=>e.jsxs(ke,{ref:l,className:we("relative overflow-hidden",t),...r,children:[e.jsx(xt,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(De,{}),e.jsx(ft,{})]}));ae.displayName=ke.displayName;const De=a.forwardRef(({className:t,orientation:s="vertical",...r},l)=>e.jsx(ie,{ref:l,orientation:s,className:we("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:e.jsx(Re,{className:"relative flex-1 rounded-full bg-border"})}));De.displayName=ie.displayName;function Lt(){const{user:t,isOwner:s}=We(),{t:r}=qe(),{toast:l}=Fe(),[,o]=Ie(),c=He(),d=new URLSearchParams(c).get("conversation"),m=new URLSearchParams(c).get("property"),u=new URLSearchParams(c).get("owner"),[i,p]=a.useState(d?parseInt(d):null),[h,x]=a.useState(""),[g,v]=a.useState(!1),[q,D]=a.useState(null),R=a.useRef(null),N=a.useRef(null),T=a.useRef(null),I=()=>{if(!N.current)return;let n=N.current.querySelector("[data-radix-scroll-area-viewport]");n||(n=N.current.querySelector(".h-full.w-full")),n||(n=N.current.firstElementChild),n&&(n.scrollTop=n.scrollHeight)},A=V({mutationFn:n=>k("POST","/conversations",n),onSuccess:n=>{p(n.id),C.invalidateQueries({queryKey:["/conversations"]})}}),_=a.useRef(!1);a.useEffect(()=>{!d&&m&&u&&!i&&!A.isPending&&!A.isSuccess&&!_.current&&(_.current=!0,A.mutate({property_id:parseInt(m),owner_id:parseInt(u)})),(!m||!u)&&(_.current=!1)},[d,m,u,i,A]);const{data:H,isLoading:F}=G({queryKey:["/conversations"],queryFn:async()=>{const n=await k("GET","/conversations");return Array.isArray(n)?n:n!=null&&n.conversations&&Array.isArray(n.conversations)?n.conversations:[]},refetchInterval:5e3}),b=Array.isArray(H)?H:[],{data:y,isLoading:z}=G({queryKey:["/messages",i],enabled:!!i,queryFn:async()=>{if(!i)return[];const n=await k("GET",`/messages/${i}`);return Array.isArray(n)?n:n!=null&&n.messages&&Array.isArray(n.messages)?n.messages:[]},refetchInterval:3e3}),O=Array.isArray(y)?y:[],U=V({mutationFn:n=>k("POST","/messages",n),onSuccess:()=>{x(""),C.invalidateQueries({queryKey:["/messages",i]}),C.invalidateQueries({queryKey:["/conversations"]}),setTimeout(()=>{I()},200)}}),Y=a.useRef(null);a.useEffect(()=>(O&&O.length>0&&(Y.current&&clearTimeout(Y.current),Y.current=setTimeout(()=>{I(),Y.current=null},100)),()=>{Y.current&&clearTimeout(Y.current)}),[O]);const me=()=>{!h.trim()||!i||U.mutate({conversation_id:i,content:h})};a.useEffect(()=>{T.current&&(T.current.style.height="auto",T.current.style.height=`${Math.min(T.current.scrollHeight,128)}px`)},[h]);const f=Array.isArray(b)?b.find(n=>n.id===i):void 0,{data:P}=G({queryKey:["/properties",f==null?void 0:f.property_id],enabled:!!(f!=null&&f.property_id)&&!!s,queryFn:async()=>{if(!(f!=null&&f.property_id))throw new Error("Property ID required");return k("GET",`/properties/${f.property_id}`)}}),{data:w}=G({queryKey:["/contracts/by-conversation",i],enabled:!!i,queryFn:async()=>{if(!i)return null;try{return await k("GET",`/contracts/by-conversation/${i}`)}catch{return null}}}),ne=V({mutationFn:async()=>{if(!(f!=null&&f.property_id)||!(f!=null&&f.student_id)||!P)throw new Error("Informations manquantes pour créer le contrat");const n=new Date,L=new Date;L.setFullYear(L.getFullYear()+1);const ze={property_id:f.property_id,student_id:f.student_id,conversation_id:i,monthly_rent:P.price,charges:P.charges||0,start_date:n.toISOString().split("T")[0],end_date:L.toISOString().split("T")[0],deposit_amount:P.price*3};return k("POST","/contracts/propose",ze)},onSuccess:n=>{l({title:"Contrat proposé",description:"Le contrat a été proposé à l'étudiant. Il pourra l'accepter ou le refuser."}),v(!1),C.invalidateQueries({queryKey:["/messages",i]}),C.invalidateQueries({queryKey:["/contracts/by-conversation",i]}),U.mutate({conversation_id:i,content:"J'ai proposé un contrat de location. Vous pouvez le consulter et l'accepter si vous êtes d'accord avec les conditions."})},onError:n=>{l({title:"Erreur",description:n.message||"Impossible de proposer le contrat",variant:"destructive"})}}),$=V({mutationFn:async n=>k("PUT",`/contracts/${n}/accept`,{}),onSuccess:(n,L)=>{l({title:"Contrat accepté",description:"Le contrat a été accepté et est maintenant actif."}),C.invalidateQueries({queryKey:["/messages",i]}),C.invalidateQueries({queryKey:["/contracts/by-conversation",i]}),C.invalidateQueries({queryKey:["/contracts/my-contracts"]}),D(null),U.mutate({conversation_id:i,content:"J'ai accepté le contrat. Merci !"}),o(`/contracts/${L}`)},onError:n=>{l({title:"Erreur",description:n.message||"Impossible d'accepter le contrat",variant:"destructive"})}}),Q=V({mutationFn:async n=>k("PUT",`/contracts/${n}/reject`,{}),onSuccess:()=>{l({title:"Contrat refusé",description:"Le contrat a été refusé."}),C.invalidateQueries({queryKey:["/messages",i]}),C.invalidateQueries({queryKey:["/contracts/by-conversation",i]}),D(null)},onError:n=>{l({title:"Erreur",description:n.message||"Impossible de refuser le contrat",variant:"destructive"})}});return e.jsxs(Me,{children:[e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0 h-[calc(100vh-3.5rem)] sm:h-[calc(100vh-4rem)] md:h-[calc(100vh-5rem)]",children:e.jsx("div",{className:"container mx-auto px-0 sm:px-3 md:px-4 lg:px-6 xl:px-8 py-2 sm:py-4 md:py-6 lg:py-8 flex-1 flex flex-col overflow-hidden min-h-0",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex-1 flex flex-col overflow-hidden w-full min-h-0",children:[e.jsxs("div",{className:i?"mb-2 sm:mb-3 md:mb-4 lg:mb-6 px-3 sm:px-0 flex-shrink-0 hidden md:block":"mb-2 sm:mb-3 md:mb-4 lg:mb-6 px-3 sm:px-0 flex-shrink-0",children:[e.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold mb-0.5 sm:mb-1 md:mb-2","data-testid":"text-page-title",children:r("messages.title")}),e.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm lg:text-base text-muted-foreground",children:r("messages.subtitle")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-0 md:gap-3 lg:gap-4 xl:gap-6 flex-1 min-h-0 overflow-hidden",children:[e.jsxs(ue,{className:i?"md:col-span-1 rounded-none md:rounded-lg h-full flex flex-col overflow-hidden hidden md:flex":"md:col-span-1 rounded-none md:rounded-lg h-full flex flex-col overflow-hidden flex",children:[e.jsx(pe,{className:"px-2.5 sm:px-4 md:px-6 pb-2 sm:pb-3 md:pb-4 flex-shrink-0",children:e.jsx(he,{className:"text-sm sm:text-base md:text-lg",children:r("messages.conversations")})}),e.jsx(xe,{className:"p-0 flex-1 overflow-hidden min-h-0",children:e.jsx(ae,{className:"h-full",children:F?e.jsx("div",{className:"space-y-2 sm:space-y-3 p-2 sm:p-3 md:p-4",children:[1,2,3].map(n=>e.jsx(fe,{className:"h-16 sm:h-20 w-full"},n))}):!b||b.length===0?e.jsxs("div",{className:"text-center py-6 sm:py-8 md:py-12 px-2 sm:px-3 md:px-4",children:[e.jsx(oe,{className:"h-8 w-8 sm:h-10 sm:w-10 md:h-12 md:w-12 text-muted-foreground mx-auto mb-2 sm:mb-3 md:mb-4"}),e.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground",children:r("messages.no_conversations")}),e.jsx(Oe,{href:"/properties",children:e.jsx(S,{variant:"ghost",size:"sm",className:"mt-2 text-[10px] sm:text-xs md:text-sm h-7 sm:h-8 md:h-9","data-testid":"link-browse-properties",children:r("messages.browse")})})]}):e.jsx("div",{className:"space-y-0.5 sm:space-y-1 p-0.5 sm:p-1 md:p-2",children:b.map(n=>e.jsx("button",{onClick:()=>p(n.id),className:i===n.id?"w-full text-left p-2 sm:p-2.5 md:p-3 lg:p-4 rounded-md transition-colors hover-elevate active:scale-[0.98] bg-accent touch-manipulation":"w-full text-left p-2 sm:p-2.5 md:p-3 lg:p-4 rounded-md transition-colors hover-elevate active:scale-[0.98] touch-manipulation","data-testid":`button-conversation-${n.id}`,children:e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3",children:[e.jsx("div",{className:"h-7 w-7 sm:h-8 sm:w-8 md:h-10 md:w-10 rounded-md bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx(oe,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 md:h-5 md:w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsx("h4",{className:"font-semibold truncate text-[11px] sm:text-xs md:text-sm",children:n.property_title}),e.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs text-muted-foreground truncate",children:n.other_user_name}),n.last_message&&e.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs text-muted-foreground mt-0.5 sm:mt-1 break-all line-clamp-2 overflow-hidden",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:n.last_message})]}),n.unread_count&&n.unread_count>0&&e.jsx("div",{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 md:h-5 md:w-5 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-[8px] sm:text-[9px] md:text-[10px] lg:text-xs font-bold flex-shrink-0",children:n.unread_count})]})},n.id))})})})]}),e.jsx(ue,{className:i?"md:col-span-2 rounded-none md:rounded-lg h-full flex flex-col overflow-hidden flex":"md:col-span-2 rounded-none md:rounded-lg h-full flex flex-col overflow-hidden hidden md:flex",children:i?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"border-b px-2.5 sm:px-4 md:px-6 py-2 sm:py-3 md:py-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3",children:[e.jsx(S,{variant:"ghost",size:"icon",className:"md:hidden h-7 w-7 sm:h-8 sm:w-8 -ml-1 sm:-ml-2 touch-manipulation",onClick:()=>p(null),"data-testid":"button-back",children:e.jsx(rt,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(he,{className:"text-xs sm:text-sm md:text-base lg:text-lg truncate","data-testid":"text-conversation-title",children:f==null?void 0:f.property_title}),e.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs lg:text-sm text-muted-foreground truncate",children:f==null?void 0:f.other_user_name})]}),s&&!w&&(f==null?void 0:f.property_id)&&e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>v(!0),className:"hidden sm:flex gap-1.5 sm:gap-2","data-testid":"button-propose-contract",children:[e.jsx(J,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Proposer un contrat"})]}),w&&w.status==="pending"&&!s&&e.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>{D(w.id),$.mutate(w.id)},disabled:$.isPending,className:"text-green-600 hover:text-green-700",children:[e.jsx(be,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Accepter"})]}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>{D(w.id),Q.mutate(w.id)},disabled:Q.isPending,className:"text-red-600 hover:text-red-700",children:[e.jsx(ge,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Refuser"})]})]}),w&&w.status==="active"&&e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>o(`/contracts/${w.id}`),className:"gap-1.5 sm:gap-2",children:[e.jsx(J,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Voir le contrat"})]})]})}),e.jsxs(xe,{className:"p-0 flex flex-col flex-1 overflow-hidden min-h-0",children:[e.jsxs(ae,{ref:N,className:"flex-1 p-1.5 sm:p-2 md:p-3 lg:p-4",children:[z?e.jsx("div",{className:"space-y-2 sm:space-y-3 md:space-y-4",children:[1,2,3].map(n=>e.jsx(fe,{className:"h-12 sm:h-14 md:h-16 w-3/4"},n))}):!O||O.length===0?e.jsx("div",{className:"text-center py-6 sm:py-8 md:py-12",children:e.jsxs("p",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground",children:[r("messages.no_messages")," ",r("messages.start")]})}):e.jsxs("div",{className:"space-y-1.5 sm:space-y-2 md:space-y-3 lg:space-y-4",children:[O.map(n=>{const L=n.sender_id===(t==null?void 0:t.id);return e.jsx("div",{className:L?"flex justify-end w-full min-w-0":"flex justify-start w-full min-w-0","data-testid":`message-${n.id}`,children:e.jsxs("div",{className:L?"max-w-[90%] xs:max-w-[85%] sm:max-w-[80%] md:max-w-[75%] lg:max-w-[70%] rounded-lg p-2 sm:p-2.5 md:p-3 bg-primary text-primary-foreground overflow-hidden min-w-0":"max-w-[90%] xs:max-w-[85%] sm:max-w-[80%] md:max-w-[75%] lg:max-w-[70%] rounded-lg p-2 sm:p-2.5 md:p-3 bg-muted overflow-hidden min-w-0",children:[e.jsx("p",{className:"text-[11px] sm:text-xs md:text-sm whitespace-pre-wrap break-all leading-relaxed",style:{wordBreak:"break-word",overflowWrap:"anywhere",maxWidth:"100%"},children:n.content}),e.jsx("p",{className:L?"text-[9px] sm:text-[10px] md:text-xs mt-0.5 sm:mt-1 text-primary-foreground/70":"text-[9px] sm:text-[10px] md:text-xs mt-0.5 sm:mt-1 text-muted-foreground",children:new Date(n.created_at).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})},n.id)}),e.jsx("div",{ref:R})]}),w&&w.status==="pending"&&e.jsxs(Ke,{className:"m-2 sm:m-3 md:m-4",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx($e,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s?"Contrat proposé en attente":"Contrat proposé - Action requise"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s?"L'étudiant doit accepter ou refuser le contrat.":"Veuillez accepter ou refuser le contrat proposé."})]}),!s&&e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(S,{size:"sm",onClick:()=>$.mutate(w.id),disabled:$.isPending,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Accepter"]}),e.jsxs(S,{size:"sm",variant:"destructive",onClick:()=>Q.mutate(w.id),disabled:Q.isPending,children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Refuser"]})]})]})})]})]}),e.jsxs("div",{className:"border-t p-1.5 sm:p-2 md:p-3 lg:p-4 bg-background flex-shrink-0 space-y-2",children:[s&&!w&&(f==null?void 0:f.property_id)&&e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>v(!0),className:"w-full sm:hidden gap-2","data-testid":"button-propose-contract-mobile",children:[e.jsx(J,{className:"h-4 w-4"}),"Proposer un contrat"]}),e.jsxs("form",{onSubmit:n=>{n.preventDefault(),n.stopPropagation(),me()},className:"flex gap-1 sm:gap-1.5 md:gap-2 items-end",children:[e.jsx(Ue,{ref:T,value:h,onChange:n=>x(n.target.value),placeholder:r("messages.type_message"),disabled:U.isPending,"data-testid":"input-message",className:"text-[13px] sm:text-sm md:text-base min-h-[2.5rem] max-h-[8rem] resize-none flex-1 overflow-y-auto",rows:1,onKeyDown:n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),h.trim()&&!U.isPending&&me())}}),e.jsx(S,{type:"submit",size:"icon",disabled:!h.trim()||U.isPending,"data-testid":"button-send",className:"h-8 w-8 sm:h-9 sm:w-9 md:h-10 md:w-10 flex-shrink-0 touch-manipulation",children:e.jsx(st,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center py-6 sm:py-8 md:py-12 px-3 sm:px-4",children:[e.jsx(oe,{className:"h-10 w-10 sm:h-12 sm:w-12 md:h-16 md:w-16 text-muted-foreground mx-auto mb-2 sm:mb-3 md:mb-4"}),e.jsx("h3",{className:"font-semibold text-sm sm:text-base md:text-lg mb-1 sm:mb-2",children:r("messages.select_conversation")}),e.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground",children:r("messages.select_conversation.desc")})]})})})]})]})})}),e.jsx(Qe,{open:g,onOpenChange:v,children:e.jsxs(Ge,{children:[e.jsxs(Je,{children:[e.jsx(Ze,{children:"Proposer un contrat"}),e.jsx(et,{children:"Un contrat sera automatiquement généré avec les informations de la propriété. L'étudiant pourra l'accepter ou le refuser."})]}),P&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-md",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Détails du contrat"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Loyer mensuel:"})," CHF ",P.price.toLocaleString()]}),P.charges&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Charges:"})," CHF ",P.charges.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Caution:"})," CHF ",(P.price*3).toLocaleString()," (3 mois)"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Durée:"})," 1 an (à partir d'aujourd'hui)"]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Vous pourrez modifier le contrat après sa création si nécessaire."})]}),e.jsxs(tt,{children:[e.jsx(S,{variant:"outline",onClick:()=>v(!1),children:"Annuler"}),e.jsx(S,{onClick:()=>ne.mutate(),disabled:ne.isPending||!P,children:ne.isPending?"Création...":"Proposer le contrat"})]})]})})]})}export{Lt as default};
