import{u as N,b as z,j as e}from"./query-vendor-yCE0qXS-.js";import{g as R,u as B,r as u,L as y}from"./react-vendor-CvpuY9Ms.js";import{u as K,F as $,a as o,b as t,c as l,d as i,e as c,f as G,t as H,g as O}from"./schema-NhfknS2Y.js";import{M as g}from"./MainLayout-DopdQV7D.js";import{a as U,u as k,B as h,C as Q,d as J,e as W,f as X,b as Y,c as b,q as P}from"./index-DjvxG9Nq.js";import{I as x}from"./input-CH6L8naz.js";import{T as Z}from"./textarea-DPfCFQ_z.js";import{S as F,a as S,b as w,c as E,d as p}from"./select-TYBEK_4R.js";import{A as ee,a as re}from"./alert-DMGga0az.js";import{A as se}from"./arrow-left-bb0ZNe41.js";import"./ui-vendor-3oCJfrha.js";import"./label-COPF1EYf.js";import"./Logo-B_O9zLZT.js";import"./user-DRx2jp6U.js";import"./building-2-CEFxqaOP.js";function ge(){const[,m]=R("/properties/:id/edit"),d=m!=null&&m.id?parseInt(m.id):null,[,A]=B(),{isOwner:D}=U(),{getCantonName:I,getCityName:T}=k(),[q,v]=u.useState("");u.useState([]);const[j,L]=u.useState(""),{data:a,isLoading:V}=N({queryKey:[`/properties/${d}`],enabled:!!d&&d>0,queryFn:async()=>{if(!d||d<=0)throw new Error("Invalid property ID");return b("GET",`/properties/${d}`)}}),{data:f}=N({queryKey:["/locations/cantons"],queryFn:async()=>b("GET","/locations/cantons")}),{data:C}=N({queryKey:["/locations/cities",j],enabled:!!j,queryFn:async()=>{if(!j)throw new Error("Canton required");return b("GET",`/locations/cities?canton=${j}`)}}),n=K({resolver:H(O),defaultValues:{title:"",description:"",property_type:"apartment",address:"",city_name:"",postal_code:"",canton_code:"",price:0,rooms:0,bathrooms:0,surface_area:0,available_from:""}});u.useEffect(()=>{a&&(n.reset({title:a.title,description:a.description||"",property_type:a.property_type,address:a.address,city_name:a.city_name,postal_code:a.postal_code,canton_code:a.canton_code,price:a.price,rooms:a.rooms||0,bathrooms:a.bathrooms||0,surface_area:a.surface_area||0,available_from:a.available_from||""}),L(a.canton_code))},[a,n]);const _=z({mutationFn:async r=>b("PUT",`/properties/${d}`,r),onSuccess:()=>{P.invalidateQueries({queryKey:[`/properties/${d}`]}),P.invalidateQueries({queryKey:["/properties/my-properties"]}),A("/dashboard/owner")},onError:r=>{v(r.message||"Failed to update property")}}),M=async r=>{if(v(""),!r.address||!r.city_name||!r.postal_code||!r.canton_code){v("Veuillez remplir tous les champs d'adresse (rue, canton, ville, code postal)");return}const s={...r,rooms:r.rooms||0,bathrooms:r.bathrooms||0,surface_area:r.surface_area||0,available_from:r.available_from||null,status:(a==null?void 0:a.status)||"available"};_.mutate(s)};return D?V?e.jsx(g,{children:e.jsx("div",{className:"container mx-auto px-4 py-16 text-center",children:e.jsx("p",{children:"Loading property details..."})})}):a?e.jsx(g,{children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(y,{href:"/dashboard/owner",children:e.jsxs(h,{variant:"ghost",className:"mb-4",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})}),e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs(Q,{children:[e.jsxs(J,{children:[e.jsx(W,{children:"Edit Property"}),e.jsx(X,{children:"Update your property listing details"})]}),e.jsxs(Y,{children:[q&&e.jsx(ee,{variant:"destructive",className:"mb-4",children:e.jsx(re,{children:q})}),e.jsx($,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(M),className:"space-y-6",children:[e.jsx(o,{control:n.control,name:"title",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Property Title"}),e.jsx(i,{children:e.jsx(x,{...r,placeholder:"Cozy 2-room apartment near university"})}),e.jsx(c,{})]})}),e.jsx(o,{control:n.control,name:"description",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Description"}),e.jsx(i,{children:e.jsx(Z,{...r,placeholder:"Describe your property, amenities, nearby facilities...",rows:6,className:"resize-none","data-testid":"input-description"})}),e.jsx(G,{children:"Minimum 20 caractères avec plusieurs mots séparés par des espaces"}),e.jsx(c,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:n.control,name:"property_type",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Property Type"}),e.jsxs(F,{onValueChange:r.onChange,value:r.value,children:[e.jsx(i,{children:e.jsx(S,{children:e.jsx(w,{})})}),e.jsxs(E,{children:[e.jsx(p,{value:"apartment",children:"Apartment"}),e.jsx(p,{value:"house",children:"House"}),e.jsx(p,{value:"studio",children:"Studio"}),e.jsx(p,{value:"room",children:"Room"}),e.jsx(p,{value:"other",children:"Other"})]})]}),e.jsx(c,{})]})}),e.jsx(o,{control:n.control,name:"price",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Monthly Rent (CHF)"}),e.jsx(i,{children:e.jsx(x,{...r,type:"number",placeholder:"1500",onChange:s=>r.onChange(parseFloat(s.target.value)||0)})}),e.jsx(c,{})]})})]}),e.jsx(o,{control:n.control,name:"address",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Street Address"}),e.jsx(i,{children:e.jsx(x,{...r,placeholder:"Entrez une adresse"})}),e.jsx(c,{})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(o,{control:n.control,name:"canton_code",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Canton"}),e.jsxs(F,{onValueChange:s=>{r.onChange(s),L(s),n.setValue("city_name",""),n.setValue("address","")},value:r.value,children:[e.jsx(i,{children:e.jsx(S,{children:e.jsx(w,{placeholder:"Select"})})}),e.jsx(E,{children:f==null?void 0:f.map(s=>e.jsx(p,{value:s.code,children:I(s)},s.code))})]}),e.jsx(c,{})]})}),e.jsx(o,{control:n.control,name:"city_name",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"City"}),e.jsxs(F,{onValueChange:r.onChange,value:r.value,children:[e.jsx(i,{children:e.jsx(S,{children:e.jsx(w,{placeholder:"Select"})})}),e.jsx(E,{children:C==null?void 0:C.map(s=>e.jsx(p,{value:s.name,children:T(s.name)},s.id))})]}),e.jsx(c,{})]})}),e.jsx(o,{control:n.control,name:"postal_code",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Postal Code"}),e.jsx(i,{children:e.jsx(x,{...r,placeholder:"8001",maxLength:4})}),e.jsx(c,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(o,{control:n.control,name:"rooms",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Rooms"}),e.jsx(i,{children:e.jsx(x,{...r,type:"number",step:"0.5",placeholder:"2.5",onChange:s=>r.onChange(parseFloat(s.target.value)||0)})}),e.jsx(c,{})]})}),e.jsx(o,{control:n.control,name:"bathrooms",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Bathrooms"}),e.jsx(i,{children:e.jsx(x,{...r,type:"number",placeholder:"1",onChange:s=>r.onChange(parseInt(s.target.value)||0)})}),e.jsx(c,{})]})}),e.jsx(o,{control:n.control,name:"surface_area",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Surface (m²)"}),e.jsx(i,{children:e.jsx(x,{...r,type:"number",placeholder:"65",onChange:s=>r.onChange(parseInt(s.target.value)||0)})}),e.jsx(c,{})]})})]}),e.jsx(o,{control:n.control,name:"available_from",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Available From (Optional)"}),e.jsx(i,{children:e.jsx(x,{...r,type:"date"})}),e.jsx(c,{})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(h,{type:"submit",size:"lg",disabled:_.isPending,className:"flex-1",children:_.isPending?"Updating...":"Update Property"}),e.jsx(y,{href:"/dashboard/owner",children:e.jsx(h,{type:"button",variant:"outline",size:"lg",children:"Cancel"})})]})]})})]})]})})]})}):e.jsx(g,{children:e.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Property Not Found"}),e.jsx(y,{href:"/dashboard/owner",children:e.jsx(h,{children:"Back to Dashboard"})})]})}):e.jsx(g,{children:e.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Only property owners can edit listings"}),e.jsx(y,{href:"/",children:e.jsx(h,{children:"Go Home"})})]})})}export{ge as default};
