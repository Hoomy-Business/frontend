import{u as w,b as v,j as e}from"./query-vendor-yCE0qXS-.js";import{u as Ds,r as i,L as Ve}from"./react-vendor-CvpuY9Ms.js";import{M as Ls,a as te,S as Ie,D as Be,h as Ue,i as $e,j as Oe,k as re,l as y,n as Te}from"./MainLayout-CWJzm6Lx.js";import{h as U,a as ks,m as Fs,u as Ts,C as d,b as o,H as Qe,d as _,e as C,f as S,S as ie,B as h,c as m,q as x}from"./index-iWuRHTV7.js";import{B as c}from"./badge-DlT2aOkD.js";import{A as R,a as M}from"./alert-D3SZgpCp.js";import{D as ne,b as le,c as ce,d as de,e as oe,f as me}from"./dialog-htamUzkD.js";import{T as Ee}from"./textarea-DASvhyL0.js";import{L as f}from"./label-D0E_E_5t.js";import{I as Ye}from"./input-DjOsQyli.js";import{S as D,a as L,b as k,c as F,d as a}from"./select-Bxk3Bz_M.js";import{T as Es,a as As,b as K,c as V}from"./tabs-CUSHS3Ay.js";import{U as Ae}from"./users-BFBUsXdC.js";import{F as Pe}from"./file-text-D2J_USjA.js";import{T as ze}from"./triangle-alert-BjVeBxxo.js";import{C as Ge}from"./clock-CiUeHjEY.js";import{M as He}from"./mail-BibQkIwU.js";import{P as Ps}from"./phone-C3Uyl9SW.js";import{C as qs}from"./calendar-DFxuDeKa.js";import{C as T}from"./circle-check-D85g7ApO.js";import{T as ue,L as I}from"./trash-2-C7ybnOsI.js";import{E as B}from"./eye-CJZjtRbv.js";import{C as xe}from"./circle-x-BTm3S9vM.js";import"./Logo-6y9ImIyh.js";import"./ui-vendor-3oCJfrha.js";import"./user-CTEB5HWp.js";import"./building-2-6iAU2-y9.js";const he=U("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);const Rs=U("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const Xe=U("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);const Je=U("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);const je=U("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);function ua(){const{user:Ms,isAuthenticated:$,isAdmin:pe}=ks(),[,ve]=Ds(),{toast:n}=Fs();Ts();const[We,Ze]=i.useState("overview"),[p,fe]=i.useState(null),[es,O]=i.useState(!1),[Q,ge]=i.useState(""),[Y,ss]=i.useState(""),[z,as]=i.useState(""),[G,ts]=i.useState("all"),[H,rs]=i.useState("all"),[X,is]=i.useState("all"),[J,ns]=i.useState("all"),[ls,W]=i.useState(!1),[cs,Z]=i.useState(!1),[ds,b]=i.useState(!1),[t,g]=i.useState(null),[E,Ne]=i.useState(null),[qe,ye]=i.useState("7"),[ee,be]=i.useState(""),[Re,we]=i.useState("24"),[se,_e]=i.useState("");i.useEffect(()=>{if(!$){ve("/login");return}$&&!pe&&(ve("/"),setTimeout(()=>{n({title:"Acc√®s refus√©",description:"Cette page est r√©serv√©e aux administrateurs.",variant:"destructive"})},100))},[$,pe,ve,n]);const{data:j}=w({queryKey:["/admin/kyc/stats"],queryFn:async()=>m("GET","/admin/kyc/stats"),refetchInterval:3e4}),{data:l}=w({queryKey:["/admin/stats"],queryFn:async()=>m("GET","/admin/stats"),refetchInterval:6e4}),{data:Ce,isLoading:os,refetch:Ks}=w({queryKey:["/admin/kyc/pending"],queryFn:async()=>m("GET","/admin/kyc/pending"),refetchInterval:3e4}),{data:A,isLoading:ms}=w({queryKey:["/admin/users"],queryFn:async()=>m("GET","/admin/users"),refetchInterval:3e4}),Me=i.useMemo(()=>{if(!(A!=null&&A.users))return[];let s=A.users;if(Y){const r=Y.toLowerCase();s=s.filter(u=>u.email.toLowerCase().includes(r)||u.first_name.toLowerCase().includes(r)||u.last_name.toLowerCase().includes(r))}return G!=="all"&&(s=s.filter(r=>r.role===G)),s},[A,Y,G]),{data:P,isLoading:us}=w({queryKey:["/admin/properties"],queryFn:async()=>m("GET","/admin/properties"),refetchInterval:3e4}),{data:N,isLoading:xs}=w({queryKey:["/admin/logs",X,J],queryFn:async()=>{const s=new URLSearchParams;X!=="all"&&s.append("action_type",X),J!=="all"&&s.append("target_type",J),s.append("limit","100");const r=s.toString();return m("GET",`/admin/logs${r?`?${r}`:""}`)},refetchInterval:3e4}),Ke=i.useMemo(()=>{if(!(P!=null&&P.properties))return[];let s=P.properties;if(z){const r=z.toLowerCase();s=s.filter(u=>{var Fe;return u.title.toLowerCase().includes(r)||u.address.toLowerCase().includes(r)||((Fe=u.city_name)==null?void 0:Fe.toLowerCase().includes(r))})}return H!=="all"&&(s=s.filter(r=>r.status===H)),s},[P,z,H]),ae=v({mutationFn:s=>m("PUT",`/admin/kyc/${s}/approve`),onSuccess:()=>{n({title:"KYC approuv√©",description:"Le KYC a √©t√© approuv√© avec succ√®s."}),x.invalidateQueries({queryKey:["/admin/kyc/pending"]}),x.invalidateQueries({queryKey:["/admin/kyc/stats"]}),fe(null)},onError:s=>{n({title:"Erreur",description:s.message,variant:"destructive"})}}),q=v({mutationFn:({kycId:s,reason:r})=>m("PUT",`/admin/kyc/${s}/reject`,{reason:r}),onSuccess:()=>{n({title:"KYC rejet√©",description:"Le KYC a √©t√© rejet√© avec succ√®s."}),x.invalidateQueries({queryKey:["/admin/kyc/pending"]}),x.invalidateQueries({queryKey:["/admin/kyc/stats"]}),O(!1),ge(""),fe(null)},onError:s=>{n({title:"Erreur",description:s.message,variant:"destructive"})}}),Se=v({mutationFn:({userId:s,days:r,reason:u})=>m("POST",`/admin/users/${s}/ban`,{days:r,reason:u}),onSuccess:()=>{n({title:"Utilisateur banni",description:"L'utilisateur a √©t√© banni temporairement."}),x.invalidateQueries({queryKey:["/admin/users"]}),x.invalidateQueries({queryKey:["/admin/stats"]}),W(!1),g(null),be(""),ye("7")},onError:s=>{n({title:"Erreur",description:s.message,variant:"destructive"})}}),hs=v({mutationFn:s=>m("POST",`/admin/users/${s}/unban`),onSuccess:()=>{n({title:"Utilisateur d√©banni",description:"L'utilisateur a √©t√© d√©banni avec succ√®s."}),x.invalidateQueries({queryKey:["/admin/users"]})},onError:s=>{n({title:"Erreur",description:s.message,variant:"destructive"})}}),De=v({mutationFn:({userId:s,hours:r,reason:u})=>m("POST",`/admin/users/${s}/mute`,{hours:r,reason:u}),onSuccess:()=>{n({title:"Utilisateur mut√©",description:"L'utilisateur a √©t√© mut√© temporairement."}),x.invalidateQueries({queryKey:["/admin/users"]}),Z(!1),g(null),_e(""),we("24")},onError:s=>{n({title:"Erreur",description:s.message,variant:"destructive"})}}),js=v({mutationFn:s=>m("POST",`/admin/users/${s}/unmute`),onSuccess:()=>{n({title:"Utilisateur d√©mut√©",description:"L'utilisateur a √©t√© d√©mut√© avec succ√®s."}),x.invalidateQueries({queryKey:["/admin/users"]})},onError:s=>{n({title:"Erreur",description:s.message,variant:"destructive"})}}),Le=v({mutationFn:s=>m("DELETE",`/admin/users/${s}`),onSuccess:()=>{n({title:"Utilisateur supprim√©",description:"L'utilisateur a √©t√© supprim√© d√©finitivement.",variant:"destructive"}),x.invalidateQueries({queryKey:["/admin/users"]}),x.invalidateQueries({queryKey:["/admin/stats"]}),b(!1),g(null)},onError:s=>{n({title:"Erreur",description:s.message,variant:"destructive"})}}),ke=v({mutationFn:s=>m("DELETE",`/admin/properties/${s}`),onSuccess:()=>{n({title:"Propri√©t√© supprim√©e",description:"La propri√©t√© a √©t√© supprim√©e d√©finitivement.",variant:"destructive"}),x.invalidateQueries({queryKey:["/admin/properties"]}),x.invalidateQueries({queryKey:["/admin/stats"]}),b(!1),Ne(null)},onError:s=>{n({title:"Erreur",description:s.message,variant:"destructive"})}}),ps=s=>{confirm(`√ätes-vous s√ªr de vouloir approuver le KYC de ${s.first_name} ${s.last_name} ?`)&&ae.mutate(s.id)},vs=s=>{fe(s),O(!0)},fs=()=>{if(p){if(!Q.trim()){n({title:"Raison requise",description:"Veuillez fournir une raison de rejet.",variant:"destructive"});return}q.mutate({kycId:p.id,reason:Q})}},gs=s=>{g(s),W(!0)},Ns=()=>{if(t){if(!ee.trim()){n({title:"Raison requise",description:"Veuillez fournir une raison de bannissement.",variant:"destructive"});return}Se.mutate({userId:t.id,days:parseInt(qe),reason:ee})}},ys=s=>{g(s),Z(!0)},bs=()=>{if(t){if(!se.trim()){n({title:"Raison requise",description:"Veuillez fournir une raison de mute.",variant:"destructive"});return}De.mutate({userId:t.id,hours:parseInt(Re),reason:se})}},ws=s=>{g(s),b(!0)},_s=()=>{t&&Le.mutate(t.id)},Cs=s=>{Ne(s),b(!0)},Ss=()=>{E&&ke.mutate(E.id)};return!$||!pe?null:e.jsx(Ls,{children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(te,{className:"h-8 w-8 text-primary"}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold",children:"Panneau d'Administration"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Gestion compl√®te de la plateforme"})]}),e.jsxs(Es,{value:We,onValueChange:Ze,className:"space-y-6",children:[e.jsxs(As,{className:"grid w-full grid-cols-5",children:[e.jsx(K,{value:"overview",children:"Vue d'ensemble"}),e.jsx(K,{value:"users",children:"Utilisateurs"}),e.jsx(K,{value:"properties",children:"Propri√©t√©s"}),e.jsx(K,{value:"kyc",children:"V√©rifications KYC"}),e.jsx(K,{value:"logs",children:"Logs"})]}),e.jsxs(V,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(d,{children:e.jsxs(o,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Utilisateurs"}),e.jsx("p",{className:"text-2xl font-bold",children:(l==null?void 0:l.total_users)||0})]}),e.jsx(Ae,{className:"h-8 w-8 text-primary"})]}),e.jsxs("div",{className:"mt-4 flex gap-2 text-xs",children:[e.jsxs(c,{variant:"secondary",children:[(l==null?void 0:l.total_students)||0," √©tudiants"]}),e.jsxs(c,{variant:"secondary",children:[(l==null?void 0:l.total_owners)||0," propri√©taires"]})]})]})}),e.jsx(d,{children:e.jsxs(o,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Propri√©t√©s"}),e.jsx("p",{className:"text-2xl font-bold",children:(l==null?void 0:l.total_properties)||0})]}),e.jsx(Qe,{className:"h-8 w-8 text-primary"})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(c,{variant:"default",className:"text-xs",children:[(l==null?void 0:l.active_properties)||0," actives"]})})]})}),e.jsx(d,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Contrats"}),e.jsx("p",{className:"text-2xl font-bold",children:(l==null?void 0:l.total_contracts)||0})]}),e.jsx(Pe,{className:"h-8 w-8 text-primary"})]})})}),j&&e.jsx(d,{children:e.jsxs(o,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"KYC en attente"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:j.stats.pending_count})]}),e.jsx(ze,{className:"h-8 w-8 text-yellow-500"})]}),e.jsxs("div",{className:"mt-4 flex gap-2 text-xs",children:[e.jsxs(c,{variant:"outline",children:[j.stats.approved_count," approuv√©s"]}),e.jsxs(c,{variant:"outline",children:[j.stats.rejected_count," rejet√©s"]})]})]})})]}),e.jsxs(d,{children:[e.jsxs(_,{children:[e.jsx(C,{children:"Activit√© r√©cente"}),e.jsx(S,{children:"Derni√®res actions sur la plateforme"})]}),e.jsx(o,{children:e.jsxs(R,{children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx(M,{children:"Les logs d'activit√© seront disponibles prochainement."})]})})]})]}),e.jsx(V,{value:"users",className:"space-y-6",children:e.jsxs(d,{children:[e.jsxs(_,{children:[e.jsx(C,{children:"Gestion des Utilisateurs"}),e.jsx(S,{children:"Rechercher, filtrer et g√©rer les utilisateurs"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 flex-col sm:flex-row",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ye,{placeholder:"Rechercher par email, nom...",value:Y,onChange:s=>ss(s.target.value),className:"pl-9"})]}),e.jsxs(D,{value:G,onValueChange:ts,children:[e.jsx(L,{className:"w-[180px]",children:e.jsx(k,{placeholder:"Filtrer par r√¥le"})}),e.jsxs(F,{children:[e.jsx(a,{value:"all",children:"Tous les r√¥les"}),e.jsx(a,{value:"student",children:"√âtudiants"}),e.jsx(a,{value:"owner",children:"Propri√©taires"}),e.jsx(a,{value:"admin",children:"Administrateurs"})]})]})]}),ms?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(ie,{className:"h-20 w-full"},s))}):Me.length===0?e.jsxs(R,{children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsx(M,{children:"Aucun utilisateur trouv√©."})]}):e.jsx("div",{className:"space-y-2",children:Me.map(s=>e.jsx(d,{className:"border-2",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h3",{className:"font-semibold",children:[s.first_name," ",s.last_name]}),e.jsx(c,{variant:s.role==="admin"?"default":s.role==="owner"?"secondary":"outline",children:s.role}),s.is_banned&&e.jsxs(c,{variant:"destructive",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),"Banni ",s.banned_until?`jusqu'au ${new Date(s.banned_until).toLocaleDateString("fr-FR")}`:"permanent"]}),s.is_muted&&e.jsxs(c,{variant:"secondary",children:[e.jsx(je,{className:"h-3 w-3 mr-1"}),"Mut√© ",s.muted_until?`jusqu'au ${new Date(s.muted_until).toLocaleDateString("fr-FR")}`:"permanent"]}),s.email_verified&&e.jsxs(c,{variant:"outline",className:"text-green-600",children:[e.jsx(Rs,{className:"h-3 w-3 mr-1"}),"Email v√©rifi√©"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(He,{className:"h-3 w-3"}),s.email]}),s.phone&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ps,{className:"h-3 w-3"}),s.phone]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qs,{className:"h-3 w-3"}),"Inscrit le ",new Date(s.created_at).toLocaleDateString("fr-FR")]})]})]}),e.jsxs(Be,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",children:e.jsx(Xe,{className:"h-4 w-4"})})}),e.jsxs($e,{align:"end",children:[e.jsx(Oe,{children:"Actions"}),e.jsx(re,{}),s.is_banned?e.jsxs(y,{onClick:()=>hs.mutate(s.id),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"D√©bannir"]}):e.jsxs(y,{onClick:()=>gs(s),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Bannir temporairement"]}),s.is_muted?e.jsxs(y,{onClick:()=>js.mutate(s.id),children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"D√©muter"]}):e.jsxs(y,{onClick:()=>ys(s),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Muter temporairement"]}),e.jsx(re,{}),e.jsxs(y,{onClick:()=>ws(s),className:"text-destructive",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Supprimer d√©finitivement"]})]})]})]})})},s.id))})]})]})}),e.jsx(V,{value:"properties",className:"space-y-6",children:e.jsxs(d,{children:[e.jsxs(_,{children:[e.jsx(C,{children:"Gestion des Propri√©t√©s"}),e.jsx(S,{children:"Rechercher, filtrer et g√©rer les propri√©t√©s"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 flex-col sm:flex-row",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ye,{placeholder:"Rechercher par titre, adresse...",value:z,onChange:s=>as(s.target.value),className:"pl-9"})]}),e.jsxs(D,{value:H,onValueChange:rs,children:[e.jsx(L,{className:"w-[180px]",children:e.jsx(k,{placeholder:"Filtrer par statut"})}),e.jsxs(F,{children:[e.jsx(a,{value:"all",children:"Tous les statuts"}),e.jsx(a,{value:"available",children:"Disponible"}),e.jsx(a,{value:"pending",children:"En attente"}),e.jsx(a,{value:"rented",children:"Lou√©"})]})]})]}),us?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(ie,{className:"h-32 w-full"},s))}):Ke.length===0?e.jsxs(R,{children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx(M,{children:"Aucune propri√©t√© trouv√©e."})]}):e.jsx("div",{className:"space-y-4",children:Ke.map(s=>e.jsx(d,{className:"border-2",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ve,{href:`/properties/${s.id}`,children:e.jsx("h3",{className:"font-semibold hover:text-primary cursor-pointer",children:s.title})}),e.jsx(c,{variant:s.status==="available"?"default":s.status==="pending"?"secondary":"outline",children:s.status}),e.jsx(c,{variant:"outline",children:s.property_type})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:[s.address,", ",s.city_name," ",s.postal_code]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("span",{className:"font-semibold text-primary",children:["CHF ",s.price.toLocaleString(),"/mois"]}),s.rooms&&e.jsxs("span",{children:[s.rooms," pi√®ces"]}),s.surface_area&&e.jsxs("span",{children:[s.surface_area," m¬≤"]}),e.jsxs("span",{className:"text-muted-foreground",children:["Cr√©√©e le ",new Date(s.created_at).toLocaleDateString("fr-FR")]})]}),s.first_name&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Propri√©taire: ",s.first_name," ",s.last_name]})]}),e.jsxs(Be,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",children:e.jsx(Xe,{className:"h-4 w-4"})})}),e.jsxs($e,{align:"end",children:[e.jsx(Oe,{children:"Actions"}),e.jsx(re,{}),e.jsx(y,{asChild:!0,children:e.jsxs(Ve,{href:`/properties/${s.id}`,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Voir les d√©tails"]})}),e.jsx(re,{}),e.jsxs(y,{onClick:()=>Cs(s),className:"text-destructive",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Supprimer d√©finitivement"]})]})]})]})})},s.id))})]})]})}),e.jsxs(V,{value:"kyc",className:"space-y-6",children:[j&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(d,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"En attente"}),e.jsx("p",{className:"text-2xl font-bold",children:j.stats.pending_count})]}),e.jsx(ze,{className:"h-8 w-8 text-yellow-500"})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Approuv√©s"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:j.stats.approved_count})]}),e.jsx(T,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Rejet√©s"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:j.stats.rejected_count})]}),e.jsx(xe,{className:"h-8 w-8 text-red-500"})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:j.stats.total_count})]}),e.jsx(te,{className:"h-8 w-8 text-primary"})]})})})]}),e.jsxs(d,{className:"border-2 border-primary/50 bg-primary/5",children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-primary"}),"V√©rifications KYC en Attente"]}),e.jsx(S,{children:"Section s√©curis√©e - V√©rifiez les documents d'identit√© et les selfies"})]}),e.jsx(c,{variant:"outline",className:"border-primary text-primary",children:"üîí S√©curis√©"})]})}),e.jsx(o,{children:os?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(ie,{className:"h-32 w-full"},s))}):!Ce||Ce.kycs.length===0?e.jsxs(R,{children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx(M,{children:"Aucune v√©rification KYC en attente. Tous les KYC ont √©t√© trait√©s."})]}):e.jsx("div",{className:"space-y-6",children:Ce.kycs.map(s=>e.jsxs(d,{className:"border-2",children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(C,{className:"text-lg",children:[s.first_name," ",s.last_name]}),e.jsxs(S,{children:[s.email," ‚Ä¢ ",s.role," ‚Ä¢ Soumis le ",new Date(s.submitted_at).toLocaleDateString("fr-FR")]})]}),e.jsx(c,{variant:"secondary",children:"En attente"})]})}),e.jsxs(o,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{className:"text-sm font-medium mb-2 block",children:"Carte d'identit√© - Recto"}),s.id_card_front_url?e.jsxs("div",{className:"relative border rounded-lg overflow-hidden bg-muted",children:[e.jsx("img",{src:Te(s.id_card_front_url),alt:"Carte d'identit√© recto",className:"w-full h-auto max-h-64 object-contain"}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(c,{variant:"secondary",className:"bg-black/50 text-white",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Recto"]})})]}):e.jsx("div",{className:"border rounded-lg p-8 text-center text-muted-foreground",children:"Image non disponible"})]}),e.jsxs("div",{children:[e.jsx(f,{className:"text-sm font-medium mb-2 block",children:"Carte d'identit√© - Verso"}),s.id_card_back_url?e.jsxs("div",{className:"relative border rounded-lg overflow-hidden bg-muted",children:[e.jsx("img",{src:Te(s.id_card_back_url),alt:"Carte d'identit√© verso",className:"w-full h-auto max-h-64 object-contain"}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(c,{variant:"secondary",className:"bg-black/50 text-white",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Verso"]})})]}):e.jsx("div",{className:"border rounded-lg p-8 text-center text-muted-foreground",children:"Image non disponible"})]}),e.jsxs("div",{children:[e.jsx(f,{className:"text-sm font-medium mb-2 block",children:"Selfie"}),s.selfie_url?e.jsxs("div",{className:"relative border rounded-lg overflow-hidden bg-muted",children:[e.jsx("img",{src:Te(s.selfie_url),alt:"Selfie",className:"w-full h-auto max-h-64 object-contain"}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(c,{variant:"secondary",className:"bg-black/50 text-white",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Selfie"]})})]}):e.jsx("div",{className:"border rounded-lg p-8 text-center text-muted-foreground",children:"Selfie non disponible"})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4 border-t",children:[e.jsxs(h,{variant:"outline",onClick:()=>vs(s),disabled:ae.isPending||q.isPending,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Rejeter"]}),e.jsx(h,{onClick:()=>ps(s),disabled:ae.isPending||q.isPending,className:"bg-green-600 hover:bg-green-700",children:ae.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}),"Approbation..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Approuver"]})})]})]})]},s.id))})})]})]}),e.jsx(V,{value:"logs",className:"space-y-6",children:e.jsxs(d,{children:[e.jsxs(_,{children:[e.jsx(C,{children:"Logs d'Activit√©"}),e.jsx(S,{children:"Historique des actions administratives"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 flex-col sm:flex-row",children:[e.jsxs(D,{value:X,onValueChange:is,children:[e.jsx(L,{className:"w-[200px]",children:e.jsx(k,{placeholder:"Filtrer par action"})}),e.jsxs(F,{children:[e.jsx(a,{value:"all",children:"Toutes les actions"}),e.jsx(a,{value:"kyc_approve",children:"Approbation KYC"}),e.jsx(a,{value:"kyc_reject",children:"Rejet KYC"}),e.jsx(a,{value:"user_ban",children:"Bannissement"}),e.jsx(a,{value:"user_unban",children:"D√©bannissement"}),e.jsx(a,{value:"user_mute",children:"Mute"}),e.jsx(a,{value:"user_unmute",children:"D√©mute"}),e.jsx(a,{value:"user_delete",children:"Suppression utilisateur"}),e.jsx(a,{value:"property_delete",children:"Suppression propri√©t√©"})]})]}),e.jsxs(D,{value:J,onValueChange:ns,children:[e.jsx(L,{className:"w-[180px]",children:e.jsx(k,{placeholder:"Filtrer par type"})}),e.jsxs(F,{children:[e.jsx(a,{value:"all",children:"Tous les types"}),e.jsx(a,{value:"user",children:"Utilisateurs"}),e.jsx(a,{value:"property",children:"Propri√©t√©s"}),e.jsx(a,{value:"kyc",children:"KYC"})]})]})]}),xs?e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(s=>e.jsx(ie,{className:"h-20 w-full"},s))}):!N||N.logs.length===0?e.jsxs(R,{children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx(M,{children:"Aucun log d'activit√© trouv√©."})]}):e.jsxs("div",{className:"space-y-3",children:[N.logs.map(s=>{const r=()=>{switch(s.action_type){case"kyc_approve":return e.jsx(T,{className:"h-4 w-4 text-green-600"});case"kyc_reject":return e.jsx(xe,{className:"h-4 w-4 text-red-600"});case"user_ban":return e.jsx(he,{className:"h-4 w-4 text-red-600"});case"user_unban":return e.jsx(T,{className:"h-4 w-4 text-green-600"});case"user_mute":return e.jsx(je,{className:"h-4 w-4 text-orange-600"});case"user_unmute":return e.jsx(Je,{className:"h-4 w-4 text-green-600"});case"user_delete":case"property_delete":return e.jsx(ue,{className:"h-4 w-4 text-red-600"});default:return e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground"})}},u=()=>({kyc_approve:"Approbation KYC",kyc_reject:"Rejet KYC",user_ban:"Bannissement",user_unban:"D√©bannissement",user_mute:"Mute",user_unmute:"D√©mute",user_delete:"Suppression utilisateur",property_delete:"Suppression propri√©t√©"})[s.action_type]||s.action_type;return e.jsx(d,{className:"border-l-4 border-l-primary",children:e.jsx(o,{className:"p-4",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r(),e.jsx(c,{variant:"outline",children:u()}),e.jsx(c,{variant:"secondary",children:s.target_type})]}),e.jsx("p",{className:"text-sm font-medium mb-1",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-muted-foreground mt-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"h-3 w-3"}),"Admin: ",s.admin_first_name&&s.admin_last_name?`${s.admin_first_name} ${s.admin_last_name}`:s.admin_email||"Inconnu"]}),s.target_name&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),"Cible: ",s.target_name]}),s.target_email&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(He,{className:"h-3 w-3"}),s.target_email]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"h-3 w-3"}),new Date(s.created_at).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),s.ip_address&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"}),"IP: ",s.ip_address]})]}),s.metadata&&Object.keys(s.metadata).length>0&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-xs text-muted-foreground cursor-pointer hover:text-foreground",children:"D√©tails suppl√©mentaires"}),e.jsx("pre",{className:"mt-2 text-xs bg-muted p-2 rounded overflow-auto",children:JSON.stringify(s.metadata,null,2)})]})]})})})},s.id)}),N.total>N.logs.length&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground pt-4",children:["Affichage de ",N.logs.length," sur ",N.total," logs"]})]})]})]})})]}),e.jsx(ne,{open:es,onOpenChange:O,children:e.jsxs(le,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Rejeter le KYC"}),e.jsxs(oe,{children:["Veuillez fournir une raison de rejet pour ",p==null?void 0:p.first_name," ",p==null?void 0:p.last_name]})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{children:[e.jsx(f,{htmlFor:"reject-reason",children:"Raison du rejet *"}),e.jsx(Ee,{id:"reject-reason",value:Q,onChange:s=>ge(s.target.value),placeholder:"Ex: Photo floue, document illisible, selfie ne correspond pas...",rows:4})]})}),e.jsxs(me,{children:[e.jsx(h,{variant:"outline",onClick:()=>{O(!1),ge("")},children:"Annuler"}),e.jsx(h,{variant:"destructive",onClick:fs,disabled:!Q.trim()||q.isPending,children:q.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}),"Rejet en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Rejeter"]})})]})]})}),e.jsx(ne,{open:ls,onOpenChange:W,children:e.jsxs(le,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Bannir un utilisateur"}),e.jsxs(oe,{children:["Bannir temporairement ",t==null?void 0:t.first_name," ",t==null?void 0:t.last_name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"ban-duration",children:"Dur√©e du bannissement (jours) *"}),e.jsxs(D,{value:qe,onValueChange:ye,children:[e.jsx(L,{id:"ban-duration",children:e.jsx(k,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"1",children:"1 jour"}),e.jsx(a,{value:"3",children:"3 jours"}),e.jsx(a,{value:"7",children:"7 jours"}),e.jsx(a,{value:"14",children:"14 jours"}),e.jsx(a,{value:"30",children:"30 jours"}),e.jsx(a,{value:"90",children:"90 jours"}),e.jsx(a,{value:"365",children:"1 an"})]})]})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"ban-reason",children:"Raison du bannissement *"}),e.jsx(Ee,{id:"ban-reason",value:ee,onChange:s=>be(s.target.value),placeholder:"Ex: Comportement inappropri√©, violation des r√®gles...",rows:4})]})]}),e.jsxs(me,{children:[e.jsx(h,{variant:"outline",onClick:()=>{W(!1),be(""),ye("7")},children:"Annuler"}),e.jsx(h,{variant:"destructive",onClick:Ns,disabled:!ee.trim()||Se.isPending,children:Se.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}),"Bannissement en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Bannir"]})})]})]})}),e.jsx(ne,{open:cs,onOpenChange:Z,children:e.jsxs(le,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Muter un utilisateur"}),e.jsxs(oe,{children:["Emp√™cher ",t==null?void 0:t.first_name," ",t==null?void 0:t.last_name," de publier des messages"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"mute-duration",children:"Dur√©e du mute (heures) *"}),e.jsxs(D,{value:Re,onValueChange:we,children:[e.jsx(L,{id:"mute-duration",children:e.jsx(k,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"1",children:"1 heure"}),e.jsx(a,{value:"6",children:"6 heures"}),e.jsx(a,{value:"12",children:"12 heures"}),e.jsx(a,{value:"24",children:"24 heures"}),e.jsx(a,{value:"48",children:"48 heures"}),e.jsx(a,{value:"72",children:"72 heures"}),e.jsx(a,{value:"168",children:"7 jours"})]})]})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"mute-reason",children:"Raison du mute *"}),e.jsx(Ee,{id:"mute-reason",value:se,onChange:s=>_e(s.target.value),placeholder:"Ex: Messages inappropri√©s, spam...",rows:4})]})]}),e.jsxs(me,{children:[e.jsx(h,{variant:"outline",onClick:()=>{Z(!1),_e(""),we("24")},children:"Annuler"}),e.jsx(h,{variant:"secondary",onClick:bs,disabled:!se.trim()||De.isPending,children:De.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}),"Mute en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Muter"]})})]})]})}),e.jsx(ne,{open:ds,onOpenChange:b,children:e.jsxs(le,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Confirmation de suppression"}),e.jsx(oe,{children:t?`√ätes-vous s√ªr de vouloir supprimer d√©finitivement l'utilisateur ${t.first_name} ${t.last_name} ? Cette action est irr√©versible.`:E?`√ätes-vous s√ªr de vouloir supprimer d√©finitivement la propri√©t√© "${E.title}" ? Cette action est irr√©versible.`:"√ätes-vous s√ªr de vouloir effectuer cette action ?"})]}),e.jsxs(me,{children:[e.jsx(h,{variant:"outline",onClick:()=>{b(!1),g(null),Ne(null)},children:"Annuler"}),e.jsx(h,{variant:"destructive",onClick:()=>{t?_s():E&&Ss()},disabled:Le.isPending||ke.isPending,children:Le.isPending||ke.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}),"Suppression en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Supprimer d√©finitivement"]})})]})]})})]})})}export{ua as default};
