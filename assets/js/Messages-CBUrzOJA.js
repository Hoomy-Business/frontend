import{j as t,b as G,u as J}from"./query-vendor-CNIykozp.js";import{r as l,f as ve,L as Se}from"./react-vendor-DdYNpgPf.js";import{M as ye}from"./MainLayout-BqPj5A1Q.js";import{B as X}from"./button-B8zoFJtu.js";import{T as je}from"./textarea-DvNVt3YO.js";import{C as Z,b as ee,c as te,a as re}from"./card-BTGRRs4F.js";import{e as Pe,u as k,l as Ce,f as H,h as O,g as _,W as A,X as Re,U as Ne}from"./ui-vendor-BME24-VV.js";import{c as ne,a as Ee,u as Te,S as oe,b as z,q as Y}from"./index-Co9HXm8e.js";import{B as F}from"./building-2-io5-MBU8.js";import{A as Ae}from"./arrow-left-lrDyw0u-.js";import{S as _e}from"./send-DZ7yWrgz.js";import"./Logo-Bhe2__w3.js";import"./user-70LQggi4.js";function Le(e,r){return l.useReducer((o,a)=>r[o][a]??o,e)}var V="ScrollArea",[le,nt]=Pe(V),[De,w]=le(V),ae=l.forwardRef((e,r)=>{const{__scopeScrollArea:o,type:a="hover",dir:s,scrollHideDelay:i=600,...n}=e,[c,d]=l.useState(null),[f,u]=l.useState(null),[x,h]=l.useState(null),[p,g]=l.useState(null),[R,P]=l.useState(null),[N,v]=l.useState(0),[W,E]=l.useState(0),[S,T]=l.useState(!1),[y,m]=l.useState(!1),b=k(r,L=>d(L)),j=Ce(s);return t.jsx(De,{scope:o,type:a,dir:j,scrollHideDelay:i,scrollArea:c,viewport:f,onViewportChange:u,content:x,onContentChange:h,scrollbarX:p,onScrollbarXChange:g,scrollbarXEnabled:S,onScrollbarXEnabledChange:T,scrollbarY:R,onScrollbarYChange:P,scrollbarYEnabled:y,onScrollbarYEnabledChange:m,onCornerWidthChange:v,onCornerHeightChange:E,children:t.jsx(H.div,{dir:j,...n,ref:b,style:{position:"relative","--radix-scroll-area-corner-width":N+"px","--radix-scroll-area-corner-height":W+"px",...e.style}})})});ae.displayName=V;var ie="ScrollAreaViewport",ce=l.forwardRef((e,r)=>{const{__scopeScrollArea:o,children:a,nonce:s,...i}=e,n=w(ie,o),c=l.useRef(null),d=k(r,c,n.onViewportChange);return t.jsxs(t.Fragment,{children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),t.jsx(H.div,{"data-radix-scroll-area-viewport":"",...i,ref:d,style:{overflowX:n.scrollbarXEnabled?"scroll":"hidden",overflowY:n.scrollbarYEnabled?"scroll":"hidden",...e.style},children:t.jsx("div",{ref:n.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})});ce.displayName=ie;var C="ScrollAreaScrollbar",K=l.forwardRef((e,r)=>{const{forceMount:o,...a}=e,s=w(C,e.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:n}=s,c=e.orientation==="horizontal";return l.useEffect(()=>(c?i(!0):n(!0),()=>{c?i(!1):n(!1)}),[c,i,n]),s.type==="hover"?t.jsx(ke,{...a,ref:r,forceMount:o}):s.type==="scroll"?t.jsx(We,{...a,ref:r,forceMount:o}):s.type==="auto"?t.jsx(de,{...a,ref:r,forceMount:o}):s.type==="always"?t.jsx($,{...a,ref:r}):null});K.displayName=C;var ke=l.forwardRef((e,r)=>{const{forceMount:o,...a}=e,s=w(C,e.__scopeScrollArea),[i,n]=l.useState(!1);return l.useEffect(()=>{const c=s.scrollArea;let d=0;if(c){const f=()=>{window.clearTimeout(d),n(!0)},u=()=>{d=window.setTimeout(()=>n(!1),s.scrollHideDelay)};return c.addEventListener("pointerenter",f),c.addEventListener("pointerleave",u),()=>{window.clearTimeout(d),c.removeEventListener("pointerenter",f),c.removeEventListener("pointerleave",u)}}},[s.scrollArea,s.scrollHideDelay]),t.jsx(O,{present:o||i,children:t.jsx(de,{"data-state":i?"visible":"hidden",...a,ref:r})})}),We=l.forwardRef((e,r)=>{const{forceMount:o,...a}=e,s=w(C,e.__scopeScrollArea),i=e.orientation==="horizontal",n=U(()=>d("SCROLL_END"),100),[c,d]=Le("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return l.useEffect(()=>{if(c==="idle"){const f=window.setTimeout(()=>d("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(f)}},[c,s.scrollHideDelay,d]),l.useEffect(()=>{const f=s.viewport,u=i?"scrollLeft":"scrollTop";if(f){let x=f[u];const h=()=>{const p=f[u];x!==p&&(d("SCROLL"),n()),x=p};return f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[s.viewport,i,d,n]),t.jsx(O,{present:o||c!=="hidden",children:t.jsx($,{"data-state":c==="hidden"?"hidden":"visible",...a,ref:r,onPointerEnter:_(e.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:_(e.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),de=l.forwardRef((e,r)=>{const o=w(C,e.__scopeScrollArea),{forceMount:a,...s}=e,[i,n]=l.useState(!1),c=e.orientation==="horizontal",d=U(()=>{if(o.viewport){const f=o.viewport.offsetWidth<o.viewport.scrollWidth,u=o.viewport.offsetHeight<o.viewport.scrollHeight;n(c?f:u)}},10);return D(o.viewport,d),D(o.content,d),t.jsx(O,{present:a||i,children:t.jsx($,{"data-state":i?"visible":"hidden",...s,ref:r})})}),$=l.forwardRef((e,r)=>{const{orientation:o="vertical",...a}=e,s=w(C,e.__scopeScrollArea),i=l.useRef(null),n=l.useRef(0),[c,d]=l.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),f=xe(c.viewport,c.content),u={...a,sizes:c,onSizesChange:d,hasThumb:f>0&&f<1,onThumbChange:h=>i.current=h,onThumbPointerUp:()=>n.current=0,onThumbPointerDown:h=>n.current=h};function x(h,p){return Be(h,n.current,c,p)}return o==="horizontal"?t.jsx(He,{...u,ref:r,onThumbPositionChange:()=>{if(s.viewport&&i.current){const h=s.viewport.scrollLeft,p=se(h,c,s.dir);i.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:h=>{s.viewport&&(s.viewport.scrollLeft=h)},onDragScroll:h=>{s.viewport&&(s.viewport.scrollLeft=x(h,s.dir))}}):o==="vertical"?t.jsx(ze,{...u,ref:r,onThumbPositionChange:()=>{if(s.viewport&&i.current){const h=s.viewport.scrollTop,p=se(h,c);i.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:h=>{s.viewport&&(s.viewport.scrollTop=h)},onDragScroll:h=>{s.viewport&&(s.viewport.scrollTop=x(h))}}):null}),He=l.forwardRef((e,r)=>{const{sizes:o,onSizesChange:a,...s}=e,i=w(C,e.__scopeScrollArea),[n,c]=l.useState(),d=l.useRef(null),f=k(r,d,i.onScrollbarXChange);return l.useEffect(()=>{d.current&&c(getComputedStyle(d.current))},[d]),t.jsx(ue,{"data-orientation":"horizontal",...s,ref:f,sizes:o,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":B(o)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.x),onDragScroll:u=>e.onDragScroll(u.x),onWheelScroll:(u,x)=>{if(i.viewport){const h=i.viewport.scrollLeft+u.deltaX;e.onWheelScroll(h),be(h,x)&&u.preventDefault()}},onResize:()=>{d.current&&i.viewport&&n&&a({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:M(n.paddingLeft),paddingEnd:M(n.paddingRight)}})}})}),ze=l.forwardRef((e,r)=>{const{sizes:o,onSizesChange:a,...s}=e,i=w(C,e.__scopeScrollArea),[n,c]=l.useState(),d=l.useRef(null),f=k(r,d,i.onScrollbarYChange);return l.useEffect(()=>{d.current&&c(getComputedStyle(d.current))},[d]),t.jsx(ue,{"data-orientation":"vertical",...s,ref:f,sizes:o,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":B(o)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.y),onDragScroll:u=>e.onDragScroll(u.y),onWheelScroll:(u,x)=>{if(i.viewport){const h=i.viewport.scrollTop+u.deltaY;e.onWheelScroll(h),be(h,x)&&u.preventDefault()}},onResize:()=>{d.current&&i.viewport&&n&&a({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:M(n.paddingTop),paddingEnd:M(n.paddingBottom)}})}})}),[Ie,me]=le(C),ue=l.forwardRef((e,r)=>{const{__scopeScrollArea:o,sizes:a,hasThumb:s,onThumbChange:i,onThumbPointerUp:n,onThumbPointerDown:c,onThumbPositionChange:d,onDragScroll:f,onWheelScroll:u,onResize:x,...h}=e,p=w(C,o),[g,R]=l.useState(null),P=k(r,b=>R(b)),N=l.useRef(null),v=l.useRef(""),W=p.viewport,E=a.content-a.viewport,S=A(u),T=A(d),y=U(x,10);function m(b){if(N.current){const j=b.clientX-N.current.left,L=b.clientY-N.current.top;f({x:j,y:L})}}return l.useEffect(()=>{const b=j=>{const L=j.target;(g==null?void 0:g.contains(L))&&S(j,E)};return document.addEventListener("wheel",b,{passive:!1}),()=>document.removeEventListener("wheel",b,{passive:!1})},[W,g,E,S]),l.useEffect(T,[a,T]),D(g,y),D(p.content,y),t.jsx(Ie,{scope:o,scrollbar:g,hasThumb:s,onThumbChange:A(i),onThumbPointerUp:A(n),onThumbPositionChange:T,onThumbPointerDown:A(c),children:t.jsx(H.div,{...h,ref:P,style:{position:"absolute",...h.style},onPointerDown:_(e.onPointerDown,b=>{b.button===0&&(b.target.setPointerCapture(b.pointerId),N.current=g.getBoundingClientRect(),v.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),m(b))}),onPointerMove:_(e.onPointerMove,m),onPointerUp:_(e.onPointerUp,b=>{const j=b.target;j.hasPointerCapture(b.pointerId)&&j.releasePointerCapture(b.pointerId),document.body.style.webkitUserSelect=v.current,p.viewport&&(p.viewport.style.scrollBehavior=""),N.current=null})})})}),I="ScrollAreaThumb",he=l.forwardRef((e,r)=>{const{forceMount:o,...a}=e,s=me(I,e.__scopeScrollArea);return t.jsx(O,{present:o||s.hasThumb,children:t.jsx(Me,{ref:r,...a})})}),Me=l.forwardRef((e,r)=>{const{__scopeScrollArea:o,style:a,...s}=e,i=w(I,o),n=me(I,o),{onThumbPositionChange:c}=n,d=k(r,x=>n.onThumbChange(x)),f=l.useRef(void 0),u=U(()=>{f.current&&(f.current(),f.current=void 0)},100);return l.useEffect(()=>{const x=i.viewport;if(x){const h=()=>{if(u(),!f.current){const p=Ue(x,c);f.current=p,c()}};return c(),x.addEventListener("scroll",h),()=>x.removeEventListener("scroll",h)}},[i.viewport,u,c]),t.jsx(H.div,{"data-state":n.hasThumb?"visible":"hidden",...s,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:_(e.onPointerDownCapture,x=>{const p=x.target.getBoundingClientRect(),g=x.clientX-p.left,R=x.clientY-p.top;n.onThumbPointerDown({x:g,y:R})}),onPointerUp:_(e.onPointerUp,n.onThumbPointerUp)})});he.displayName=I;var Q="ScrollAreaCorner",fe=l.forwardRef((e,r)=>{const o=w(Q,e.__scopeScrollArea),a=!!(o.scrollbarX&&o.scrollbarY);return o.type!=="scroll"&&a?t.jsx(Oe,{...e,ref:r}):null});fe.displayName=Q;var Oe=l.forwardRef((e,r)=>{const{__scopeScrollArea:o,...a}=e,s=w(Q,o),[i,n]=l.useState(0),[c,d]=l.useState(0),f=!!(i&&c);return D(s.scrollbarX,()=>{var x;const u=((x=s.scrollbarX)==null?void 0:x.offsetHeight)||0;s.onCornerHeightChange(u),d(u)}),D(s.scrollbarY,()=>{var x;const u=((x=s.scrollbarY)==null?void 0:x.offsetWidth)||0;s.onCornerWidthChange(u),n(u)}),f?t.jsx(H.div,{...a,ref:r,style:{width:i,height:c,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function M(e){return e?parseInt(e,10):0}function xe(e,r){const o=e/r;return isNaN(o)?0:o}function B(e){const r=xe(e.viewport,e.content),o=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,a=(e.scrollbar.size-o)*r;return Math.max(a,18)}function Be(e,r,o,a="ltr"){const s=B(o),i=s/2,n=r||i,c=s-n,d=o.scrollbar.paddingStart+n,f=o.scrollbar.size-o.scrollbar.paddingEnd-c,u=o.content-o.viewport,x=a==="ltr"?[0,u]:[u*-1,0];return pe([d,f],x)(e)}function se(e,r,o="ltr"){const a=B(r),s=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,i=r.scrollbar.size-s,n=r.content-r.viewport,c=i-a,d=o==="ltr"?[0,n]:[n*-1,0],f=Ne(e,d);return pe([0,n],[0,c])(f)}function pe(e,r){return o=>{if(e[0]===e[1]||r[0]===r[1])return r[0];const a=(r[1]-r[0])/(e[1]-e[0]);return r[0]+a*(o-e[0])}}function be(e,r){return e>0&&e<r}var Ue=(e,r=()=>{})=>{let o={left:e.scrollLeft,top:e.scrollTop},a=0;return function s(){const i={left:e.scrollLeft,top:e.scrollTop},n=o.left!==i.left,c=o.top!==i.top;(n||c)&&r(),o=i,a=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(a)};function U(e,r){const o=A(e),a=l.useRef(0);return l.useEffect(()=>()=>window.clearTimeout(a.current),[]),l.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(o,r)},[o,r])}function D(e,r){const o=A(r);Re(()=>{let a=0;if(e){const s=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(o)});return s.observe(e),()=>{window.cancelAnimationFrame(a),s.unobserve(e)}}},[e,o])}var ge=ae,Xe=ce,Ye=fe;const q=l.forwardRef(({className:e,children:r,...o},a)=>t.jsxs(ge,{ref:a,className:ne("relative overflow-hidden",e),...o,children:[t.jsx(Xe,{className:"h-full w-full rounded-[inherit]",children:r}),t.jsx(we,{}),t.jsx(Ye,{})]}));q.displayName=ge.displayName;const we=l.forwardRef(({className:e,orientation:r="vertical",...o},a)=>t.jsx(K,{ref:a,orientation:r,className:ne("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...o,children:t.jsx(he,{className:"relative flex-1 rounded-full bg-border"})}));we.displayName=K.displayName;function lt(){const{user:e}=Ee(),{t:r}=Te(),o=ve(),a=new URLSearchParams(o).get("conversation"),s=new URLSearchParams(o).get("property"),i=new URLSearchParams(o).get("owner"),[n,c]=l.useState(a?parseInt(a):null),[d,f]=l.useState(""),u=l.useRef(null),x=l.useRef(null),h=l.useRef(null),p=()=>{if(!x.current)return;let m=x.current.querySelector("[data-radix-scroll-area-viewport]");m||(m=x.current.querySelector(".h-full.w-full")),m||(m=x.current.firstElementChild),m&&(m.scrollTop=m.scrollHeight)},g=G({mutationFn:m=>z("POST","/conversations",m),onSuccess:m=>{c(m.id),Y.invalidateQueries({queryKey:["/conversations"]})}}),R=l.useRef(!1);l.useEffect(()=>{!a&&s&&i&&!n&&!g.isPending&&!g.isSuccess&&!R.current&&(R.current=!0,g.mutate({property_id:parseInt(s),owner_id:parseInt(i)})),(!s||!i)&&(R.current=!1)},[a,s,i,n,g]);const{data:P,isLoading:N}=J({queryKey:["/conversations"],queryFn:async()=>z("GET","/conversations"),refetchInterval:5e3}),{data:v,isLoading:W}=J({queryKey:["/messages",n],enabled:!!n,queryFn:async()=>n?z("GET",`/messages/${n}`):[],refetchInterval:3e3}),E=G({mutationFn:m=>z("POST","/messages",m),onSuccess:()=>{f(""),Y.invalidateQueries({queryKey:["/messages",n]}),Y.invalidateQueries({queryKey:["/conversations"]}),setTimeout(()=>{p()},200)}}),S=l.useRef(null);l.useEffect(()=>(v&&v.length>0&&(S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{p(),S.current=null},100)),()=>{S.current&&clearTimeout(S.current)}),[v]);const T=()=>{!d.trim()||!n||E.mutate({conversation_id:n,content:d})};l.useEffect(()=>{h.current&&(h.current.style.height="auto",h.current.style.height=`${Math.min(h.current.scrollHeight,128)}px`)},[d]);const y=P==null?void 0:P.find(m=>m.id===n);return t.jsx(ye,{children:t.jsx("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0 h-[calc(100vh-3.5rem)] sm:h-[calc(100vh-4rem)] md:h-[calc(100vh-5rem)]",children:t.jsx("div",{className:"container mx-auto px-0 sm:px-3 md:px-4 lg:px-6 xl:px-8 py-2 sm:py-4 md:py-6 lg:py-8 flex-1 flex flex-col overflow-hidden min-h-0",children:t.jsxs("div",{className:"max-w-6xl mx-auto flex-1 flex flex-col overflow-hidden w-full min-h-0",children:[t.jsxs("div",{className:n?"mb-2 sm:mb-3 md:mb-4 lg:mb-6 px-3 sm:px-0 flex-shrink-0 hidden md:block":"mb-2 sm:mb-3 md:mb-4 lg:mb-6 px-3 sm:px-0 flex-shrink-0",children:[t.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold mb-0.5 sm:mb-1 md:mb-2","data-testid":"text-page-title",children:r("messages.title")}),t.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm lg:text-base text-muted-foreground",children:r("messages.subtitle")})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-0 md:gap-3 lg:gap-4 xl:gap-6 flex-1 min-h-0 overflow-hidden",children:[t.jsxs(Z,{className:n?"md:col-span-1 rounded-none md:rounded-lg h-full flex flex-col overflow-hidden hidden md:flex":"md:col-span-1 rounded-none md:rounded-lg h-full flex flex-col overflow-hidden flex",children:[t.jsx(ee,{className:"px-2.5 sm:px-4 md:px-6 pb-2 sm:pb-3 md:pb-4 flex-shrink-0",children:t.jsx(te,{className:"text-sm sm:text-base md:text-lg",children:r("messages.conversations")})}),t.jsx(re,{className:"p-0 flex-1 overflow-hidden min-h-0",children:t.jsx(q,{className:"h-full",children:N?t.jsx("div",{className:"space-y-2 sm:space-y-3 p-2 sm:p-3 md:p-4",children:[1,2,3].map(m=>t.jsx(oe,{className:"h-16 sm:h-20 w-full"},m))}):!P||P.length===0?t.jsxs("div",{className:"text-center py-6 sm:py-8 md:py-12 px-2 sm:px-3 md:px-4",children:[t.jsx(F,{className:"h-8 w-8 sm:h-10 sm:w-10 md:h-12 md:w-12 text-muted-foreground mx-auto mb-2 sm:mb-3 md:mb-4"}),t.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground",children:r("messages.no_conversations")}),t.jsx(Se,{href:"/properties",children:t.jsx(X,{variant:"ghost",size:"sm",className:"mt-2 text-[10px] sm:text-xs md:text-sm h-7 sm:h-8 md:h-9","data-testid":"link-browse-properties",children:r("messages.browse")})})]}):t.jsx("div",{className:"space-y-0.5 sm:space-y-1 p-0.5 sm:p-1 md:p-2",children:P.map(m=>t.jsx("button",{onClick:()=>c(m.id),className:n===m.id?"w-full text-left p-2 sm:p-2.5 md:p-3 lg:p-4 rounded-md transition-colors hover-elevate active:scale-[0.98] bg-accent touch-manipulation":"w-full text-left p-2 sm:p-2.5 md:p-3 lg:p-4 rounded-md transition-colors hover-elevate active:scale-[0.98] touch-manipulation","data-testid":`button-conversation-${m.id}`,children:t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3",children:[t.jsx("div",{className:"h-7 w-7 sm:h-8 sm:w-8 md:h-10 md:w-10 rounded-md bg-muted flex items-center justify-center flex-shrink-0",children:t.jsx(F,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 md:h-5 md:w-5 text-muted-foreground"})}),t.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[t.jsx("h4",{className:"font-semibold truncate text-[11px] sm:text-xs md:text-sm",children:m.property_title}),t.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs text-muted-foreground truncate",children:m.other_user_name}),m.last_message&&t.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs text-muted-foreground mt-0.5 sm:mt-1 break-all line-clamp-2 overflow-hidden",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:m.last_message})]}),m.unread_count&&m.unread_count>0&&t.jsx("div",{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 md:h-5 md:w-5 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-[8px] sm:text-[9px] md:text-[10px] lg:text-xs font-bold flex-shrink-0",children:m.unread_count})]})},m.id))})})})]}),t.jsx(Z,{className:n?"md:col-span-2 rounded-none md:rounded-lg h-full flex flex-col overflow-hidden flex":"md:col-span-2 rounded-none md:rounded-lg h-full flex flex-col overflow-hidden hidden md:flex",children:n?t.jsxs(t.Fragment,{children:[t.jsx(ee,{className:"border-b px-2.5 sm:px-4 md:px-6 py-2 sm:py-3 md:py-4 flex-shrink-0",children:t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3",children:[t.jsx(X,{variant:"ghost",size:"icon",className:"md:hidden h-7 w-7 sm:h-8 sm:w-8 -ml-1 sm:-ml-2 touch-manipulation",onClick:()=>c(null),"data-testid":"button-back",children:t.jsx(Ae,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx(te,{className:"text-xs sm:text-sm md:text-base lg:text-lg truncate","data-testid":"text-conversation-title",children:y==null?void 0:y.property_title}),t.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs lg:text-sm text-muted-foreground truncate",children:y==null?void 0:y.other_user_name})]})]})}),t.jsxs(re,{className:"p-0 flex flex-col flex-1 overflow-hidden min-h-0",children:[t.jsx(q,{ref:x,className:"flex-1 p-1.5 sm:p-2 md:p-3 lg:p-4",children:W?t.jsx("div",{className:"space-y-2 sm:space-y-3 md:space-y-4",children:[1,2,3].map(m=>t.jsx(oe,{className:"h-12 sm:h-14 md:h-16 w-3/4"},m))}):!v||v.length===0?t.jsx("div",{className:"text-center py-6 sm:py-8 md:py-12",children:t.jsxs("p",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground",children:[r("messages.no_messages")," ",r("messages.start")]})}):t.jsxs("div",{className:"space-y-1.5 sm:space-y-2 md:space-y-3 lg:space-y-4",children:[v.map(m=>{const b=m.sender_id===(e==null?void 0:e.id);return t.jsx("div",{className:b?"flex justify-end w-full min-w-0":"flex justify-start w-full min-w-0","data-testid":`message-${m.id}`,children:t.jsxs("div",{className:b?"max-w-[90%] xs:max-w-[85%] sm:max-w-[80%] md:max-w-[75%] lg:max-w-[70%] rounded-lg p-2 sm:p-2.5 md:p-3 bg-primary text-primary-foreground overflow-hidden min-w-0":"max-w-[90%] xs:max-w-[85%] sm:max-w-[80%] md:max-w-[75%] lg:max-w-[70%] rounded-lg p-2 sm:p-2.5 md:p-3 bg-muted overflow-hidden min-w-0",children:[t.jsx("p",{className:"text-[11px] sm:text-xs md:text-sm whitespace-pre-wrap break-all leading-relaxed",style:{wordBreak:"break-word",overflowWrap:"anywhere",maxWidth:"100%"},children:m.content}),t.jsx("p",{className:b?"text-[9px] sm:text-[10px] md:text-xs mt-0.5 sm:mt-1 text-primary-foreground/70":"text-[9px] sm:text-[10px] md:text-xs mt-0.5 sm:mt-1 text-muted-foreground",children:new Date(m.created_at).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})},m.id)}),t.jsx("div",{ref:u})]})}),t.jsx("div",{className:"border-t p-1.5 sm:p-2 md:p-3 lg:p-4 bg-background flex-shrink-0",children:t.jsxs("form",{onSubmit:m=>{m.preventDefault(),m.stopPropagation(),T()},className:"flex gap-1 sm:gap-1.5 md:gap-2 items-end",children:[t.jsx(je,{ref:h,value:d,onChange:m=>f(m.target.value),placeholder:r("messages.type_message"),disabled:E.isPending,"data-testid":"input-message",className:"text-[13px] sm:text-sm md:text-base min-h-[2.5rem] max-h-[8rem] resize-none flex-1 overflow-y-auto",rows:1,onKeyDown:m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),d.trim()&&!E.isPending&&T())}}),t.jsx(X,{type:"submit",size:"icon",disabled:!d.trim()||E.isPending,"data-testid":"button-send",className:"h-8 w-8 sm:h-9 sm:w-9 md:h-10 md:w-10 flex-shrink-0 touch-manipulation",children:t.jsx(_e,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]})})]})]}):t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("div",{className:"text-center py-6 sm:py-8 md:py-12 px-3 sm:px-4",children:[t.jsx(F,{className:"h-10 w-10 sm:h-12 sm:w-12 md:h-16 md:w-16 text-muted-foreground mx-auto mb-2 sm:mb-3 md:mb-4"}),t.jsx("h3",{className:"font-semibold text-sm sm:text-base md:text-lg mb-1 sm:mb-2",children:r("messages.select_conversation")}),t.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground",children:r("messages.select_conversation.desc")})]})})})]})]})})})})}export{lt as default};
