import{b as u,j as e}from"./query-vendor-CNIykozp.js";import{u as w,f as P,r as c,L as k}from"./react-vendor-DdYNpgPf.js";import{u as L,F as M,a as x,b as h,c as f,d as j,e as p,t as R,v as A}from"./schema-Dj5CwbO7.js";import{B as b}from"./button-B-ZelJyK.js";import{I as g}from"./input-CHDUk6Su.js";import{C as B,b as T,c as D,d as I,a as H}from"./card-ChNshBDf.js";import{A as v,a as N}from"./alert-OxPXOA7-.js";import{a as O,b as y}from"./index-BSTG6X_D.js";import{B as q}from"./building-2-D677uz5C.js";import{C as z}from"./circle-alert-8bZ1axar.js";import{C as U}from"./circle-check-DrcCniBI.js";import{M as W}from"./mail-C3nBzua8.js";import"./ui-vendor-BME24-VV.js";import"./label-U3gdjbGY.js";function ne(){const[,i]=w(),C=P(),a=new URLSearchParams(C).get("email")||"",{login:S}=O(),[d,r]=c.useState(""),[E,n]=c.useState(!1),t=L({resolver:R(A),defaultValues:{email:a,code:""}});c.useEffect(()=>{a&&t.setValue("email",a)},[a,t]);const o=u({mutationFn:s=>y("POST","/auth/verify-email",s),onSuccess:s=>{S(s.token,s.user);const m=s.user.role;i(m==="admin"?"/admin/dashboard":m==="student"?"/dashboard/student":"/dashboard/owner")},onError:s=>{r(s.message||"Verification failed. Please check your code.")}}),l=u({mutationFn:()=>y("POST","/auth/resend-verification",{email:t.getValues("email")}),onSuccess:()=>{n(!0),setTimeout(()=>n(!1),5e3)},onError:s=>{r(s.message||"Failed to resend code.")}}),F=s=>{r(""),o.mutate(s)},V=()=>{r(""),n(!1),l.mutate()};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted/30 p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(k,{href:"/",children:e.jsxs("div",{className:"inline-flex items-center gap-2 mb-4 cursor-pointer",children:[e.jsx(q,{className:"h-8 w-8 text-primary"}),e.jsx("span",{className:"text-2xl font-bold",children:"Hoomy"})]})}),e.jsx("h1",{className:"text-3xl font-bold","data-testid":"text-verify-title",children:"Verify Your Email"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"We sent a verification code to your email"})]}),e.jsxs(B,{children:[e.jsxs(T,{children:[e.jsx(D,{children:"Enter Verification Code"}),e.jsx(I,{children:"Please check your email for the 6-digit verification code"})]}),e.jsxs(H,{children:[d&&e.jsxs(v,{variant:"destructive",className:"mb-4",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(N,{children:d})]}),E&&e.jsxs(v,{className:"mb-4",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(N,{children:"Verification code resent successfully!"})]}),e.jsx(M,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(F),className:"space-y-4",children:[e.jsx(x,{control:t.control,name:"email",render:({field:s})=>e.jsxs(h,{children:[e.jsx(f,{children:"Email"}),e.jsx(j,{children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(g,{...s,type:"email",disabled:!0,className:"pl-10 bg-muted","data-testid":"input-email"})]})}),e.jsx(p,{})]})}),e.jsx(x,{control:t.control,name:"code",render:({field:s})=>e.jsxs(h,{children:[e.jsx(f,{children:"Verification Code"}),e.jsx(j,{children:e.jsx(g,{...s,placeholder:"123456",maxLength:6,className:"text-center text-2xl tracking-widest","data-testid":"input-code"})}),e.jsx(p,{})]})}),e.jsx(b,{type:"submit",className:"w-full",size:"lg",disabled:o.isPending,"data-testid":"button-submit",children:o.isPending?"Verifying...":"Verify Email"})]})}),e.jsxs("div",{className:"mt-6 text-center text-sm",children:[e.jsx("p",{className:"text-muted-foreground mb-2",children:"Didn't receive the code?"}),e.jsx(b,{variant:"ghost",onClick:V,disabled:l.isPending,className:"p-0 h-auto underline","data-testid":"button-resend",children:l.isPending?"Sending...":"Resend verification code"})]})]})]})]})})}export{ne as default};
