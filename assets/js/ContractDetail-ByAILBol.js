import{u as S,b as p,j as e}from"./query-vendor-yCE0qXS-.js";import{i as E,L as D}from"./react-vendor-CvpuY9Ms.js";import{M as j}from"./MainLayout-DopdQV7D.js";import{h as F,a as H,m as A,c as l,S as B,B as n,C as P,d as I,e as $,f as K,b as _,q as f,l as R}from"./index-DjvxG9Nq.js";import{B as k}from"./badge-C5VrtOTR.js";import{S as o}from"./separator-Btz53ePR.js";import{A as g,a as y}from"./alert-DMGga0az.js";import{T as O,a as Q,b as v,c as N}from"./tabs-CKZIQGin.js";import{C as U}from"./clock-ClHOIDUJ.js";import{C as T}from"./circle-check-DIJHDtjP.js";import{C as G}from"./circle-x-BLHFhToI.js";import{A as V}from"./arrow-left-bb0ZNe41.js";import{F as X}from"./file-text-Dd3eqpd1.js";import{C as Y}from"./credit-card-DpEf3-8j.js";import"./Logo-B_O9zLZT.js";import"./ui-vendor-3oCJfrha.js";import"./user-DRx2jp6U.js";import"./building-2-CEFxqaOP.js";const z=F("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);const J=F("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);function fe(){const b=E(),t=b.id?parseInt(b.id):null,{user:W,isStudent:L,isOwner:m}=H(),{toast:r}=A(),{data:x,isLoading:q}=S({queryKey:["/contracts",t],enabled:!!t,queryFn:async()=>{if(!t)throw new Error("Contract ID required");return l("GET",`/contracts/${t}`)}}),s=x==null?void 0:x.contract,i=p({mutationFn:()=>l("PUT",`/contracts/${t}/status`,{status:"active"}),onSuccess:()=>{f.invalidateQueries({queryKey:["/contracts",t]}),f.invalidateQueries({queryKey:["/contracts/my-contracts"]}),r({title:"Success",description:"Contract signed successfully"})},onError:a=>{r({title:"Error",description:a.message,variant:"destructive"})}}),u=p({mutationFn:()=>l("POST","/contracts/create-subscription",{contract_id:t}),onSuccess:a=>{a.checkout_url&&(window.location.href=a.checkout_url)},onError:a=>{r({title:"Error",description:a.message,variant:"destructive"})}}),h=p({mutationFn:()=>l("POST","/contracts/cancel-subscription",{contract_id:t}),onSuccess:()=>{f.invalidateQueries({queryKey:["/contracts",t]}),r({title:"Success",description:"Subscription cancelled successfully"})},onError:a=>{r({title:"Error",description:a.message,variant:"destructive"})}}),{data:c}=S({queryKey:["/contracts/payments",t],enabled:!!t&&(s==null?void 0:s.status)==="active",queryFn:async()=>{if(!t)throw new Error("Contract ID required");return l("GET",`/contracts/payments/${t}`)}}),M=()=>{if(t){const d=R().replace(/\/+$/,"");window.open(`${d}/contracts/${t}`,"_blank")}};if(q)return e.jsx(j,{children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx(B,{className:"h-96 w-full max-w-4xl mx-auto"})})});if(!s)return e.jsx(j,{children:e.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Contract Not Found"}),e.jsx(D,{href:m?"/dashboard/owner":"/dashboard/student",children:e.jsx(n,{"data-testid":"button-dashboard",children:"Back to Dashboard"})})]})});const w=L&&s.status==="pending",C={pending:e.jsx(U,{className:"h-5 w-5 text-yellow-600"}),active:e.jsx(T,{className:"h-5 w-5 text-green-600"}),completed:e.jsx(T,{className:"h-5 w-5 text-green-600"}),cancelled:e.jsx(G,{className:"h-5 w-5 text-red-600"})}[s.status];return e.jsx(j,{children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(D,{href:m?"/dashboard/owner":"/dashboard/student",children:e.jsxs(n,{variant:"ghost",className:"mb-4","data-testid":"button-back",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})}),e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(P,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(X,{className:"h-6 w-6 text-muted-foreground"}),e.jsx($,{children:"Rental Contract"})]}),e.jsxs(K,{children:["Contract ID: ",s.id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[C,e.jsx(k,{variant:s.status==="active"?"default":s.status==="pending"?"secondary":"outline",children:s.status})]})]})}),e.jsxs(_,{className:"space-y-6",children:[w&&e.jsx(g,{children:e.jsxs(y,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Please review and sign this contract to proceed with your rental"}),e.jsx(n,{onClick:()=>i.mutate(),disabled:i.isPending,"data-testid":"button-sign-contract",children:i.isPending?"Signing...":"Sign Contract"})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Property Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Property"}),e.jsx("p",{className:"font-medium","data-testid":"text-property-title",children:s.property_title})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Location"}),e.jsx("p",{className:"font-medium",children:s.city_name})]})]})]}),e.jsx(o,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Parties"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Property Owner"}),e.jsxs("p",{className:"font-medium",children:[s.owner_first_name," ",s.owner_last_name]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tenant"}),e.jsxs("p",{className:"font-medium",children:[s.student_first_name," ",s.student_last_name]})]})]})]}),e.jsx(o,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Contract Terms"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start Date"}),e.jsx("p",{className:"font-medium",children:new Date(s.start_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"End Date"}),e.jsx("p",{className:"font-medium",children:new Date(s.end_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Duration"}),e.jsxs("p",{className:"font-medium",children:[Math.round((new Date(s.end_date).getTime()-new Date(s.start_date).getTime())/(1e3*60*60*24*30))," months"]})]})]})]}),e.jsx(o,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Financial Details"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monthly Rent"}),e.jsxs("p",{className:"font-semibold text-lg",children:["CHF ",s.monthly_rent.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Deposit"}),e.jsxs("p",{className:"font-semibold text-lg",children:["CHF ",s.deposit_amount.toLocaleString()]})]}),m&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your Monthly Payout"}),e.jsxs("p",{className:"font-semibold text-lg",children:["CHF ",s.owner_payout.toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"After platform fee"})]})]})]}),e.jsx(o,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Contract Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[C,e.jsxs("p",{className:"text-sm",children:[s.status==="active"&&"Contract is active",s.status==="pending"&&"Contract is pending approval",s.status==="completed"&&"Contract has been completed",s.status==="cancelled"&&"Contract has been cancelled"]})]})]}),e.jsxs(O,{defaultValue:"details",className:"w-full",children:[e.jsxs(Q,{className:"grid w-full grid-cols-3",children:[e.jsx(v,{value:"details",children:"Details"}),(s==null?void 0:s.status)==="active"&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{value:"payments",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Payments"]}),e.jsxs(v,{value:"history",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"History"]})]})]}),e.jsx(N,{value:"details",className:"space-y-4",children:e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(n,{onClick:M,variant:"outline",className:"flex-1","data-testid":"button-download-pdf",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Download PDF"]}),w&&e.jsx(n,{onClick:()=>i.mutate(),disabled:i.isPending,className:"flex-1","data-testid":"button-sign",children:i.isPending?"Signing...":"Sign Contract"})]})}),(s==null?void 0:s.status)==="active"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{value:"payments",className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Payment Setup"}),s.stripe_subscription_id?e.jsx(g,{children:e.jsxs(y,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Subscription is active. Payments will be processed automatically."}),e.jsx(n,{variant:"destructive",onClick:()=>{confirm("Are you sure you want to cancel the subscription?")&&h.mutate()},disabled:h.isPending,children:h.isPending?"Cancelling...":"Cancel Subscription"})]})}):e.jsx(g,{children:e.jsxs(y,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Set up automatic monthly payments"}),e.jsx(n,{onClick:()=>u.mutate(),disabled:u.isPending,children:u.isPending?"Setting up...":"Set Up Payments"})]})})]})}),e.jsx(N,{value:"history",className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Payment History"}),!(c!=null&&c.payments)||c.payments.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No payment history available"}):e.jsx("div",{className:"space-y-2",children:c.payments.map(a=>{var d;return e.jsx(P,{children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["CHF ",(d=a.amount)==null?void 0:d.toLocaleString()]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()})]}),e.jsx(k,{variant:a.status==="completed"?"default":"secondary",children:a.status})]})})},a.id)})})]})})]})]})]})]})})]})})}export{fe as default};
