import{j as n}from"./query-vendor-CNIykozp.js";import{r as c,u as de,L as q}from"./react-vendor-DdYNpgPf.js";import{C as ue,a as me}from"./card-ChNshBDf.js";import{B as X}from"./badge-BTZhvk5j.js";import{n as fe}from"./MainLayout-Dp07w-_I.js";import{q as he,m as ge,u as xe,c as pe}from"./index-BSTG6X_D.js";import{H as ve}from"./heart-BwsYV72Y.js";import{M as be}from"./map-pin-CChOV3U7.js";import{H as we}from"./dialog-BsLb2Mph.js";import{B as Se,M as ye}from"./maximize-D8kTIRDk.js";import{S as Ce,e as je,m as Pe,g as I,u as B,l as Ee,f as K,j as Re,i as Ne,U as G}from"./ui-vendor-BME24-VV.js";function De(){return{prefetchProperty:c.useCallback(e=>{he.prefetchQuery({queryKey:[`/properties/${e}`],queryFn:ge({on401:"throw"}),staleTime:3e5})},[])}}const it=c.memo(function({property:e,onFavoriteToggle:r,isFavorited:o,hideFavoriteButton:a=!1}){const d=fe(e.main_photo),[s,l]=c.useState(!1),[u,h]=c.useState(!1),[w,i]=c.useState(!1),m=c.useRef(null),g=c.useRef(null),{prefetchProperty:S}=De(),[,x]=de(),{getCityName:p,getCantonNameFromCode:f}=xe(),j=c.useCallback(C=>{C.preventDefault(),C.stopPropagation(),r?r(e.id):x(`/login?redirect=/properties/${e.id}`)},[r,e.id,x]);c.useEffect(()=>{if(!g.current)return;const C=g.current.getBoundingClientRect();if(C.top<window.innerHeight+50&&C.bottom>-50){i(!0);return}const V=new IntersectionObserver(H=>{H.forEach(R=>{R.isIntersecting&&(i(!0),V.disconnect())})},{rootMargin:"50px"});return V.observe(g.current),()=>V.disconnect()},[]);const b=c.useCallback(()=>{S(e.id)},[e.id,S]),v=c.useCallback(()=>{l(!0)},[]),E=c.useCallback(C=>{const P=C.currentTarget;if(P.src.includes("placeholder")||P.src.includes("data:image")){h(!0),l(!0);return}h(!0),l(!0),P.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="300"%3E%3Crect fill="%23e5e7eb" width="400" height="300"/%3E%3Ctext fill="%239ca3af" x="50%25" y="50%25" text-anchor="middle" dy=".3em" font-family="system-ui" font-size="16"%3EImage non disponible%3C/text%3E%3C/svg%3E'},[]);return n.jsxs(ue,{ref:g,className:"overflow-hidden hover-elevate transition-all duration-200 hover:shadow-lg group will-change-transform active:scale-[0.98] touch-manipulation","data-testid":`card-property-${e.id}`,onMouseEnter:b,children:[n.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden bg-muted",children:[n.jsx(q,{href:`/properties/${e.id}`,children:n.jsxs("div",{className:"block w-full h-full cursor-pointer",children:[!s&&!u&&n.jsx("div",{className:"absolute inset-0 bg-muted animate-pulse"}),w&&n.jsx("img",{ref:m,src:u?'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="300"%3E%3Crect fill="%23e5e7eb" width="400" height="300"/%3E%3Ctext fill="%239ca3af" x="50%25" y="50%25" text-anchor="middle" dy=".3em" font-family="system-ui" font-size="16"%3EImage non disponible%3C/text%3E%3C/svg%3E':d,alt:e.title,className:`w-full h-full object-cover transition-all duration-200 group-hover:scale-105 will-change-transform ${s?"opacity-100":"opacity-0"}`,loading:"lazy",decoding:"async",fetchpriority:"low",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",onLoad:v,onError:E})]})}),n.jsx("div",{className:"absolute top-3 left-3 z-10",children:n.jsxs(X,{className:"bg-background/90 text-foreground backdrop-blur",children:[p(e.city_name),", ",f(e.canton_code)]})}),!a&&n.jsx("button",{type:"button",className:"absolute top-3 right-3 z-30 rounded-full bg-white p-2 shadow-lg hover:bg-white hover:scale-110 transition-all border border-gray-300 flex items-center justify-center",onClick:j,"data-testid":`button-favorite-${e.id}`,"aria-label":o?"Remove from favorites":"Add to favorites",children:n.jsx(ve,{className:`h-6 w-6 ${o?"fill-primary text-primary":"text-gray-700"}`})})]}),n.jsx(me,{className:"p-4",children:n.jsx(q,{href:`/properties/${e.id}`,children:n.jsxs("div",{className:"space-y-3 cursor-pointer",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-lg line-clamp-1","data-testid":`text-title-${e.id}`,children:e.title}),n.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[n.jsx(be,{className:"h-3 w-3"}),e.address]})]}),n.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.rooms&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(we,{className:"h-4 w-4"}),e.rooms," rooms"]}),e.bathrooms&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(Se,{className:"h-4 w-4"}),e.bathrooms," bath"]}),e.surface_area&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(ye,{className:"h-4 w-4"}),e.surface_area,"mÂ²"]})]}),n.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[n.jsxs("div",{children:[n.jsxs("span",{className:"text-2xl font-bold text-primary","data-testid":`text-price-${e.id}`,children:["CHF ",e.price.toLocaleString()]}),n.jsx("span",{className:"text-sm text-muted-foreground",children:"/month"})]}),n.jsx(X,{variant:"outline",children:e.property_type})]})]})})})]})});var Q=["PageUp","PageDown"],W=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],J={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},k="Slider",[T,_e,Me]=Ce(k),[Z,at]=je(k,[Me]),[Ie,z]=Z(k),ee=c.forwardRef((t,e)=>{const{name:r,min:o=0,max:a=100,step:d=1,orientation:s="horizontal",disabled:l=!1,minStepsBetweenThumbs:u=0,defaultValue:h=[o],value:w,onValueChange:i=()=>{},onValueCommit:m=()=>{},inverted:g=!1,form:S,...x}=t,p=c.useRef(new Set),f=c.useRef(0),b=s==="horizontal"?ke:Ve,[v=[],E]=Pe({prop:w,defaultProp:h,onChange:y=>{var _;(_=[...p.current][f.current])==null||_.focus(),i(y)}}),C=c.useRef(v);function P(y){const N=He(v,y);R(y,N)}function V(y){R(y,f.current)}function H(){const y=C.current[f.current];v[f.current]!==y&&m(v)}function R(y,N,{commit:_}={commit:!1}){const U=Oe(d),L=Fe(Math.round((y-o)/d)*d+o,U),A=G(L,[o,a]);E((M=[])=>{const D=Ke(M,A,N);if($e(D,u*d)){f.current=D.indexOf(A);const Y=String(D)!==String(M);return Y&&_&&m(D),Y?D:M}else return M})}return n.jsx(Ie,{scope:t.__scopeSlider,name:r,disabled:l,min:o,max:a,valueIndexToChangeRef:f,thumbs:p.current,values:v,orientation:s,form:S,children:n.jsx(T.Provider,{scope:t.__scopeSlider,children:n.jsx(T.Slot,{scope:t.__scopeSlider,children:n.jsx(b,{"aria-disabled":l,"data-disabled":l?"":void 0,...x,ref:e,onPointerDown:I(x.onPointerDown,()=>{l||(C.current=v)}),min:o,max:a,inverted:g,onSlideStart:l?void 0:P,onSlideMove:l?void 0:V,onSlideEnd:l?void 0:H,onHomeKeyDown:()=>!l&&R(o,0,{commit:!0}),onEndKeyDown:()=>!l&&R(a,v.length-1,{commit:!0}),onStepKeyDown:({event:y,direction:N})=>{if(!l){const L=Q.includes(y.key)||y.shiftKey&&W.includes(y.key)?10:1,A=f.current,M=v[A],D=d*L*N;R(M+D,A,{commit:!0})}}})})})})});ee.displayName=k;var[te,ne]=Z(k,{startEdge:"left",endEdge:"right",size:"width",direction:1}),ke=c.forwardRef((t,e)=>{const{min:r,max:o,dir:a,inverted:d,onSlideStart:s,onSlideMove:l,onSlideEnd:u,onStepKeyDown:h,...w}=t,[i,m]=c.useState(null),g=B(e,b=>m(b)),S=c.useRef(void 0),x=Ee(a),p=x==="ltr",f=p&&!d||!p&&d;function j(b){const v=S.current||i.getBoundingClientRect(),E=[0,v.width],P=F(E,f?[r,o]:[o,r]);return S.current=v,P(b-v.left)}return n.jsx(te,{scope:t.__scopeSlider,startEdge:f?"left":"right",endEdge:f?"right":"left",direction:f?1:-1,size:"width",children:n.jsx(re,{dir:x,"data-orientation":"horizontal",...w,ref:g,style:{...w.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:b=>{const v=j(b.clientX);s==null||s(v)},onSlideMove:b=>{const v=j(b.clientX);l==null||l(v)},onSlideEnd:()=>{S.current=void 0,u==null||u()},onStepKeyDown:b=>{const E=J[f?"from-left":"from-right"].includes(b.key);h==null||h({event:b,direction:E?-1:1})}})})}),Ve=c.forwardRef((t,e)=>{const{min:r,max:o,inverted:a,onSlideStart:d,onSlideMove:s,onSlideEnd:l,onStepKeyDown:u,...h}=t,w=c.useRef(null),i=B(e,w),m=c.useRef(void 0),g=!a;function S(x){const p=m.current||w.current.getBoundingClientRect(),f=[0,p.height],b=F(f,g?[o,r]:[r,o]);return m.current=p,b(x-p.top)}return n.jsx(te,{scope:t.__scopeSlider,startEdge:g?"bottom":"top",endEdge:g?"top":"bottom",size:"height",direction:g?1:-1,children:n.jsx(re,{"data-orientation":"vertical",...h,ref:i,style:{...h.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:x=>{const p=S(x.clientY);d==null||d(p)},onSlideMove:x=>{const p=S(x.clientY);s==null||s(p)},onSlideEnd:()=>{m.current=void 0,l==null||l()},onStepKeyDown:x=>{const f=J[g?"from-bottom":"from-top"].includes(x.key);u==null||u({event:x,direction:f?-1:1})}})})}),re=c.forwardRef((t,e)=>{const{__scopeSlider:r,onSlideStart:o,onSlideMove:a,onSlideEnd:d,onHomeKeyDown:s,onEndKeyDown:l,onStepKeyDown:u,...h}=t,w=z(k,r);return n.jsx(K.span,{...h,ref:e,onKeyDown:I(t.onKeyDown,i=>{i.key==="Home"?(s(i),i.preventDefault()):i.key==="End"?(l(i),i.preventDefault()):Q.concat(W).includes(i.key)&&(u(i),i.preventDefault())}),onPointerDown:I(t.onPointerDown,i=>{const m=i.target;m.setPointerCapture(i.pointerId),i.preventDefault(),w.thumbs.has(m)?m.focus():o(i)}),onPointerMove:I(t.onPointerMove,i=>{i.target.hasPointerCapture(i.pointerId)&&a(i)}),onPointerUp:I(t.onPointerUp,i=>{const m=i.target;m.hasPointerCapture(i.pointerId)&&(m.releasePointerCapture(i.pointerId),d(i))})})}),oe="SliderTrack",se=c.forwardRef((t,e)=>{const{__scopeSlider:r,...o}=t,a=z(oe,r);return n.jsx(K.span,{"data-disabled":a.disabled?"":void 0,"data-orientation":a.orientation,...o,ref:e})});se.displayName=oe;var $="SliderRange",ie=c.forwardRef((t,e)=>{const{__scopeSlider:r,...o}=t,a=z($,r),d=ne($,r),s=c.useRef(null),l=B(e,s),u=a.values.length,h=a.values.map(m=>le(m,a.min,a.max)),w=u>1?Math.min(...h):0,i=100-Math.max(...h);return n.jsx(K.span,{"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,...o,ref:l,style:{...t.style,[d.startEdge]:w+"%",[d.endEdge]:i+"%"}})});ie.displayName=$;var O="SliderThumb",ae=c.forwardRef((t,e)=>{const r=_e(t.__scopeSlider),[o,a]=c.useState(null),d=B(e,l=>a(l)),s=c.useMemo(()=>o?r().findIndex(l=>l.ref.current===o):-1,[r,o]);return n.jsx(Ae,{...t,ref:d,index:s})}),Ae=c.forwardRef((t,e)=>{const{__scopeSlider:r,index:o,name:a,...d}=t,s=z(O,r),l=ne(O,r),[u,h]=c.useState(null),w=B(e,j=>h(j)),i=u?s.form||!!u.closest("form"):!0,m=Re(u),g=s.values[o],S=g===void 0?0:le(g,s.min,s.max),x=ze(o,s.values.length),p=m==null?void 0:m[l.size],f=p?Le(p,S,l.direction):0;return c.useEffect(()=>{if(u)return s.thumbs.add(u),()=>{s.thumbs.delete(u)}},[u,s.thumbs]),n.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${S}% + ${f}px)`},children:[n.jsx(T.ItemSlot,{scope:t.__scopeSlider,children:n.jsx(K.span,{role:"slider","aria-label":t["aria-label"]||x,"aria-valuemin":s.min,"aria-valuenow":g,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0,...d,ref:w,style:g===void 0?{display:"none"}:t.style,onFocus:I(t.onFocus,()=>{s.valueIndexToChangeRef.current=o})})}),i&&n.jsx(Be,{name:a??(s.name?s.name+(s.values.length>1?"[]":""):void 0),form:s.form,value:g},o)]})});ae.displayName=O;var Be=t=>{const{value:e,...r}=t,o=c.useRef(null),a=Ne(e);return c.useEffect(()=>{const d=o.current,s=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(s,"value").set;if(a!==e&&u){const h=new Event("input",{bubbles:!0});u.call(d,e),d.dispatchEvent(h)}},[a,e]),n.jsx("input",{style:{display:"none"},...r,ref:o,defaultValue:e})};function Ke(t=[],e,r){const o=[...t];return o[r]=e,o.sort((a,d)=>a-d)}function le(t,e,r){const d=100/(r-e)*(t-e);return G(d,[0,100])}function ze(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function He(t,e){if(t.length===1)return 0;const r=t.map(a=>Math.abs(a-e)),o=Math.min(...r);return r.indexOf(o)}function Le(t,e,r){const o=t/2,d=F([0,50],[0,o]);return(o-d(e)*r)*r}function Te(t){return t.slice(0,-1).map((e,r)=>t[r+1]-e)}function $e(t,e){if(e>0){const r=Te(t);return Math.min(...r)>=e}return!0}function F(t,e){return r=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const o=(e[1]-e[0])/(t[1]-t[0]);return e[0]+o*(r-t[0])}}function Oe(t){return(String(t).split(".")[1]||"").length}function Fe(t,e){const r=Math.pow(10,e);return Math.round(t*r)/r}var ce=ee,Ue=se,Ye=ie,qe=ae;const Xe=c.forwardRef(({className:t,...e},r)=>n.jsxs(ce,{ref:r,className:pe("relative flex w-full touch-none select-none items-center",t),...e,children:[n.jsx(Ue,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary cursor-pointer",children:n.jsx(Ye,{className:"absolute h-full bg-primary"})}),n.jsx(qe,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 cursor-grab active:cursor-grabbing hover:scale-110"})]}));Xe.displayName=ce.displayName;export{it as P,Xe as S};
