import{u as F,b as L,j as e}from"./query-vendor-yCE0qXS-.js";import{i as I,u as E,r as v,L as h}from"./react-vendor-CvpuY9Ms.js";import{u as A,t as P,F as T,a as i,b as d,c,d as l,f as S,e as m,h as q}from"./schema-NhfknS2Y.js";import{M as u}from"./MainLayout-DopdQV7D.js";import{a as M,B as x,C as H,d as V,e as k,f as B,b as R,c as y}from"./index-DjvxG9Nq.js";import{I as p}from"./input-CH6L8naz.js";import{S as G,a as O,b as $,c as z,d as K}from"./select-TYBEK_4R.js";import{A as Q,a as J}from"./alert-DMGga0az.js";import{A as U}from"./arrow-left-bb0ZNe41.js";import"./ui-vendor-3oCJfrha.js";import"./label-COPF1EYf.js";import"./Logo-B_O9zLZT.js";import"./user-DRx2jp6U.js";import"./building-2-CEFxqaOP.js";function le(){const f=I(),o=f.propertyId?parseInt(f.propertyId):null,[,_]=E(),{isOwner:g}=M(),[C,N]=v.useState(""),{data:s,isLoading:w}=F({queryKey:[`/properties/${o}`],enabled:!!o,queryFn:async()=>{if(!o)throw new Error("Property ID required");return y("GET",`/properties/${o}`)}}),{data:j}=F({queryKey:["/users/students"],enabled:g,queryFn:async()=>y("GET","/users/students")}),r=A({resolver:P(q),defaultValues:{property_id:o||0,student_id:0,start_date:"",end_date:"",monthly_rent:(s==null?void 0:s.price)||0,deposit_amount:s!=null&&s.price?s.price*3:0}});v.useEffect(()=>{s&&(r.setValue("monthly_rent",s.price),r.setValue("deposit_amount",s.price*3))},[s]);const b=L({mutationFn:t=>y("POST","/contracts/create",t),onSuccess:t=>{_(`/contracts/${t.contract.id}`)},onError:t=>{N(t.message||"Failed to create contract")}}),D=t=>{N(""),b.mutate(t)};return g?w?e.jsx(u,{children:e.jsx("div",{className:"container mx-auto px-4 py-16 text-center",children:e.jsx("p",{children:"Loading property details..."})})}):s?e.jsx(u,{children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(h,{href:"/dashboard/owner",children:e.jsxs(x,{variant:"ghost",className:"mb-4","data-testid":"button-back",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})}),e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs(H,{children:[e.jsxs(V,{children:[e.jsx(k,{children:"Create Rental Contract"}),e.jsxs(B,{children:["Create a new rental contract for ",s.title]})]}),e.jsxs(R,{children:[C&&e.jsx(Q,{variant:"destructive",className:"mb-4",children:e.jsx(J,{children:C})}),e.jsxs("div",{className:"mb-6 p-4 bg-muted rounded-md",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Property Details"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.address,", ",s.city_name]}),e.jsxs("p",{className:"font-semibold mt-2",children:["CHF ",s.price.toLocaleString(),"/month"]})]}),e.jsx(T,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(D),className:"space-y-6",children:[e.jsx(i,{control:r.control,name:"student_id",render:({field:t})=>{var n;return e.jsxs(d,{children:[e.jsx(c,{children:"Select Tenant"}),e.jsxs(G,{onValueChange:a=>t.onChange(parseInt(a)),value:(n=t.value)==null?void 0:n.toString(),children:[e.jsx(l,{children:e.jsx(O,{"data-testid":"select-student",children:e.jsx($,{placeholder:"Choose a student"})})}),e.jsx(z,{children:j==null?void 0:j.map(a=>e.jsxs(K,{value:a.id.toString(),children:[a.first_name," ",a.last_name," (",a.email,")"]},a.id))})]}),e.jsx(S,{children:"Select the student who will rent this property"}),e.jsx(m,{})]})}}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"start_date",render:({field:t})=>e.jsxs(d,{children:[e.jsx(c,{children:"Start Date"}),e.jsx(l,{children:e.jsx(p,{...t,type:"date","data-testid":"input-start-date"})}),e.jsx(m,{})]})}),e.jsx(i,{control:r.control,name:"end_date",render:({field:t})=>e.jsxs(d,{children:[e.jsx(c,{children:"End Date"}),e.jsx(l,{children:e.jsx(p,{...t,type:"date","data-testid":"input-end-date"})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"monthly_rent",render:({field:t})=>e.jsxs(d,{children:[e.jsx(c,{children:"Monthly Rent (CHF)"}),e.jsx(l,{children:e.jsx(p,{...t,type:"number",onChange:n=>t.onChange(parseFloat(n.target.value)||0),"data-testid":"input-monthly-rent"})}),e.jsx(m,{})]})}),e.jsx(i,{control:r.control,name:"deposit_amount",render:({field:t})=>e.jsxs(d,{children:[e.jsx(c,{children:"Deposit Amount (CHF)"}),e.jsx(l,{children:e.jsx(p,{...t,type:"number",onChange:n=>t.onChange(parseFloat(n.target.value)||0),"data-testid":"input-deposit"})}),e.jsx(S,{children:"Typically 3 months rent"}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(x,{type:"submit",size:"lg",disabled:b.isPending,className:"flex-1","data-testid":"button-submit",children:b.isPending?"Creating...":"Create Contract"}),e.jsx(h,{href:"/dashboard/owner",children:e.jsx(x,{type:"button",variant:"outline",size:"lg","data-testid":"button-cancel",children:"Cancel"})})]})]})})]})]})})]})}):e.jsx(u,{children:e.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Property Not Found"}),e.jsx(h,{href:"/dashboard/owner",children:e.jsx(x,{"data-testid":"button-dashboard",children:"Back to Dashboard"})})]})}):e.jsx(u,{children:e.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Only property owners can create contracts"}),e.jsx(h,{href:"/",children:e.jsx(x,{"data-testid":"button-home",children:"Go Home"})})]})})}export{le as default};
