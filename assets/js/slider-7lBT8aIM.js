import{j as n}from"./query-vendor-yCE0qXS-.js";import{r as c,u as de,L as q}from"./react-vendor-CvpuY9Ms.js";import{q as ue,s as me,u as fe,C as he,b as ge,H as xe,i as pe}from"./index-iWuRHTV7.js";import{B as W}from"./badge-DlT2aOkD.js";import{n as ve}from"./MainLayout-CWJzm6Lx.js";import{H as be}from"./heart-DTsRH9uU.js";import{M as we}from"./map-pin-Dt15AOc_.js";import{B as Se,M as ye}from"./maximize-jWGZrjJ_.js";import{U as Ce,n as je,B as Pe,r as M,q as B,L as Ee,l as K,J as Re,I as Ne,W as X}from"./ui-vendor-3oCJfrha.js";function De(){return{prefetchProperty:c.useCallback(e=>{ue.prefetchQuery({queryKey:[`/properties/${e}`],queryFn:me({on401:"throw"}),staleTime:3e5})},[])}}const ot=c.memo(function({property:e,onFavoriteToggle:r,isFavorited:o,hideFavoriteButton:i=!1}){const d=ve(e.main_photo),[s,l]=c.useState(!1),[u,h]=c.useState(!1),[w,a]=c.useState(!1),m=c.useRef(null),g=c.useRef(null),{prefetchProperty:S}=De(),[,x]=de(),{getCityName:p,getCantonNameFromCode:f}=fe(),j=c.useCallback(C=>{C.preventDefault(),C.stopPropagation(),r?r(e.id):x(`/login?redirect=/properties/${e.id}`)},[r,e.id,x]);c.useEffect(()=>{if(!g.current)return;const C=g.current.getBoundingClientRect();if(C.top<window.innerHeight+50&&C.bottom>-50){a(!0);return}const V=new IntersectionObserver(z=>{z.forEach(R=>{R.isIntersecting&&(a(!0),V.disconnect())})},{rootMargin:"50px"});return V.observe(g.current),()=>V.disconnect()},[]);const b=c.useCallback(()=>{S(e.id)},[e.id,S]),v=c.useCallback(()=>{l(!0)},[]),E=c.useCallback(C=>{const P=C.currentTarget;if(P.src.includes("placeholder")||P.src.includes("data:image")){h(!0),l(!0);return}h(!0),l(!0),P.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="300"%3E%3Crect fill="%23e5e7eb" width="400" height="300"/%3E%3Ctext fill="%239ca3af" x="50%25" y="50%25" text-anchor="middle" dy=".3em" font-family="system-ui" font-size="16"%3EImage non disponible%3C/text%3E%3C/svg%3E'},[]);return n.jsxs(he,{ref:g,className:"overflow-hidden hover-elevate transition-all duration-200 hover:shadow-lg group will-change-transform active:scale-[0.98] touch-manipulation","data-testid":`card-property-${e.id}`,onMouseEnter:b,children:[n.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden bg-muted",children:[n.jsx(q,{href:`/properties/${e.id}`,children:n.jsxs("div",{className:"block w-full h-full cursor-pointer",children:[!s&&!u&&n.jsx("div",{className:"absolute inset-0 bg-muted animate-pulse"}),w&&n.jsx("img",{ref:m,src:u?'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="300"%3E%3Crect fill="%23e5e7eb" width="400" height="300"/%3E%3Ctext fill="%239ca3af" x="50%25" y="50%25" text-anchor="middle" dy=".3em" font-family="system-ui" font-size="16"%3EImage non disponible%3C/text%3E%3C/svg%3E':d,alt:e.title,className:`w-full h-full object-cover transition-all duration-200 group-hover:scale-105 will-change-transform ${s?"opacity-100":"opacity-0"}`,loading:"lazy",decoding:"async",fetchpriority:"low",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",onLoad:v,onError:E})]})}),n.jsx("div",{className:"absolute top-3 left-3 z-10",children:n.jsxs(W,{className:"bg-background/90 text-foreground backdrop-blur",children:[p(e.city_name),", ",f(e.canton_code)]})}),!i&&n.jsx("button",{type:"button",className:"absolute top-3 right-3 z-30 rounded-full bg-white p-2 shadow-lg hover:bg-white hover:scale-110 transition-all border border-gray-300 flex items-center justify-center",onClick:j,"data-testid":`button-favorite-${e.id}`,"aria-label":o?"Remove from favorites":"Add to favorites",children:n.jsx(be,{className:`h-6 w-6 ${o?"fill-primary text-primary":"text-gray-700"}`})})]}),n.jsx(ge,{className:"p-4",children:n.jsx(q,{href:`/properties/${e.id}`,children:n.jsxs("div",{className:"space-y-3 cursor-pointer",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-lg line-clamp-1","data-testid":`text-title-${e.id}`,children:e.title}),n.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[n.jsx(we,{className:"h-3 w-3"}),e.address]})]}),n.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.rooms&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(xe,{className:"h-4 w-4"}),e.rooms," rooms"]}),e.bathrooms&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(Se,{className:"h-4 w-4"}),e.bathrooms," bath"]}),e.surface_area&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(ye,{className:"h-4 w-4"}),e.surface_area,"mÂ²"]})]}),n.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[n.jsxs("div",{children:[n.jsxs("span",{className:"text-2xl font-bold text-primary","data-testid":`text-price-${e.id}`,children:["CHF ",e.price.toLocaleString()]}),n.jsx("span",{className:"text-sm text-muted-foreground",children:"/month"})]}),n.jsx(W,{variant:"outline",children:e.property_type})]})]})})})]})});var G=["PageUp","PageDown"],Q=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],J={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},k="Slider",[T,_e,Ie]=Ce(k),[Z,st]=je(k,[Ie]),[Me,L]=Z(k),ee=c.forwardRef((t,e)=>{const{name:r,min:o=0,max:i=100,step:d=1,orientation:s="horizontal",disabled:l=!1,minStepsBetweenThumbs:u=0,defaultValue:h=[o],value:w,onValueChange:a=()=>{},onValueCommit:m=()=>{},inverted:g=!1,form:S,...x}=t,p=c.useRef(new Set),f=c.useRef(0),b=s==="horizontal"?ke:Ve,[v=[],E]=Pe({prop:w,defaultProp:h,onChange:y=>{var _;(_=[...p.current][f.current])==null||_.focus(),a(y)}}),C=c.useRef(v);function P(y){const N=ze(v,y);R(y,N)}function V(y){R(y,f.current)}function z(){const y=C.current[f.current];v[f.current]!==y&&m(v)}function R(y,N,{commit:_}={commit:!1}){const U=Oe(d),H=Fe(Math.round((y-o)/d)*d+o,U),A=X(H,[o,i]);E((I=[])=>{const D=Ke(I,A,N);if($e(D,u*d)){f.current=D.indexOf(A);const Y=String(D)!==String(I);return Y&&_&&m(D),Y?D:I}else return I})}return n.jsx(Me,{scope:t.__scopeSlider,name:r,disabled:l,min:o,max:i,valueIndexToChangeRef:f,thumbs:p.current,values:v,orientation:s,form:S,children:n.jsx(T.Provider,{scope:t.__scopeSlider,children:n.jsx(T.Slot,{scope:t.__scopeSlider,children:n.jsx(b,{"aria-disabled":l,"data-disabled":l?"":void 0,...x,ref:e,onPointerDown:M(x.onPointerDown,()=>{l||(C.current=v)}),min:o,max:i,inverted:g,onSlideStart:l?void 0:P,onSlideMove:l?void 0:V,onSlideEnd:l?void 0:z,onHomeKeyDown:()=>!l&&R(o,0,{commit:!0}),onEndKeyDown:()=>!l&&R(i,v.length-1,{commit:!0}),onStepKeyDown:({event:y,direction:N})=>{if(!l){const H=G.includes(y.key)||y.shiftKey&&Q.includes(y.key)?10:1,A=f.current,I=v[A],D=d*H*N;R(I+D,A,{commit:!0})}}})})})})});ee.displayName=k;var[te,ne]=Z(k,{startEdge:"left",endEdge:"right",size:"width",direction:1}),ke=c.forwardRef((t,e)=>{const{min:r,max:o,dir:i,inverted:d,onSlideStart:s,onSlideMove:l,onSlideEnd:u,onStepKeyDown:h,...w}=t,[a,m]=c.useState(null),g=B(e,b=>m(b)),S=c.useRef(void 0),x=Ee(i),p=x==="ltr",f=p&&!d||!p&&d;function j(b){const v=S.current||a.getBoundingClientRect(),E=[0,v.width],P=F(E,f?[r,o]:[o,r]);return S.current=v,P(b-v.left)}return n.jsx(te,{scope:t.__scopeSlider,startEdge:f?"left":"right",endEdge:f?"right":"left",direction:f?1:-1,size:"width",children:n.jsx(re,{dir:x,"data-orientation":"horizontal",...w,ref:g,style:{...w.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:b=>{const v=j(b.clientX);s==null||s(v)},onSlideMove:b=>{const v=j(b.clientX);l==null||l(v)},onSlideEnd:()=>{S.current=void 0,u==null||u()},onStepKeyDown:b=>{const E=J[f?"from-left":"from-right"].includes(b.key);h==null||h({event:b,direction:E?-1:1})}})})}),Ve=c.forwardRef((t,e)=>{const{min:r,max:o,inverted:i,onSlideStart:d,onSlideMove:s,onSlideEnd:l,onStepKeyDown:u,...h}=t,w=c.useRef(null),a=B(e,w),m=c.useRef(void 0),g=!i;function S(x){const p=m.current||w.current.getBoundingClientRect(),f=[0,p.height],b=F(f,g?[o,r]:[r,o]);return m.current=p,b(x-p.top)}return n.jsx(te,{scope:t.__scopeSlider,startEdge:g?"bottom":"top",endEdge:g?"top":"bottom",size:"height",direction:g?1:-1,children:n.jsx(re,{"data-orientation":"vertical",...h,ref:a,style:{...h.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:x=>{const p=S(x.clientY);d==null||d(p)},onSlideMove:x=>{const p=S(x.clientY);s==null||s(p)},onSlideEnd:()=>{m.current=void 0,l==null||l()},onStepKeyDown:x=>{const f=J[g?"from-bottom":"from-top"].includes(x.key);u==null||u({event:x,direction:f?-1:1})}})})}),re=c.forwardRef((t,e)=>{const{__scopeSlider:r,onSlideStart:o,onSlideMove:i,onSlideEnd:d,onHomeKeyDown:s,onEndKeyDown:l,onStepKeyDown:u,...h}=t,w=L(k,r);return n.jsx(K.span,{...h,ref:e,onKeyDown:M(t.onKeyDown,a=>{a.key==="Home"?(s(a),a.preventDefault()):a.key==="End"?(l(a),a.preventDefault()):G.concat(Q).includes(a.key)&&(u(a),a.preventDefault())}),onPointerDown:M(t.onPointerDown,a=>{const m=a.target;m.setPointerCapture(a.pointerId),a.preventDefault(),w.thumbs.has(m)?m.focus():o(a)}),onPointerMove:M(t.onPointerMove,a=>{a.target.hasPointerCapture(a.pointerId)&&i(a)}),onPointerUp:M(t.onPointerUp,a=>{const m=a.target;m.hasPointerCapture(a.pointerId)&&(m.releasePointerCapture(a.pointerId),d(a))})})}),oe="SliderTrack",se=c.forwardRef((t,e)=>{const{__scopeSlider:r,...o}=t,i=L(oe,r);return n.jsx(K.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...o,ref:e})});se.displayName=oe;var $="SliderRange",ae=c.forwardRef((t,e)=>{const{__scopeSlider:r,...o}=t,i=L($,r),d=ne($,r),s=c.useRef(null),l=B(e,s),u=i.values.length,h=i.values.map(m=>le(m,i.min,i.max)),w=u>1?Math.min(...h):0,a=100-Math.max(...h);return n.jsx(K.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...o,ref:l,style:{...t.style,[d.startEdge]:w+"%",[d.endEdge]:a+"%"}})});ae.displayName=$;var O="SliderThumb",ie=c.forwardRef((t,e)=>{const r=_e(t.__scopeSlider),[o,i]=c.useState(null),d=B(e,l=>i(l)),s=c.useMemo(()=>o?r().findIndex(l=>l.ref.current===o):-1,[r,o]);return n.jsx(Ae,{...t,ref:d,index:s})}),Ae=c.forwardRef((t,e)=>{const{__scopeSlider:r,index:o,name:i,...d}=t,s=L(O,r),l=ne(O,r),[u,h]=c.useState(null),w=B(e,j=>h(j)),a=u?s.form||!!u.closest("form"):!0,m=Re(u),g=s.values[o],S=g===void 0?0:le(g,s.min,s.max),x=Le(o,s.values.length),p=m==null?void 0:m[l.size],f=p?He(p,S,l.direction):0;return c.useEffect(()=>{if(u)return s.thumbs.add(u),()=>{s.thumbs.delete(u)}},[u,s.thumbs]),n.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${S}% + ${f}px)`},children:[n.jsx(T.ItemSlot,{scope:t.__scopeSlider,children:n.jsx(K.span,{role:"slider","aria-label":t["aria-label"]||x,"aria-valuemin":s.min,"aria-valuenow":g,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0,...d,ref:w,style:g===void 0?{display:"none"}:t.style,onFocus:M(t.onFocus,()=>{s.valueIndexToChangeRef.current=o})})}),a&&n.jsx(Be,{name:i??(s.name?s.name+(s.values.length>1?"[]":""):void 0),form:s.form,value:g},o)]})});ie.displayName=O;var Be=t=>{const{value:e,...r}=t,o=c.useRef(null),i=Ne(e);return c.useEffect(()=>{const d=o.current,s=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(s,"value").set;if(i!==e&&u){const h=new Event("input",{bubbles:!0});u.call(d,e),d.dispatchEvent(h)}},[i,e]),n.jsx("input",{style:{display:"none"},...r,ref:o,defaultValue:e})};function Ke(t=[],e,r){const o=[...t];return o[r]=e,o.sort((i,d)=>i-d)}function le(t,e,r){const d=100/(r-e)*(t-e);return X(d,[0,100])}function Le(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function ze(t,e){if(t.length===1)return 0;const r=t.map(i=>Math.abs(i-e)),o=Math.min(...r);return r.indexOf(o)}function He(t,e,r){const o=t/2,d=F([0,50],[0,o]);return(o-d(e)*r)*r}function Te(t){return t.slice(0,-1).map((e,r)=>t[r+1]-e)}function $e(t,e){if(e>0){const r=Te(t);return Math.min(...r)>=e}return!0}function F(t,e){return r=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const o=(e[1]-e[0])/(t[1]-t[0]);return e[0]+o*(r-t[0])}}function Oe(t){return(String(t).split(".")[1]||"").length}function Fe(t,e){const r=Math.pow(10,e);return Math.round(t*r)/r}var ce=ee,Ue=se,Ye=ae,qe=ie;const We=c.forwardRef(({className:t,...e},r)=>n.jsxs(ce,{ref:r,className:pe("relative flex w-full touch-none select-none items-center",t),...e,children:[n.jsx(Ue,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary cursor-pointer",children:n.jsx(Ye,{className:"absolute h-full bg-primary"})}),n.jsx(qe,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 cursor-grab active:cursor-grabbing hover:scale-110"})]}));We.displayName=ce.displayName;export{ot as P,We as S};
