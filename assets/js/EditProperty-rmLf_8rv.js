import{u as N,b as z,j as e}from"./query-vendor-CNIykozp.js";import{g as R,u as B,r as u,L as y}from"./react-vendor-DdYNpgPf.js";import{u as K,F as $,a as o,b as t,c as l,d as i,e as c,f as G,t as H,g as O}from"./schema-Cq8GsnGl.js";import{M as g}from"./MainLayout-BqPj5A1Q.js";import{B as p}from"./button-B8zoFJtu.js";import{I as x}from"./input-CYFS7xjh.js";import{T as U}from"./textarea-DvNVt3YO.js";import{C as k,b as Q,c as J,d as W,a as X}from"./card-BTGRRs4F.js";import{S as F,a as S,b as w,c as E,d as m}from"./select-uXq2eEJp.js";import{A as Y,a as Z}from"./alert-pa1NVYRn.js";import{a as ee,u as re,b,q as P}from"./index-Co9HXm8e.js";import{A as se}from"./arrow-left-lrDyw0u-.js";import"./ui-vendor-BME24-VV.js";import"./label-BAS4UUYP.js";import"./Logo-Bhe2__w3.js";import"./user-70LQggi4.js";import"./building-2-io5-MBU8.js";function fe(){const[,h]=R("/properties/:id/edit"),d=h!=null&&h.id?parseInt(h.id):null,[,A]=B(),{isOwner:D}=ee(),{getCantonName:I,getCityName:T}=re(),[q,f]=u.useState("");u.useState([]);const[j,L]=u.useState(""),{data:a,isLoading:V}=N({queryKey:[`/properties/${d}`],enabled:!!d&&d>0,queryFn:async()=>{if(!d||d<=0)throw new Error("Invalid property ID");return b("GET",`/properties/${d}`)}}),{data:v}=N({queryKey:["/locations/cantons"],queryFn:async()=>b("GET","/locations/cantons")}),{data:C}=N({queryKey:["/locations/cities",j],enabled:!!j,queryFn:async()=>{if(!j)throw new Error("Canton required");return b("GET",`/locations/cities?canton=${j}`)}}),n=K({resolver:H(O),defaultValues:{title:"",description:"",property_type:"apartment",address:"",city_name:"",postal_code:"",canton_code:"",price:0,rooms:0,bathrooms:0,surface_area:0,available_from:""}});u.useEffect(()=>{a&&(n.reset({title:a.title,description:a.description||"",property_type:a.property_type,address:a.address,city_name:a.city_name,postal_code:a.postal_code,canton_code:a.canton_code,price:a.price,rooms:a.rooms||0,bathrooms:a.bathrooms||0,surface_area:a.surface_area||0,available_from:a.available_from||""}),L(a.canton_code))},[a,n]);const _=z({mutationFn:async r=>b("PUT",`/properties/${d}`,r),onSuccess:()=>{P.invalidateQueries({queryKey:[`/properties/${d}`]}),P.invalidateQueries({queryKey:["/properties/my-properties"]}),A("/dashboard/owner")},onError:r=>{f(r.message||"Failed to update property")}}),M=async r=>{if(f(""),!r.address||!r.city_name||!r.postal_code||!r.canton_code){f("Veuillez remplir tous les champs d'adresse (rue, canton, ville, code postal)");return}const s={...r,rooms:r.rooms||0,bathrooms:r.bathrooms||0,surface_area:r.surface_area||0,available_from:r.available_from||null,status:(a==null?void 0:a.status)||"available"};_.mutate(s)};return D?V?e.jsx(g,{children:e.jsx("div",{className:"container mx-auto px-4 py-16 text-center",children:e.jsx("p",{children:"Loading property details..."})})}):a?e.jsx(g,{children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(y,{href:"/dashboard/owner",children:e.jsxs(p,{variant:"ghost",className:"mb-4",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})}),e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs(k,{children:[e.jsxs(Q,{children:[e.jsx(J,{children:"Edit Property"}),e.jsx(W,{children:"Update your property listing details"})]}),e.jsxs(X,{children:[q&&e.jsx(Y,{variant:"destructive",className:"mb-4",children:e.jsx(Z,{children:q})}),e.jsx($,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(M),className:"space-y-6",children:[e.jsx(o,{control:n.control,name:"title",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Property Title"}),e.jsx(i,{children:e.jsx(x,{...r,placeholder:"Cozy 2-room apartment near university"})}),e.jsx(c,{})]})}),e.jsx(o,{control:n.control,name:"description",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Description"}),e.jsx(i,{children:e.jsx(U,{...r,placeholder:"Describe your property, amenities, nearby facilities...",rows:6,className:"resize-none","data-testid":"input-description"})}),e.jsx(G,{children:"Minimum 20 caractères avec plusieurs mots séparés par des espaces"}),e.jsx(c,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:n.control,name:"property_type",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Property Type"}),e.jsxs(F,{onValueChange:r.onChange,value:r.value,children:[e.jsx(i,{children:e.jsx(S,{children:e.jsx(w,{})})}),e.jsxs(E,{children:[e.jsx(m,{value:"apartment",children:"Apartment"}),e.jsx(m,{value:"house",children:"House"}),e.jsx(m,{value:"studio",children:"Studio"}),e.jsx(m,{value:"room",children:"Room"}),e.jsx(m,{value:"other",children:"Other"})]})]}),e.jsx(c,{})]})}),e.jsx(o,{control:n.control,name:"price",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Monthly Rent (CHF)"}),e.jsx(i,{children:e.jsx(x,{...r,type:"number",placeholder:"1500",onChange:s=>r.onChange(parseFloat(s.target.value)||0)})}),e.jsx(c,{})]})})]}),e.jsx(o,{control:n.control,name:"address",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Street Address"}),e.jsx(i,{children:e.jsx(x,{...r,placeholder:"Entrez une adresse"})}),e.jsx(c,{})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(o,{control:n.control,name:"canton_code",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Canton"}),e.jsxs(F,{onValueChange:s=>{r.onChange(s),L(s),n.setValue("city_name",""),n.setValue("address","")},value:r.value,children:[e.jsx(i,{children:e.jsx(S,{children:e.jsx(w,{placeholder:"Select"})})}),e.jsx(E,{children:v==null?void 0:v.map(s=>e.jsx(m,{value:s.code,children:I(s)},s.code))})]}),e.jsx(c,{})]})}),e.jsx(o,{control:n.control,name:"city_name",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"City"}),e.jsxs(F,{onValueChange:r.onChange,value:r.value,children:[e.jsx(i,{children:e.jsx(S,{children:e.jsx(w,{placeholder:"Select"})})}),e.jsx(E,{children:C==null?void 0:C.map(s=>e.jsx(m,{value:s.name,children:T(s.name)},s.id))})]}),e.jsx(c,{})]})}),e.jsx(o,{control:n.control,name:"postal_code",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Postal Code"}),e.jsx(i,{children:e.jsx(x,{...r,placeholder:"8001",maxLength:4})}),e.jsx(c,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(o,{control:n.control,name:"rooms",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Rooms"}),e.jsx(i,{children:e.jsx(x,{...r,type:"number",step:"0.5",placeholder:"2.5",onChange:s=>r.onChange(parseFloat(s.target.value)||0)})}),e.jsx(c,{})]})}),e.jsx(o,{control:n.control,name:"bathrooms",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Bathrooms"}),e.jsx(i,{children:e.jsx(x,{...r,type:"number",placeholder:"1",onChange:s=>r.onChange(parseInt(s.target.value)||0)})}),e.jsx(c,{})]})}),e.jsx(o,{control:n.control,name:"surface_area",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Surface (m²)"}),e.jsx(i,{children:e.jsx(x,{...r,type:"number",placeholder:"65",onChange:s=>r.onChange(parseInt(s.target.value)||0)})}),e.jsx(c,{})]})})]}),e.jsx(o,{control:n.control,name:"available_from",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:"Available From (Optional)"}),e.jsx(i,{children:e.jsx(x,{...r,type:"date"})}),e.jsx(c,{})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(p,{type:"submit",size:"lg",disabled:_.isPending,className:"flex-1",children:_.isPending?"Updating...":"Update Property"}),e.jsx(y,{href:"/dashboard/owner",children:e.jsx(p,{type:"button",variant:"outline",size:"lg",children:"Cancel"})})]})]})})]})]})})]})}):e.jsx(g,{children:e.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Property Not Found"}),e.jsx(y,{href:"/dashboard/owner",children:e.jsx(p,{children:"Back to Dashboard"})})]})}):e.jsx(g,{children:e.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Only property owners can edit listings"}),e.jsx(y,{href:"/",children:e.jsx(p,{children:"Go Home"})})]})})}export{fe as default};
