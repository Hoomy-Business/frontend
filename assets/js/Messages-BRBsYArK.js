import{j as t,b as G,u as J}from"./query-vendor-yCE0qXS-.js";import{r as a,f as ve,L as Se}from"./react-vendor-CvpuY9Ms.js";import{M as ye}from"./MainLayout-CWJzm6Lx.js";import{i as ne,a as je,u as Pe,C as Z,d as ee,e as te,b as re,S as oe,B as Y,c as z,q as U}from"./index-iWuRHTV7.js";import{T as Ce}from"./textarea-DASvhyL0.js";import{n as Re,q as W,L as Ne,l as H,s as O,r as T,X as E,Y as Ae,W as Ee}from"./ui-vendor-3oCJfrha.js";import{B as F}from"./building-2-6iAU2-y9.js";import{A as Te}from"./arrow-left-DbRNGtnC.js";import{S as _e}from"./send-CW51Yxp7.js";import"./Logo-6y9ImIyh.js";import"./user-CTEB5HWp.js";function Le(e,r){return a.useReducer((o,i)=>r[o][i]??o,e)}var V="ScrollArea",[le,ot]=Re(V),[De,w]=le(V),ae=a.forwardRef((e,r)=>{const{__scopeScrollArea:o,type:i="hover",dir:n,scrollHideDelay:c=600,...l}=e,[d,m]=a.useState(null),[f,u]=a.useState(null),[x,h]=a.useState(null),[p,b]=a.useState(null),[R,_]=a.useState(null),[N,y]=a.useState(0),[L,D]=a.useState(0),[v,j]=a.useState(!1),[S,A]=a.useState(!1),g=W(r,P=>m(P)),s=Ne(n);return t.jsx(De,{scope:o,type:i,dir:s,scrollHideDelay:c,scrollArea:d,viewport:f,onViewportChange:u,content:x,onContentChange:h,scrollbarX:p,onScrollbarXChange:b,scrollbarXEnabled:v,onScrollbarXEnabledChange:j,scrollbarY:R,onScrollbarYChange:_,scrollbarYEnabled:S,onScrollbarYEnabledChange:A,onCornerWidthChange:y,onCornerHeightChange:D,children:t.jsx(H.div,{dir:s,...l,ref:g,style:{position:"relative","--radix-scroll-area-corner-width":N+"px","--radix-scroll-area-corner-height":L+"px",...e.style}})})});ae.displayName=V;var ie="ScrollAreaViewport",ce=a.forwardRef((e,r)=>{const{__scopeScrollArea:o,children:i,nonce:n,...c}=e,l=w(ie,o),d=a.useRef(null),m=W(r,d,l.onViewportChange);return t.jsxs(t.Fragment,{children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),t.jsx(H.div,{"data-radix-scroll-area-viewport":"",...c,ref:m,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...e.style},children:t.jsx("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"},children:i})})]})});ce.displayName=ie;var C="ScrollAreaScrollbar",K=a.forwardRef((e,r)=>{const{forceMount:o,...i}=e,n=w(C,e.__scopeScrollArea),{onScrollbarXEnabledChange:c,onScrollbarYEnabledChange:l}=n,d=e.orientation==="horizontal";return a.useEffect(()=>(d?c(!0):l(!0),()=>{d?c(!1):l(!1)}),[d,c,l]),n.type==="hover"?t.jsx(ke,{...i,ref:r,forceMount:o}):n.type==="scroll"?t.jsx(We,{...i,ref:r,forceMount:o}):n.type==="auto"?t.jsx(de,{...i,ref:r,forceMount:o}):n.type==="always"?t.jsx($,{...i,ref:r}):null});K.displayName=C;var ke=a.forwardRef((e,r)=>{const{forceMount:o,...i}=e,n=w(C,e.__scopeScrollArea),[c,l]=a.useState(!1);return a.useEffect(()=>{const d=n.scrollArea;let m=0;if(d){const f=()=>{window.clearTimeout(m),l(!0)},u=()=>{m=window.setTimeout(()=>l(!1),n.scrollHideDelay)};return d.addEventListener("pointerenter",f),d.addEventListener("pointerleave",u),()=>{window.clearTimeout(m),d.removeEventListener("pointerenter",f),d.removeEventListener("pointerleave",u)}}},[n.scrollArea,n.scrollHideDelay]),t.jsx(O,{present:o||c,children:t.jsx(de,{"data-state":c?"visible":"hidden",...i,ref:r})})}),We=a.forwardRef((e,r)=>{const{forceMount:o,...i}=e,n=w(C,e.__scopeScrollArea),c=e.orientation==="horizontal",l=X(()=>m("SCROLL_END"),100),[d,m]=Le("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return a.useEffect(()=>{if(d==="idle"){const f=window.setTimeout(()=>m("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(f)}},[d,n.scrollHideDelay,m]),a.useEffect(()=>{const f=n.viewport,u=c?"scrollLeft":"scrollTop";if(f){let x=f[u];const h=()=>{const p=f[u];x!==p&&(m("SCROLL"),l()),x=p};return f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[n.viewport,c,m,l]),t.jsx(O,{present:o||d!=="hidden",children:t.jsx($,{"data-state":d==="hidden"?"hidden":"visible",...i,ref:r,onPointerEnter:T(e.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:T(e.onPointerLeave,()=>m("POINTER_LEAVE"))})})}),de=a.forwardRef((e,r)=>{const o=w(C,e.__scopeScrollArea),{forceMount:i,...n}=e,[c,l]=a.useState(!1),d=e.orientation==="horizontal",m=X(()=>{if(o.viewport){const f=o.viewport.offsetWidth<o.viewport.scrollWidth,u=o.viewport.offsetHeight<o.viewport.scrollHeight;l(d?f:u)}},10);return k(o.viewport,m),k(o.content,m),t.jsx(O,{present:i||c,children:t.jsx($,{"data-state":c?"visible":"hidden",...n,ref:r})})}),$=a.forwardRef((e,r)=>{const{orientation:o="vertical",...i}=e,n=w(C,e.__scopeScrollArea),c=a.useRef(null),l=a.useRef(0),[d,m]=a.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),f=xe(d.viewport,d.content),u={...i,sizes:d,onSizesChange:m,hasThumb:f>0&&f<1,onThumbChange:h=>c.current=h,onThumbPointerUp:()=>l.current=0,onThumbPointerDown:h=>l.current=h};function x(h,p){return Be(h,l.current,d,p)}return o==="horizontal"?t.jsx(He,{...u,ref:r,onThumbPositionChange:()=>{if(n.viewport&&c.current){const h=n.viewport.scrollLeft,p=se(h,d,n.dir);c.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollLeft=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollLeft=x(h,n.dir))}}):o==="vertical"?t.jsx(ze,{...u,ref:r,onThumbPositionChange:()=>{if(n.viewport&&c.current){const h=n.viewport.scrollTop,p=se(h,d);c.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollTop=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollTop=x(h))}}):null}),He=a.forwardRef((e,r)=>{const{sizes:o,onSizesChange:i,...n}=e,c=w(C,e.__scopeScrollArea),[l,d]=a.useState(),m=a.useRef(null),f=W(r,m,c.onScrollbarXChange);return a.useEffect(()=>{m.current&&d(getComputedStyle(m.current))},[m]),t.jsx(ue,{"data-orientation":"horizontal",...n,ref:f,sizes:o,style:{bottom:0,left:c.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:c.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":B(o)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.x),onDragScroll:u=>e.onDragScroll(u.x),onWheelScroll:(u,x)=>{if(c.viewport){const h=c.viewport.scrollLeft+u.deltaX;e.onWheelScroll(h),ge(h,x)&&u.preventDefault()}},onResize:()=>{m.current&&c.viewport&&l&&i({content:c.viewport.scrollWidth,viewport:c.viewport.offsetWidth,scrollbar:{size:m.current.clientWidth,paddingStart:M(l.paddingLeft),paddingEnd:M(l.paddingRight)}})}})}),ze=a.forwardRef((e,r)=>{const{sizes:o,onSizesChange:i,...n}=e,c=w(C,e.__scopeScrollArea),[l,d]=a.useState(),m=a.useRef(null),f=W(r,m,c.onScrollbarYChange);return a.useEffect(()=>{m.current&&d(getComputedStyle(m.current))},[m]),t.jsx(ue,{"data-orientation":"vertical",...n,ref:f,sizes:o,style:{top:0,right:c.dir==="ltr"?0:void 0,left:c.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":B(o)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.y),onDragScroll:u=>e.onDragScroll(u.y),onWheelScroll:(u,x)=>{if(c.viewport){const h=c.viewport.scrollTop+u.deltaY;e.onWheelScroll(h),ge(h,x)&&u.preventDefault()}},onResize:()=>{m.current&&c.viewport&&l&&i({content:c.viewport.scrollHeight,viewport:c.viewport.offsetHeight,scrollbar:{size:m.current.clientHeight,paddingStart:M(l.paddingTop),paddingEnd:M(l.paddingBottom)}})}})}),[Ie,me]=le(C),ue=a.forwardRef((e,r)=>{const{__scopeScrollArea:o,sizes:i,hasThumb:n,onThumbChange:c,onThumbPointerUp:l,onThumbPointerDown:d,onThumbPositionChange:m,onDragScroll:f,onWheelScroll:u,onResize:x,...h}=e,p=w(C,o),[b,R]=a.useState(null),_=W(r,g=>R(g)),N=a.useRef(null),y=a.useRef(""),L=p.viewport,D=i.content-i.viewport,v=E(u),j=E(m),S=X(x,10);function A(g){if(N.current){const s=g.clientX-N.current.left,P=g.clientY-N.current.top;f({x:s,y:P})}}return a.useEffect(()=>{const g=s=>{const P=s.target;(b==null?void 0:b.contains(P))&&v(s,D)};return document.addEventListener("wheel",g,{passive:!1}),()=>document.removeEventListener("wheel",g,{passive:!1})},[L,b,D,v]),a.useEffect(j,[i,j]),k(b,S),k(p.content,S),t.jsx(Ie,{scope:o,scrollbar:b,hasThumb:n,onThumbChange:E(c),onThumbPointerUp:E(l),onThumbPositionChange:j,onThumbPointerDown:E(d),children:t.jsx(H.div,{...h,ref:_,style:{position:"absolute",...h.style},onPointerDown:T(e.onPointerDown,g=>{g.button===0&&(g.target.setPointerCapture(g.pointerId),N.current=b.getBoundingClientRect(),y.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),A(g))}),onPointerMove:T(e.onPointerMove,A),onPointerUp:T(e.onPointerUp,g=>{const s=g.target;s.hasPointerCapture(g.pointerId)&&s.releasePointerCapture(g.pointerId),document.body.style.webkitUserSelect=y.current,p.viewport&&(p.viewport.style.scrollBehavior=""),N.current=null})})})}),I="ScrollAreaThumb",he=a.forwardRef((e,r)=>{const{forceMount:o,...i}=e,n=me(I,e.__scopeScrollArea);return t.jsx(O,{present:o||n.hasThumb,children:t.jsx(Me,{ref:r,...i})})}),Me=a.forwardRef((e,r)=>{const{__scopeScrollArea:o,style:i,...n}=e,c=w(I,o),l=me(I,o),{onThumbPositionChange:d}=l,m=W(r,x=>l.onThumbChange(x)),f=a.useRef(void 0),u=X(()=>{f.current&&(f.current(),f.current=void 0)},100);return a.useEffect(()=>{const x=c.viewport;if(x){const h=()=>{if(u(),!f.current){const p=Xe(x,d);f.current=p,d()}};return d(),x.addEventListener("scroll",h),()=>x.removeEventListener("scroll",h)}},[c.viewport,u,d]),t.jsx(H.div,{"data-state":l.hasThumb?"visible":"hidden",...n,ref:m,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...i},onPointerDownCapture:T(e.onPointerDownCapture,x=>{const p=x.target.getBoundingClientRect(),b=x.clientX-p.left,R=x.clientY-p.top;l.onThumbPointerDown({x:b,y:R})}),onPointerUp:T(e.onPointerUp,l.onThumbPointerUp)})});he.displayName=I;var Q="ScrollAreaCorner",fe=a.forwardRef((e,r)=>{const o=w(Q,e.__scopeScrollArea),i=!!(o.scrollbarX&&o.scrollbarY);return o.type!=="scroll"&&i?t.jsx(Oe,{...e,ref:r}):null});fe.displayName=Q;var Oe=a.forwardRef((e,r)=>{const{__scopeScrollArea:o,...i}=e,n=w(Q,o),[c,l]=a.useState(0),[d,m]=a.useState(0),f=!!(c&&d);return k(n.scrollbarX,()=>{var x;const u=((x=n.scrollbarX)==null?void 0:x.offsetHeight)||0;n.onCornerHeightChange(u),m(u)}),k(n.scrollbarY,()=>{var x;const u=((x=n.scrollbarY)==null?void 0:x.offsetWidth)||0;n.onCornerWidthChange(u),l(u)}),f?t.jsx(H.div,{...i,ref:r,style:{width:c,height:d,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function M(e){return e?parseInt(e,10):0}function xe(e,r){const o=e/r;return isNaN(o)?0:o}function B(e){const r=xe(e.viewport,e.content),o=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,i=(e.scrollbar.size-o)*r;return Math.max(i,18)}function Be(e,r,o,i="ltr"){const n=B(o),c=n/2,l=r||c,d=n-l,m=o.scrollbar.paddingStart+l,f=o.scrollbar.size-o.scrollbar.paddingEnd-d,u=o.content-o.viewport,x=i==="ltr"?[0,u]:[u*-1,0];return pe([m,f],x)(e)}function se(e,r,o="ltr"){const i=B(r),n=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,c=r.scrollbar.size-n,l=r.content-r.viewport,d=c-i,m=o==="ltr"?[0,l]:[l*-1,0],f=Ee(e,m);return pe([0,l],[0,d])(f)}function pe(e,r){return o=>{if(e[0]===e[1]||r[0]===r[1])return r[0];const i=(r[1]-r[0])/(e[1]-e[0]);return r[0]+i*(o-e[0])}}function ge(e,r){return e>0&&e<r}var Xe=(e,r=()=>{})=>{let o={left:e.scrollLeft,top:e.scrollTop},i=0;return function n(){const c={left:e.scrollLeft,top:e.scrollTop},l=o.left!==c.left,d=o.top!==c.top;(l||d)&&r(),o=c,i=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(i)};function X(e,r){const o=E(e),i=a.useRef(0);return a.useEffect(()=>()=>window.clearTimeout(i.current),[]),a.useCallback(()=>{window.clearTimeout(i.current),i.current=window.setTimeout(o,r)},[o,r])}function k(e,r){const o=E(r);Ae(()=>{let i=0;if(e){const n=new ResizeObserver(()=>{cancelAnimationFrame(i),i=window.requestAnimationFrame(o)});return n.observe(e),()=>{window.cancelAnimationFrame(i),n.unobserve(e)}}},[e,o])}var be=ae,Ye=ce,Ue=fe;const q=a.forwardRef(({className:e,children:r,...o},i)=>t.jsxs(be,{ref:i,className:ne("relative overflow-hidden",e),...o,children:[t.jsx(Ye,{className:"h-full w-full rounded-[inherit]",children:r}),t.jsx(we,{}),t.jsx(Ue,{})]}));q.displayName=be.displayName;const we=a.forwardRef(({className:e,orientation:r="vertical",...o},i)=>t.jsx(K,{ref:i,orientation:r,className:ne("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...o,children:t.jsx(he,{className:"relative flex-1 rounded-full bg-border"})}));we.displayName=K.displayName;function st(){const{user:e}=je(),{t:r}=Pe(),o=ve(),i=new URLSearchParams(o).get("conversation"),n=new URLSearchParams(o).get("property"),c=new URLSearchParams(o).get("owner"),[l,d]=a.useState(i?parseInt(i):null),[m,f]=a.useState(""),u=a.useRef(null),x=a.useRef(null),h=a.useRef(null),p=()=>{if(!x.current)return;let s=x.current.querySelector("[data-radix-scroll-area-viewport]");s||(s=x.current.querySelector(".h-full.w-full")),s||(s=x.current.firstElementChild),s&&(s.scrollTop=s.scrollHeight)},b=G({mutationFn:s=>z("POST","/conversations",s),onSuccess:s=>{d(s.id),U.invalidateQueries({queryKey:["/conversations"]})}}),R=a.useRef(!1);a.useEffect(()=>{!i&&n&&c&&!l&&!b.isPending&&!b.isSuccess&&!R.current&&(R.current=!0,b.mutate({property_id:parseInt(n),owner_id:parseInt(c)})),(!n||!c)&&(R.current=!1)},[i,n,c,l,b]);const{data:_,isLoading:N}=J({queryKey:["/conversations"],queryFn:async()=>{const s=await z("GET","/conversations");return Array.isArray(s)?s:s!=null&&s.conversations&&Array.isArray(s.conversations)?s.conversations:[]},refetchInterval:5e3}),y=Array.isArray(_)?_:[],{data:L,isLoading:D}=J({queryKey:["/messages",l],enabled:!!l,queryFn:async()=>{if(!l)return[];const s=await z("GET",`/messages/${l}`);return Array.isArray(s)?s:s!=null&&s.messages&&Array.isArray(s.messages)?s.messages:[]},refetchInterval:3e3}),v=Array.isArray(L)?L:[],j=G({mutationFn:s=>z("POST","/messages",s),onSuccess:()=>{f(""),U.invalidateQueries({queryKey:["/messages",l]}),U.invalidateQueries({queryKey:["/conversations"]}),setTimeout(()=>{p()},200)}}),S=a.useRef(null);a.useEffect(()=>(v&&v.length>0&&(S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{p(),S.current=null},100)),()=>{S.current&&clearTimeout(S.current)}),[v]);const A=()=>{!m.trim()||!l||j.mutate({conversation_id:l,content:m})};a.useEffect(()=>{h.current&&(h.current.style.height="auto",h.current.style.height=`${Math.min(h.current.scrollHeight,128)}px`)},[m]);const g=Array.isArray(y)?y.find(s=>s.id===l):void 0;return t.jsx(ye,{children:t.jsx("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0 h-[calc(100vh-3.5rem)] sm:h-[calc(100vh-4rem)] md:h-[calc(100vh-5rem)]",children:t.jsx("div",{className:"container mx-auto px-0 sm:px-3 md:px-4 lg:px-6 xl:px-8 py-2 sm:py-4 md:py-6 lg:py-8 flex-1 flex flex-col overflow-hidden min-h-0",children:t.jsxs("div",{className:"max-w-6xl mx-auto flex-1 flex flex-col overflow-hidden w-full min-h-0",children:[t.jsxs("div",{className:l?"mb-2 sm:mb-3 md:mb-4 lg:mb-6 px-3 sm:px-0 flex-shrink-0 hidden md:block":"mb-2 sm:mb-3 md:mb-4 lg:mb-6 px-3 sm:px-0 flex-shrink-0",children:[t.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold mb-0.5 sm:mb-1 md:mb-2","data-testid":"text-page-title",children:r("messages.title")}),t.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm lg:text-base text-muted-foreground",children:r("messages.subtitle")})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-0 md:gap-3 lg:gap-4 xl:gap-6 flex-1 min-h-0 overflow-hidden",children:[t.jsxs(Z,{className:l?"md:col-span-1 rounded-none md:rounded-lg h-full flex flex-col overflow-hidden hidden md:flex":"md:col-span-1 rounded-none md:rounded-lg h-full flex flex-col overflow-hidden flex",children:[t.jsx(ee,{className:"px-2.5 sm:px-4 md:px-6 pb-2 sm:pb-3 md:pb-4 flex-shrink-0",children:t.jsx(te,{className:"text-sm sm:text-base md:text-lg",children:r("messages.conversations")})}),t.jsx(re,{className:"p-0 flex-1 overflow-hidden min-h-0",children:t.jsx(q,{className:"h-full",children:N?t.jsx("div",{className:"space-y-2 sm:space-y-3 p-2 sm:p-3 md:p-4",children:[1,2,3].map(s=>t.jsx(oe,{className:"h-16 sm:h-20 w-full"},s))}):!y||y.length===0?t.jsxs("div",{className:"text-center py-6 sm:py-8 md:py-12 px-2 sm:px-3 md:px-4",children:[t.jsx(F,{className:"h-8 w-8 sm:h-10 sm:w-10 md:h-12 md:w-12 text-muted-foreground mx-auto mb-2 sm:mb-3 md:mb-4"}),t.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground",children:r("messages.no_conversations")}),t.jsx(Se,{href:"/properties",children:t.jsx(Y,{variant:"ghost",size:"sm",className:"mt-2 text-[10px] sm:text-xs md:text-sm h-7 sm:h-8 md:h-9","data-testid":"link-browse-properties",children:r("messages.browse")})})]}):t.jsx("div",{className:"space-y-0.5 sm:space-y-1 p-0.5 sm:p-1 md:p-2",children:y.map(s=>t.jsx("button",{onClick:()=>d(s.id),className:l===s.id?"w-full text-left p-2 sm:p-2.5 md:p-3 lg:p-4 rounded-md transition-colors hover-elevate active:scale-[0.98] bg-accent touch-manipulation":"w-full text-left p-2 sm:p-2.5 md:p-3 lg:p-4 rounded-md transition-colors hover-elevate active:scale-[0.98] touch-manipulation","data-testid":`button-conversation-${s.id}`,children:t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3",children:[t.jsx("div",{className:"h-7 w-7 sm:h-8 sm:w-8 md:h-10 md:w-10 rounded-md bg-muted flex items-center justify-center flex-shrink-0",children:t.jsx(F,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 md:h-5 md:w-5 text-muted-foreground"})}),t.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[t.jsx("h4",{className:"font-semibold truncate text-[11px] sm:text-xs md:text-sm",children:s.property_title}),t.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs text-muted-foreground truncate",children:s.other_user_name}),s.last_message&&t.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs text-muted-foreground mt-0.5 sm:mt-1 break-all line-clamp-2 overflow-hidden",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:s.last_message})]}),s.unread_count&&s.unread_count>0&&t.jsx("div",{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 md:h-5 md:w-5 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-[8px] sm:text-[9px] md:text-[10px] lg:text-xs font-bold flex-shrink-0",children:s.unread_count})]})},s.id))})})})]}),t.jsx(Z,{className:l?"md:col-span-2 rounded-none md:rounded-lg h-full flex flex-col overflow-hidden flex":"md:col-span-2 rounded-none md:rounded-lg h-full flex flex-col overflow-hidden hidden md:flex",children:l?t.jsxs(t.Fragment,{children:[t.jsx(ee,{className:"border-b px-2.5 sm:px-4 md:px-6 py-2 sm:py-3 md:py-4 flex-shrink-0",children:t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3",children:[t.jsx(Y,{variant:"ghost",size:"icon",className:"md:hidden h-7 w-7 sm:h-8 sm:w-8 -ml-1 sm:-ml-2 touch-manipulation",onClick:()=>d(null),"data-testid":"button-back",children:t.jsx(Te,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx(te,{className:"text-xs sm:text-sm md:text-base lg:text-lg truncate","data-testid":"text-conversation-title",children:g==null?void 0:g.property_title}),t.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs lg:text-sm text-muted-foreground truncate",children:g==null?void 0:g.other_user_name})]})]})}),t.jsxs(re,{className:"p-0 flex flex-col flex-1 overflow-hidden min-h-0",children:[t.jsx(q,{ref:x,className:"flex-1 p-1.5 sm:p-2 md:p-3 lg:p-4",children:D?t.jsx("div",{className:"space-y-2 sm:space-y-3 md:space-y-4",children:[1,2,3].map(s=>t.jsx(oe,{className:"h-12 sm:h-14 md:h-16 w-3/4"},s))}):!v||v.length===0?t.jsx("div",{className:"text-center py-6 sm:py-8 md:py-12",children:t.jsxs("p",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground",children:[r("messages.no_messages")," ",r("messages.start")]})}):t.jsxs("div",{className:"space-y-1.5 sm:space-y-2 md:space-y-3 lg:space-y-4",children:[v.map(s=>{const P=s.sender_id===(e==null?void 0:e.id);return t.jsx("div",{className:P?"flex justify-end w-full min-w-0":"flex justify-start w-full min-w-0","data-testid":`message-${s.id}`,children:t.jsxs("div",{className:P?"max-w-[90%] xs:max-w-[85%] sm:max-w-[80%] md:max-w-[75%] lg:max-w-[70%] rounded-lg p-2 sm:p-2.5 md:p-3 bg-primary text-primary-foreground overflow-hidden min-w-0":"max-w-[90%] xs:max-w-[85%] sm:max-w-[80%] md:max-w-[75%] lg:max-w-[70%] rounded-lg p-2 sm:p-2.5 md:p-3 bg-muted overflow-hidden min-w-0",children:[t.jsx("p",{className:"text-[11px] sm:text-xs md:text-sm whitespace-pre-wrap break-all leading-relaxed",style:{wordBreak:"break-word",overflowWrap:"anywhere",maxWidth:"100%"},children:s.content}),t.jsx("p",{className:P?"text-[9px] sm:text-[10px] md:text-xs mt-0.5 sm:mt-1 text-primary-foreground/70":"text-[9px] sm:text-[10px] md:text-xs mt-0.5 sm:mt-1 text-muted-foreground",children:new Date(s.created_at).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})},s.id)}),t.jsx("div",{ref:u})]})}),t.jsx("div",{className:"border-t p-1.5 sm:p-2 md:p-3 lg:p-4 bg-background flex-shrink-0",children:t.jsxs("form",{onSubmit:s=>{s.preventDefault(),s.stopPropagation(),A()},className:"flex gap-1 sm:gap-1.5 md:gap-2 items-end",children:[t.jsx(Ce,{ref:h,value:m,onChange:s=>f(s.target.value),placeholder:r("messages.type_message"),disabled:j.isPending,"data-testid":"input-message",className:"text-[13px] sm:text-sm md:text-base min-h-[2.5rem] max-h-[8rem] resize-none flex-1 overflow-y-auto",rows:1,onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),m.trim()&&!j.isPending&&A())}}),t.jsx(Y,{type:"submit",size:"icon",disabled:!m.trim()||j.isPending,"data-testid":"button-send",className:"h-8 w-8 sm:h-9 sm:w-9 md:h-10 md:w-10 flex-shrink-0 touch-manipulation",children:t.jsx(_e,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]})})]})]}):t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("div",{className:"text-center py-6 sm:py-8 md:py-12 px-3 sm:px-4",children:[t.jsx(F,{className:"h-10 w-10 sm:h-12 sm:w-12 md:h-16 md:w-16 text-muted-foreground mx-auto mb-2 sm:mb-3 md:mb-4"}),t.jsx("h3",{className:"font-semibold text-sm sm:text-base md:text-lg mb-1 sm:mb-2",children:r("messages.select_conversation")}),t.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground",children:r("messages.select_conversation.desc")})]})})})]})]})})})})}export{st as default};
