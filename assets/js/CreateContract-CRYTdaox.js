import{u as F,b as L,j as e}from"./query-vendor-CNIykozp.js";import{i as I,u as E,r as v,L as h}from"./react-vendor-DdYNpgPf.js";import{u as A,t as P,F as T,a as i,b as d,c,d as l,f as S,e as m,h as q}from"./schema-CaPukD_K.js";import{M as p}from"./MainLayout-NmdhbHwr.js";import{B as x}from"./button-DFlaW1fX.js";import{I as u}from"./input-BXFQAMFp.js";import{C as M,b as H,c as V,d as k,a as B}from"./card-soCmDmm_.js";import{S as R,a as G,b as O,c as $,d as z}from"./select-DpKPHdZL.js";import{A as K,a as Q}from"./alert-C_e47U5j.js";import{a as J,b as y}from"./index-DQr_hYrl.js";import{A as U}from"./arrow-left-DFp-O6Nw.js";import"./ui-vendor-BME24-VV.js";import"./label-CoUyTYQ2.js";import"./Logo-DJHknSUJ.js";import"./user-CZwPb1SC.js";import"./building-2-BFsPi-4G.js";function xe(){const f=I(),o=f.propertyId?parseInt(f.propertyId):null,[,_]=E(),{isOwner:g}=J(),[C,N]=v.useState(""),{data:r,isLoading:w}=F({queryKey:[`/properties/${o}`],enabled:!!o,queryFn:async()=>{if(!o)throw new Error("Property ID required");return y("GET",`/properties/${o}`)}}),{data:j}=F({queryKey:["/users/students"],enabled:g,queryFn:async()=>y("GET","/users/students")}),s=A({resolver:P(q),defaultValues:{property_id:o||0,student_id:0,start_date:"",end_date:"",monthly_rent:(r==null?void 0:r.price)||0,deposit_amount:r!=null&&r.price?r.price*3:0}});v.useEffect(()=>{r&&(s.setValue("monthly_rent",r.price),s.setValue("deposit_amount",r.price*3))},[r]);const b=L({mutationFn:t=>y("POST","/contracts/create",t),onSuccess:t=>{_(`/contracts/${t.contract.id}`)},onError:t=>{N(t.message||"Failed to create contract")}}),D=t=>{N(""),b.mutate(t)};return g?w?e.jsx(p,{children:e.jsx("div",{className:"container mx-auto px-4 py-16 text-center",children:e.jsx("p",{children:"Loading property details..."})})}):r?e.jsx(p,{children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(h,{href:"/dashboard/owner",children:e.jsxs(x,{variant:"ghost",className:"mb-4","data-testid":"button-back",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})}),e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs(M,{children:[e.jsxs(H,{children:[e.jsx(V,{children:"Create Rental Contract"}),e.jsxs(k,{children:["Create a new rental contract for ",r.title]})]}),e.jsxs(B,{children:[C&&e.jsx(K,{variant:"destructive",className:"mb-4",children:e.jsx(Q,{children:C})}),e.jsxs("div",{className:"mb-6 p-4 bg-muted rounded-md",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Property Details"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.address,", ",r.city_name]}),e.jsxs("p",{className:"font-semibold mt-2",children:["CHF ",r.price.toLocaleString(),"/month"]})]}),e.jsx(T,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(D),className:"space-y-6",children:[e.jsx(i,{control:s.control,name:"student_id",render:({field:t})=>{var n;return e.jsxs(d,{children:[e.jsx(c,{children:"Select Tenant"}),e.jsxs(R,{onValueChange:a=>t.onChange(parseInt(a)),value:(n=t.value)==null?void 0:n.toString(),children:[e.jsx(l,{children:e.jsx(G,{"data-testid":"select-student",children:e.jsx(O,{placeholder:"Choose a student"})})}),e.jsx($,{children:j==null?void 0:j.map(a=>e.jsxs(z,{value:a.id.toString(),children:[a.first_name," ",a.last_name," (",a.email,")"]},a.id))})]}),e.jsx(S,{children:"Select the student who will rent this property"}),e.jsx(m,{})]})}}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:s.control,name:"start_date",render:({field:t})=>e.jsxs(d,{children:[e.jsx(c,{children:"Start Date"}),e.jsx(l,{children:e.jsx(u,{...t,type:"date","data-testid":"input-start-date"})}),e.jsx(m,{})]})}),e.jsx(i,{control:s.control,name:"end_date",render:({field:t})=>e.jsxs(d,{children:[e.jsx(c,{children:"End Date"}),e.jsx(l,{children:e.jsx(u,{...t,type:"date","data-testid":"input-end-date"})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:s.control,name:"monthly_rent",render:({field:t})=>e.jsxs(d,{children:[e.jsx(c,{children:"Monthly Rent (CHF)"}),e.jsx(l,{children:e.jsx(u,{...t,type:"number",onChange:n=>t.onChange(parseFloat(n.target.value)||0),"data-testid":"input-monthly-rent"})}),e.jsx(m,{})]})}),e.jsx(i,{control:s.control,name:"deposit_amount",render:({field:t})=>e.jsxs(d,{children:[e.jsx(c,{children:"Deposit Amount (CHF)"}),e.jsx(l,{children:e.jsx(u,{...t,type:"number",onChange:n=>t.onChange(parseFloat(n.target.value)||0),"data-testid":"input-deposit"})}),e.jsx(S,{children:"Typically 3 months rent"}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(x,{type:"submit",size:"lg",disabled:b.isPending,className:"flex-1","data-testid":"button-submit",children:b.isPending?"Creating...":"Create Contract"}),e.jsx(h,{href:"/dashboard/owner",children:e.jsx(x,{type:"button",variant:"outline",size:"lg","data-testid":"button-cancel",children:"Cancel"})})]})]})})]})]})})]})}):e.jsx(p,{children:e.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Property Not Found"}),e.jsx(h,{href:"/dashboard/owner",children:e.jsx(x,{"data-testid":"button-dashboard",children:"Back to Dashboard"})})]})}):e.jsx(p,{children:e.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Only property owners can create contracts"}),e.jsx(h,{href:"/",children:e.jsx(x,{"data-testid":"button-home",children:"Go Home"})})]})})}export{xe as default};
